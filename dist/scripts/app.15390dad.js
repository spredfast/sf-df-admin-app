"use strict";angular.module("dfUserManagement",["ngRoute","ngCookies","dfUtility"]).constant("MODUSRMNGR_ROUTER_PATH","/user-management").constant("MODUSRMNGR_ASSET_PATH","admin_components/adf-user-management/").run(["$cookieStore","$http","UserDataService",function(a,b,c){var d=a.get("CurrentUserObj");d&&(c.setCurrentUser(a.get("CurrentUserObj")),b.defaults.headers.common["X-DreamFactory-Session-Token"]=d.session_id)}]).controller("UserManagementCtrl",["$scope",function(a){}]).directive("modusrmngrNavigation",["MODUSRMNGR_ASSET_PATH",function(a){return{restrict:"E",templateUrl:a+"views/navigation.html",link:function(a,b,c){}}}]).directive("dreamfactoryUserLogin",["MODUSRMNGR_ASSET_PATH","INSTANCE_URL","$http","$location","$cookies","$cookieStore","UserEventsService","UserDataService","_dfObjectService","SystemConfigDataService",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",replace:!0,scope:{options:"=?",inErrorMsg:"=?"},templateUrl:a+"views/login.html",link:function(a,k,l){a.es=g.login;var m={showTemplate:!0};a.options=i.mergeObjects(a.options,m),a.showTemplate=a.options.showTemplate,a.loginFormTitle="Login",a.loginActive=!0,a.creds={email:"",password:""},a.errorMsg=a.inErrorMsg||"",a.successMsg="",a.loginWaiting=!1,a.showOAuth=!0,a.loginForm={},a.systemConfig=j.getSystemConfig(),a.adldap=a.systemConfig.authentication.adldap||[],a.adldapAvailable=a.adldap.length>0?!0:!1,a.selectedService=null,a.rememberMe=!1,a.userField={icon:"fa-envelope",text:"Enter Email",type:"email"},a.rememberLogin=function(b){a.rememberMe=b},a.useAdLdapService=function(b){a.selectedService=b,b?(a.userField={icon:"fa-user",text:"Enter Username",type:"text"},a.creds={username:"",password:"",service:b}):(a.userField={icon:"fa-envelope",text:"Enter Email",type:"email"},a.creds={email:"",password:""})};var n=location.search.substring(1),o=d.absUrl().split("?"),p=o[1],q="";p&&-1!==p.indexOf("session_token")&&(q=p.substring(14)),""!==q?(a.loginWaiting=!0,a.showOAuth=!1,a.loginDirect=!0,c.get(b+"/api/v2/user/session?session_token="+q).then(function(b){a._setCookies(b.data),c.defaults.headers.common["X-DreamFactory-Session-Token"]=e.PHPSESSID,h.setCurrentUser(b.data),a.$emit(a.es.loginSuccess,b.data),a.loginDirect=!1},function(b){window.location.href=o[0]+"#/login",a.loginDirect=!1})):n&&(a.loginWaiting=!0,a.showOAuth=!1,c.post(b+"/api/v2/user/session?oauth_callback=true&"+n).then(function(b){a._setCookies(b.data),c.defaults.headers.common["X-DreamFactory-Session-Token"]=e.PHPSESSID,h.setCurrentUser(b.data),a.$emit(a.es.loginSuccess,b.data)})),a.login=function(b){a.selectedService?(b.username=$("#df-login-email").val(),b.password=$("#df-login-password").val(),b.service=a.selectedService):(""===b.email||""===b.password)&&(b.email=$("#df-login-email").val(),b.password=$("#df-login-password").val()),b.remember_me=a.rememberMe,a._login(b)},a.forgotPassword=function(){a._forgotPassword()},a.showLoginForm=function(){a._toggleForms()},a.dismissError=function(){a.errorMsg=""},a.dismissSuccess=function(){a.successMsg=""},a._loginRequest=function(a,d){return d?c.post(b+"/api/v2/system/admin/session",a):c.post(b+"/api/v2/user/session",a)},a._setSessionToken=function(a){e.PHPSESSID=a.session_id},a._setCurrentUser=function(a){f.put("CurrentUserObj",a)},a._setCookies=function(b){e.PHPSESSID=e.PHPSESSID===b.session_id?e.PHPSESSID:b.session_id,a._setCurrentUser(b)},a._toggleFormsState=function(){a.loginActive=!a.loginActive,a.resetPasswordActive=!a.resetPasswordActive},a._login=function(b){a.loginWaiting=!0,a._loginRequest(b,!1).then(function(b){delete b.data.no_group_apps,delete b.data.app_groups,a._setCookies(b.data),c.defaults.headers.common["X-DreamFactory-Session-Token"]=e.PHPSESSID,h.setCurrentUser(b.data),a.$emit(a.es.loginSuccess,b.data),a.$root.$emit(a.es.loginSuccess,b.data)},function(d){"401"!=d.status&&"404"!=d.status||a.selectedService?(a.errorMsg=d.data.error.message,a.$emit(a.es.loginError,d)):(a.loginWaiting=!0,a._loginRequest(b,!0).then(function(b){delete b.data.no_group_apps,delete b.data.app_groups,a._setCookies(b.data),c.defaults.headers.common["X-DreamFactory-Session-Token"]=e.PHPSESSID,h.setCurrentUser(b.data),a.$emit(a.es.loginSuccess,b.data),a.$root.$emit(a.es.loginSuccess,b.data)},function(b){a.errorMsg=b.data.error.message,a.$emit(a.es.loginError,b)})["finally"](function(){a.loginWaiting=!1}))})["finally"](function(){a.loginWaiting=!1})},a._toggleForms=function(){a._toggleFormsState()},a._forgotPassword=function(){a.$broadcast(g.password.passwordResetRequest,{email:a.creds.email})};a.$watch("options",function(b,c){b&&b.hasOwnProperty("showTemplate")&&(a.showTemplate=b.showTemplate)},!0);a.$on(a.es.loginRequest,function(b,c){a._login(c)})}}}]).directive("dreamfactoryForgotPwordEmail",["MODUSRMNGR_ASSET_PATH","INSTANCE_URL","$http","_dfStringService","UserEventsService",function(a,b,c,d,e){return{restrict:"E",replace:!0,scope:!1,templateUrl:a+"views/fp-email-conf.html",link:function(a,f,g){a.es=e.password,a.emailForm=!0,a.emailError=!1,a.securityQuestionForm=!1,a.hidePasswordField=!1,a.allowForeverSessions=a.systemConfig.authentication.allow_forever_sessions,a.sq={email:null,security_question:null,security_answer:null,new_password:null,verify_password:null},a.identical=!0,a.requestWaiting=!1,a.questionWaiting=!1,a.requestPasswordReset=function(b){a._requestPasswordReset(b)},a.securityQuestionSubmit=function(b){return a.identical?a._verifyPasswordLength(b)?void a._securityQuestionSubmit(b):void(a.errorMsg="Password must be at least 5 characters."):void(a.errorMsg="Passwords do not match.")},a.verifyPassword=function(b){a._verifyPassword(b)},a._resetPasswordRequest=function(a,d){return d?c.post(b+"/api/v2/system/admin/password?reset=true",a):c.post(b+"/api/v2/user/password?reset=true",a)},a._resetPasswordSQ=function(a,d){return d?c.post(b+"/api/v2/system/admin/password?login=false",a):c.post(b+"/api/v2/user/password?login=false",a)},a._verifyPassword=function(b){a.identical=d.areIdentical(b.new_password,b.verify_password)},a._verifyPasswordLength=function(a){return a.new_password.length>=5},a._requestPasswordReset=function(b){b.reset=!0,a.requestWaiting=!0,a._resetPasswordRequest(b,!1).then(function(c){c.data.hasOwnProperty("security_question")?(a.emailForm=!1,a.securityQuestionForm=!0,a.sq.email=b.email,a.sq.security_question=c.data.security_question):(a.successMsg="A password reset email has been sent to the provided email address.",a.$emit(a.es.passwordResetRequestSuccess,b.email))},function(c){"401"==c.status||"404"==c.status?a._resetPasswordRequest(b,!0).then(function(c){c.data.hasOwnProperty("security_question")?(a.emailForm=!1,a.securityQuestionForm=!0,a.sq.email=b.email,a.sq.security_question=c.data.security_question):(a.successMsg="A password reset email has been sent to the provided email address.",a.$emit(a.es.passwordResetRequestSuccess,b.email))},function(b){a.errorMsg=b.data.error.message})["finally"](function(){a.requestWaiting=!1}):a.errorMsg=c.data.error.message})["finally"](function(){a.requestWaiting=!1})},a._securityQuestionSubmit=function(b){a.questionWaiting=!0,a._resetPasswordSQ(b,!1).then(function(c){var d={email:b.email,password:b.new_password};a.$emit(e.password.passwordSetSuccess,d)},function(c){"401"==c.status||"404"==c.status?a._resetPasswordSQ(b,!0).then(function(c){var d={email:b.email,password:b.new_password};a.$emit(e.password.passwordSetSuccess,d)},function(b){a.questionWaiting=!1,a.errorMsg=b.data.error.message,a.$emit(e.password.passwordSetError)})["finally"](function(){}):(a.questionWaiting=!1,a.errorMsg=c.data.error.message,a.$emit(e.password.passwordSetError))})["finally"](function(){})},a.$on(e.password.passwordResetRequest,function(b,c){a._toggleForms()})}}}]).directive("dreamfactoryForgotPwordQuestion",["MODUSRMNGR_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/fp-security-question.html",link:function(a,b,c){}}}]).directive("dreamfactoryPasswordReset",["MODUSRMNGR_ASSET_PATH","INSTANCE_URL","$http","UserEventsService","_dfStringService","_dfObjectService","dfNotify",function(a,b,c,d,e,f,g){return{restrict:"E",scope:{options:"=?",inErrorMsg:"=?"},templateUrl:a+"views/password-reset.html",link:function(a,g,h){a.es=d.password;var i={showTemplate:!0,login:!1};a.options=f.mergeObjects(a.options,i),a.showTemplate=a.options.showTemplate,a.identical=!0,a.successMsg="",a.errorMsg="",a.resetWaiting=!1,a.dismissError=function(){a.errorMsg=""},a.dismissSuccess=function(){a.successMsg=""},a.resetPassword=function(b){return a.identical?a._verifyPasswordLength(b)?void a._resetPassword(b):void(a.errorMsg="Password must be at least 5 characters."):void(a.errorMsg="Passwords do not match.")},a.verifyPassword=function(b){a._verifyPassword(b)},a._setPasswordRequest=function(d,e){var f=b+"/api/v2/system/admin/password";return e||(f=b+"/api/v2/user/password"),c({url:f,method:"POST",params:{login:a.options.login},data:d})},a._verifyPassword=function(b){a.identical=e.areIdentical(b.new_password,b.verify_password)},a._verifyPasswordLength=function(a){return a.new_password.length>=5},a._resetPassword=function(b){a.resetWaiting=!0;var c={email:b.email,code:b.code,new_password:b.new_password};a._setPasswordRequest(c,!1).then(function(c){var d={email:b.email,password:b.new_password};a.$emit(a.es.passwordSetSuccess,d),a.showTemplate=!1},function(d){"401"==d.status||"404"==d.status?a._setPasswordRequest(c,!0).then(function(c){var d={email:b.email,password:b.new_password};a.$emit(a.es.passwordSetSuccess,d),a.showTemplate=!1},function(b){a.errorMsg=b.data.error.message,a.$emit(a.es.passwordSetError),a.resetWaiting=!1})["finally"](function(){a.resetWaiting=!1}):(a.errorMsg=d.data.error.message,a.$emit(a.es.passwordSetError),a.resetWaiting=!1)})["finally"](function(){a.resetWaiting=!1})};var j=a.$watch("inErrorMsg",function(b,c){a.confirmWaiting=!1,a.errorMsg=b});a.$on(a.es.passwordSetRequest,function(b,c){a._resetPassword(c)}),a.$on("$destroy",function(a){j()})}}}]).directive("dreamfactoryUserLogout",["INSTANCE_URL","$http","$cookieStore","UserEventsService","UserDataService",function(a,b,c,d,e){return{restrict:"E",scope:{},link:function(f,g,h){f.es=d.logout,f._logoutRequest=function(c){var d=e.getCurrentUser(),f=d.is_sys_admin?"/api/v2/system/admin/session":"/api/v2/user/session";return b["delete"](a+f)},f._logout=function(){f._logoutRequest(!1).then(function(){c.remove("PHPSESSID"),c.remove("CurrentUserObj"),e.unsetCurrentUser(),b.defaults.headers.common["X-DreamFactory-Session-Token"]="",f.$emit(f.es.logoutSuccess,!1)},function(a){if("401"!=a.status&&"401"!=a.data.error.code)throw{module:"DreamFactory User Management",type:"error",provider:"dreamfactory",exception:a};c.remove("PHPSESSID"),c.remove("CurrentUserObj"),e.unsetCurrentUser(),b.defaults.headers.common["X-DreamFactory-Session-Token"]="",f.$emit(f.es.logoutSuccess,!1)})},f.$on(f.es.logoutRequest,function(a){f._logout()}),f._logout()}}}]).directive("dreamfactoryRegisterUser",["MODUSRMNGR_ASSET_PATH","INSTANCE_URL","$http","$rootScope","$cookieStore","UserEventsService","_dfStringService","_dfObjectService","dfXHRHelper",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",templateUrl:a+"views/register.html",scope:{options:"=?"},link:function(a,d,e){a.es=f.register;var j={showTemplate:!0,login:!1};a.options=h.mergeObjects(a.options,j),a.showTemplate=a.options.showTemplate,a.identical=!0,a.errorMsg="",a.dismissError=function(){a.errorMsg=""},a.register=function(b){a._register(b)},a.verifyPassword=function(b){a._verifyPassword(b)},a._registerRequest=function(d){return c({url:b+"/api/v2/user/register",method:"POST",params:{login:a.options.login},data:d})},a._getSystemConfig=function(){return c.get(b+"/api/v2/system/environment")},a._register=function(b){return 1!=a.identical?void(a.errorMsg="Password and confirm password do not match."):(a._runRegister=function(b){a._registerRequest(b).then(function(c){if(null==a.options.confirmationRequired){var d={email:b.email,password:b.new_password};a.$emit(a.es.registerSuccess,d)}else a.$emit(a.es.registerConfirmation,c.data)},function(b){var c="Validation failed. ",d=b.data.error.context;angular.forEach(d,function(a,b){c=c+b+": "+a+" "},c),a.errorMsg=c})},void(null==a.options.confirmationRequired?a._getSystemConfig().then(function(c){var d=c.data;a.options.confirmationRequired=d.authentication.open_reg_email_service_id,a._runRegister(b)},function(a){throw{module:"DreamFactory User Management",type:"error",provider:"dreamfactory",exception:a}}):a._runRegister(b)))},a._verifyPassword=function(b){a.identical=g.areIdentical(b.new_password,b.verify_password)},a.$watchCollection("options",function(b,c){if(!b.hasOwnProperty("confirmationRequired")){var d=i.get({url:"system/environment"});a.options.confirmationRequired=d.authentication.allow_open_registration&&d.authentication.open_reg_email_service_id?!0:null}}),a.$on(a.es.registerRequest,function(b,c){a._register(c)})}}}]).directive("dreamfactoryUserProfile",["MODUSRMNGR_ASSET_PATH","_dfObjectService","UserDataService","UserEventsService",function(a,b,c,d){return{restrict:"E",replace:!0,templateUrl:a+"views/edit-profile.html",scope:{options:"=?"},link:function(a,c,e){a.es=d.profile;var f={showTemplate:!0};a.options=b.mergeObjects(a.options,f)}}}]).directive("dreamfactoryRemoteAuthProviders",["MODUSRMNGR_ASSET_PATH","_dfObjectService","UserDataService","UserEventsService","SystemConfigDataService",function(a,b,c,d,e){return{restrict:"E",replace:!0,templateUrl:a+"views/remote-auth-providers.html",scope:!1,link:function(a,b,c){a.systemConfig=e.getSystemConfig(),a.oauths=a.systemConfig.authentication.oauth,a.loginWithProvider=function(b){a._loginWithProvider(b)},a._loginWithProvider=function(a){window.top.location.href="/api/v2/"+a}}}}]).directive("dreamfactoryConfirmUser",["MODUSRMNGR_ASSET_PATH","INSTANCE_URL","$http","_dfObjectService","_dfStringService","UserDataService","UserEventsService","SystemConfigDataService",function(a,b,c,d,e,f,g,h){return{restrict:"E",replace:!0,templateUrl:a+"views/confirmation-code.html",scope:{options:"=?",inErrorMsg:"=?"},link:function(a,f,h){var i={showTemplate:!0,title:"User Confirmation"};a.options=d.mergeObjects(a.options,i),a.showTemplate=a.options.showTemplate,a.identical=!0,a.errorMsg="",a.successMsg="",a.confirmWaiting=!1,a.dismissError=function(){a.errorMsg=""},a.dismissSuccess=function(){a.successMsg=""},a.confirm=function(b){return a.identical?a._verifyPasswordLength(b)?void a._confirm(b):void(a.errorMsg="Password must be at least 5 characters."):void(a.errorMsg="Passwords do not match.")},a.verifyPassword=function(b){a._verifyPassword(b)},a._verifyPassword=function(b){a.identical=e.areIdentical(b.new_password,b.verify_password)},a._verifyPasswordLength=function(a){return a.new_password.length>=5},a._confirmUserToServer=function(a){return c({url:b+"/api/v2/user/password",method:"POST",params:{login:!1},data:a})},a._confirm=function(b){a.confirmWaiting=!0;var c=b;a._confirmUserToServer(c).then(function(b){var d={email:c.email,password:c.new_password};a.$emit(g.confirm.confirmationSuccess,d)},function(b){a.errorMsg=b.data.error.message,a.$emit(g.confirm.confirmationError),a.confirmWaiting=!1})["finally"](function(){})};var j=a.$watch("inErrorMsg",function(b,c){a.confirmWaiting=!1,a.errorMsg=b});a.$on("$destroy",function(a){j()}),a.$on(g.confirm.confirmationRequest,function(b,c){a._confirm(c)})}}}]).directive("dreamfactoryWaiting",["MODUSRMNGR_ASSET_PATH",function(a){return{restrict:"E",scope:{show:"=?"},replace:!1,templateUrl:a+"views/dreamfactory-waiting.html",link:function(a,b,c){function d(){g=e.parent(".panel-body").outerHeight(),h=e.parent(".panel-body").outerWidth(),i=e.parent(".panel-body").position().top,j=e.parent(".panel-body").position().left,f.css({height:g+"px",width:h+"px",position:"absolute",left:j,top:i}),f.children(".df-spinner").css({position:"absolute",top:(g-110)/2,left:(h-70)/2})}var e=$(b),f=e.children(),g=e.parent(".panel-body").outerHeight(),h=e.parent(".panel-body").outerWidth(),i=e.position().top+parseInt(e.parent().css("padding-top"))+"px",j=e.position().left+parseInt(e.parent().css("padding-left"))+"px";a._showWaiting=function(){d(),f.fadeIn("fast")},a._hideWaiting=function(){f.hide()},a.$watch("show",function(b,c){b?a._showWaiting():a._hideWaiting()}),$(window).on("resize load",function(){d()})}}}]).service("UserEventsService",[function(){return{login:{loginRequest:"user:login:request",loginSuccess:"user:login:success",loginError:"user:login:error"},logout:{logoutRequest:"user:logout:request",logoutSuccess:"user:logout:success",logoutError:"user:logout:error"},register:{registerRequest:"user:register:request",registerSuccess:"user:register:success",registerError:"user:register:error",registerConfirmation:"user:register:confirmation"},password:{passwordResetRequest:"user:passwordreset:request",passwordResetRequestSuccess:"user:passwordreset:requestsuccess",passwordSetRequest:"user:passwordset:request",passwordSetSuccess:"user:passwordset:success",passwordSetError:"user:passwordset:error"},profile:{},confirm:{confirmationSuccess:"user:confirmation:success",confirmationError:"user:confirmation:error",confirmationRequest:"user:confirmation:request"}}}]).service("UserDataService",["$http","INSTANCE_URL","XHRHelper",function(a,b,c){function d(){return j}function e(c){return a({url:b+"/api/v2/user/custom",method:"POST",data:c})}function f(d,e){if(d=d||"",e=e||!1){var f={url:"user/custom/"+d};return c.ajax(f)}return a({url:b+"/api/v2/user/custom/"+d,method:"GET"})}function g(a){j=a}function h(){j=!1}function i(){return!!j}var j=!1;return{getCurrentUser:function(){return d()},saveUserSetting:function(a){return e(a)},getUserSetting:function(a,b){return f(a,b)},setCurrentUser:function(a){g(a)},unsetCurrentUser:function(){h()},hasUser:function(){return i()}}}]).service("_dfStringService",[function(){return{areIdentical:function(a,b){function c(a,b){return a.length==b.length}function d(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;d++)if(a.charAt(d)!==b.charAt(d))return!1;return!0}return a=a||"",b=b||"",c(a,b)&&d(a,b)?!0:!1}}}]).service("_dfObjectService",[function(){return{self:this,mergeObjects:function(a,b){for(var c in a)b[c]=a[c];return b},deepMergeObjects:function(a,b){var c=this;for(var d in a)b.hasOwnProperty(d)&&("object"==typeof b[d]?b[d]=c.deepMergeObjects(a[d],b[d]):b[d]=a[d]);return b}}}]).service("dfXHRHelper",["INSTANCE_URL","ADMIN_API_KEY","$cookies",function(a,b,c){function d(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function e(a,d){a.setRequestHeader("X-DreamFactory-API-Key",b),a.setRequestHeader("X-DreamFactory-Session-Token",c.PHPSESSID);for(var e in d)a.setRequestHeader(e,d[e])}function f(a){var b="";if(!d(a)){b="?";for(var c in a)b+=c+"="+a[c]+"&"}return""!==b&&(b=b.substring(0,b.length-1),encodeURI(b)),b}function g(b,c,d,g,h,i){var j;j=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var k=f(g);return j.open(b,a+"/api/v2/"+c+k,d),e(j,h),j.overrideMimeType(i),j.send(),4==j.readyState&&200==j.status?angular.fromJson(j.responseText):j.status}function h(a){if(!a.url||""===a.url)throw{module:"DreamFactory System Config Module",type:"error",provider:"dreamfactory",exception:"XHRHelper Request Failure: No URL provided"};var b={method:"GET",url:"",async:!1,params:{},headers:{},mimeType:"application/json"};for(var c in b)a.hasOwnProperty(c)&&(b[c]=a[c]);return g(b.method,b.url,b.async,b.params,b.headers,b.mimeType)}return{get:function(a){return h(a)}}}]),angular.module("dfUtility",["dfApplication"]).constant("MOD_UTILITY_ASSET_PATH","admin_components/adf-utility/").directive("dfComponentTitle",["MOD_UTILITY_ASSET_PATH","$location",function(a,b){return{restrict:"E",replace:!0,scope:!1,template:'<h1 class="df-component-nav-title pull-left">{{$parent.title}}</h1>'}}]).directive("dfTopLevelNavStd",["MOD_UTILITY_ASSET_PATH","$location","UserDataService",function(a,b,c){return{restrict:"E",scope:{options:"=?"},templateUrl:a+"views/df-top-level-nav-std.html",link:function(a,c,d){a.links=a.options.links,a.activeLink=null,a.$watch(function(){return b.path()},function(b,c){switch(b){case"/apps":case"/admins":case"/users":case"/roles":case"/services":case"/schema":case"/data":case"/file-manager":case"/scripts":case"/config":case"/package-manager":case"/apidocs":case"/downloads":a.activeLink="admin";break;case"/launchpad":a.activeLink="launchpad";break;case"/profile":a.activeLink="profile";break;case"/login":a.activeLink="login";break;case"/register":case"/register-complete":case"/register-confirm":a.activeLink="register"}})}}}]).directive("dfComponentNav",["MOD_UTILITY_ASSET_PATH","$location","$rootScope",function(a,b,c){return{restrict:"E",scope:{options:"=?"},templateUrl:a+"views/df-component-nav.html",link:function(a,d,e){a.activeLink=null,a.links=a.options.links,a.toggleMenu=!1,a.openMenu=function(){a._openMenu()},a.closeMenu=function(){a._closeMenu()},a._openMenu=function(){a.toggleMenu=!0},a._closeMenu=function(){a.toggleMenu=!1},a.$watch("toggleMenu",function(a,b){return 1==a?($("#component-nav-flyout-mask").fadeIn(250),$("#top-bar-mask").fadeIn(250),$("#dreamfactoryApp").css({position:"fixed",right:"0",left:"0"}).animate({right:"+=300",left:"-=300"},250,function(){}),void $("#component-nav-flyout-menu").animate({right:"+=300"},250,function(){})):a===!1&&b?($("#dreamfactoryApp").animate({right:"-=300",left:"+=300"},250,function(){}),$("#component-nav-flyout-menu").animate({right:"-=300"},250,function(){}),$("#dreamfactoryApp").css("position","relative"),$("#component-nav-flyout-mask").fadeOut(250),void $("#top-bar-mask").fadeOut(250)):void 0}),a.$watch(function(){return b.path()},function(b,c){return b?void(a.activeLink=b.substr(1,b.length)):void(a.activeLink=null)}),c.$on("$routeChangeSuccess",function(b){a.$broadcast("component-nav:view:change"),a._closeMenu()})}}}]).directive("dfSidebarNav",["MOD_UTILITY_ASSET_PATH","$rootScope","$location",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/df-sidebar-nav.html",link:function(a,b,d){function e(a){switch(a){case"/schema":case"/data":case"/file-manager":case"/scripts":case"/apidocs":case"/package-manager":case"/downloads":$(".df-component-nav-title").css({marginLeft:0});break;case"/apps":case"/admins":case"/users":case"/roles":case"/services":case"/config":var b=$(document).find("#sidebar-open");b&&b.is(":visible")?$(".df-component-nav-title").css({marginLeft:"45px"}):$(".df-component-nav-title").css({marginLeft:0})}}a.activeView=a.links[0],a.toggleMenu=!1,a.setActiveView=function(b){a._setActiveView(b)},a.openMenu=function(){a._openMenu()},a.closeMenu=function(){a._closeMenu()},a._setActiveView=function(b){a.activeView=b,a._closeMenu(),a.$broadcast("sidebar-nav:view:change")},a._openMenu=function(){a.toggleMenu=!0},a._closeMenu=function(){a.toggleMenu=!1},a.$watch("toggleMenu",function(a,b){return 1==a?($("#sidebar-nav-flyout-mask").css("z-index",10).fadeIn(250),$("#top-bar-mask").fadeIn(250),$("#dreamfactoryApp").css({position:"fixed",right:"0",left:"0"}).animate({right:"-=300",left:"+=300"},250,function(){}),void $("#sidebar-nav-flyout-menu").animate({left:"+=300"},250,function(){})):a===!1&&b?($("#dreamfactoryApp").animate({right:"+=300",left:"-=300"},250,function(){}),$("#sidebar-nav-flyout-menu").animate({left:"-=300"},250,function(){}),$("#dreamfactoryApp").css("position","relative"),$("#sidebar-nav-flyout-mask").fadeOut(250),void $("#top-bar-mask").fadeOut(250)):void 0}),a.$watch("activeView",function(a,b){return a?(b.active=!1,void(a.active=!0)):!1}),$(window).resize(function(){e(c.path())}),a.$watch(function(){return c.path()},function(a,b){e(a)})}}}]).directive("dreamfactoryAutoHeight",["$window","$route",function(a){return{restrict:"A",link:function(b,c,d){b._getWindow=function(){return $(window)},b._getDocument=function(){return $(document)},b._getParent=function(a){switch(a){case"window":return b._getWindow();case"document":return b._getDocument();default:return $(a)}},b._setElementHeight=function(){angular.element(c).css({height:b._getParent(d.autoHeightParent).height()-200-d.autoHeightPadding})},b._setElementHeight(),angular.element(a).on("resize",function(){b._setElementHeight()})}}}]).directive("resize",[function(a){return function(b,c){var d=angular.element(a);b.getWindowDimensions=function(){return{h:d.height(),w:d.width()}},b.$watch(b.getWindowDimensions,function(a,d){b.windowHeight=a.h,b.windowWidth=a.w,angular.element(c).css({width:a.w-angular.element("sidebar").css("width")+"px"})},!0)}}]).directive("dfFsHeight",["$window","$rootScope",function(a,b){return function(a,c,d){var e=function(){var a=$(c),d=$(window).height(),e=$(window).width();a.is("#swagger")?a.attr("height",d-200+"px"):a.is("#file-manager")?(a.attr("height",d-130+"px"),b.$emit("filemanager:sized")):a.is("#scripting-sidebar-list")?a.css("height",d-280+"px"):"ide"===a.attr("id")?a.css({height:d-280+"px"}):a.hasClass("package-export-table")?a.css({height:d-600}):e>=992?$(c).css({height:d-120}):$(c).css({height:"auto"})};a.$on("apidocs:loaded",function(a){e()}),a.$on("filemanager:loaded",function(a){e()}),a.$on("script:loaded:success",function(a){e()}),a.$on("sidebar-nav:view:change",function(a){e()}),a.$on("sidebar-nav:view:change",function(a){e()}),b.$on("$routeChangeSuccess",function(a){e()}),$(document).ready(function(){e()}),$(window).on("resize",function(){e()})}}]).directive("dfVerbPicker",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:{allowedVerbs:"=?",allowedVerbMask:"=?",description:"=?",size:"@"},templateUrl:a+"views/df-verb-picker.html",link:function(a,b,c){a.verbs={GET:{name:"GET",active:!1,description:" (read)",mask:1},POST:{name:"POST",active:!1,description:" (create)",mask:2},PUT:{name:"PUT",active:!1,description:" (replace)",mask:4},PATCH:{name:"PATCH",active:!1,description:" (update)",mask:8},DELETE:{name:"DELETE",active:!1,description:" (remove)",mask:16}},a.btnText="None Selected",a.description=!0,a._setVerbState=function(b,c){var d=a.verbs[b];a.verbs.hasOwnProperty(d.name)&&(a.verbs[d.name].active=c)},a._toggleVerbState=function(b,c){c.stopPropagation(),a.verbs.hasOwnProperty(a.verbs[b].name)&&(a.verbs[b].active=!a.verbs[b].active,a.allowedVerbMask=a.allowedVerbMask^a.verbs[b].mask),a.allowedVerbs=[],angular.forEach(a.verbs,function(b){b.active&&a.allowedVerbs.push(b.name)})},a._isVerbActive=function(b){return a.verbs[b].active},a._setButtonText=function(){var b=[];angular.forEach(a.verbs,function(a){a.active&&b.push(a.name)}),a.btnText="";var c=1;0==b.length?a.btnText="None Selected":b.length>0&&b.length<=c?angular.forEach(b,function(c,d){a._isVerbActive(c)&&(d!=b.length-1?a.btnText+=c+", ":a.btnText+=c)}):b.length>c&&(a.btnText=b.length+" Selected")},a.$watch("allowedVerbs",function(b,c){return b?(Object.keys(a.verbs).forEach(function(b){a._setVerbState(b,!1)}),angular.forEach(a.allowedVerbs,function(b,c){a._setVerbState(b,!0)}),void a._setButtonText()):!1}),a.$watch("allowedVerbMask",function(b,c){return null==b&&void 0==b?!1:(angular.forEach(a.verbs,function(a){b&a.mask&&(a.active=!0)}),void a._setButtonText())}),b.css({display:"inline-block",position:"relative"})}}}]).directive("dfRequestorPicker",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:{allowedRequestors:"=?",allowedRequestorMask:"=?",size:"@"},templateUrl:a+"views/df-requestor-picker.html",link:function(a,b,c){a.requestors={API:{name:"API",active:!1,mask:1},SCRIPT:{name:"SCRIPT",active:!1,mask:2}},a.btnText="None Selected",a._setRequestorState=function(b,c){var d=a.requestors[b];a.requestors.hasOwnProperty(d.name)&&(a.requestors[d.name].active=c)},a._toggleRequestorState=function(b,c){c.stopPropagation(),a.requestors.hasOwnProperty(a.requestors[b].name)&&(a.requestors[b].active=!a.requestors[b].active,a.allowedRequestorMask=a.allowedRequestorMask^a.requestors[b].mask),a.allowedRequestors=[],angular.forEach(a.requestors,function(b){b.active&&a.allowedRequestors.push(b.name)})},a._isRequestorActive=function(b){return a.requestors[b].active},a._setButtonText=function(){var b=[];angular.forEach(a.requestors,function(a){a.active&&b.push(a.name)}),a.btnText="",0==b.length?a.btnText="None Selected":angular.forEach(b,function(c,d){a._isRequestorActive(c)&&(d!=b.length-1?a.btnText+=c+", ":a.btnText+=c)})},a.$watch("allowedRequestors",function(b,c){return b?(angular.forEach(a.allowedRequestors,function(b,c){a._setRequestorState(b,!0)}),void a._setButtonText()):!1}),a.$watch("allowedRequestorMask",function(b,c){return null==b&&void 0==b?!1:(angular.forEach(a.requestors,function(a){b&a.mask&&(a.active=!0)}),void a._setButtonText())}),b.css({display:"inline-block",position:"absolute"})}}}]).directive("dfServicePicker",["MOD_UTILITY_ASSET_PATH","INSTANCE_URL","$http",function(a,b,c){return{restrict:"E",scope:{services:"=?",selected:"=?"},templateUrl:a+"views/df-service-picker.html",link:function(a,d,e){a.resources=[],a.activeResource=null,a.activeService=null,a.setServiceAndResource=function(){a._checkForActive()&&a._setServiceAndResource()},a._getResources=function(){return c({method:"GET",url:b+"/api/v2/"+a.activeService})},a._setServiceAndResource=function(){a.selected={service:a.activeService,resource:a.activeResource}},a._checkForActive=function(){return!!a.activeResource&&a.activeService},a.$watch("activeService",function(b,c){return b?(a.resources=[],void a._getResources().then(function(b){a.resources=b.data.resource},function(a){throw{module:"DreamFactory Utility Module",type:"error",provider:"dreamfactory",exception:a}})):(a.resources=[],a.activeResource=null,!1)})}}}]).directive("dfDbTablePicker",["MOD_UTILITY_ASSET_PATH","INSTANCE_URL","$http","dfApplicationData",function(a,b,c,d){return{restrict:"E",scope:{services:"=?",selected:"=?"},templateUrl:a+"views/df-db-table-picker.html",link:function(a,c,e){a.resources=[],a.activeResource=null,a.activeService=null,a.setServiceAndResource=function(){a._checkForActive()&&a._setServiceAndResource()},a._getResources=function(){return d.getServiceComponents(a.activeService,b+"/api/v2/"+a.activeService+"/_table/",{params:{fields:"name,label"}})},a._setServiceAndResource=function(){a.selected={service:a.activeService,resource:a.activeResource}},a._checkForActive=function(){return!!a.activeResource&&a.activeService},a.$watch("activeService",function(b,c){return b?(a.resources=[],void a._getResources().then(function(b){a.resources=b},function(a){throw{module:"DreamFactory Utility Module",type:"error",provider:"dreamfactory",exception:a}})):(a.resources=[],a.activeResource=null,!1)})}}}]).directive("dfDbSchemaPicker",["MOD_UTILITY_ASSET_PATH","INSTANCE_URL","$http",function(a,b,c){return{restrict:"E",scope:{services:"=?",selected:"=?"},templateUrl:a+"views/df-db-schema-picker.html",link:function(a,d,e){a.resources=[],a.activeResource=null,a.activeService=null,a.setServiceAndResource=function(){a._checkForActive()&&a._setServiceAndResource()},a._getResources=function(){return c({method:"GET",url:b+"/api/v2/"+a.activeService+"/_schema/"})},a._setServiceAndResource=function(){a.selected={service:a.activeService,resource:a.activeResource}},a._checkForActive=function(){return!!a.activeResource&&a.activeService},a.$watch("activeService",function(b,c){return b?(a.resources=[],void a._getResources().then(function(b){a.resources=b.data.resource},function(a){throw{module:"DreamFactory Utility Module",type:"error",provider:"dreamfactory",exception:a}})):(a.resources=[],a.activeResource=null,!1)})}}}]).directive("dfAceEditor",["INSTANCE_URL","MOD_UTILITY_ASSET_PATH","$http","$compile",function(a,b,c,d){return{restrict:"E",scope:{directData:"=?",currentEditor:"=?",serviceName:"=?",fileName:"=?",filePath:"=?",isUserCustom:"=?",isClean:"=?",isEditable:"=?"},templateUrl:b+"views/df-ace-editor.html",link:function(b,e,f){var g=$(e),h=Math.floor(100*Math.random()+1);g.children(".ide-attach").append(d('<div id="ide_'+h+'" class="df-fs-height" style="height:400px"></div>')(b)),
b.editor=null,b.currentScriptObj="",b.backupDoc="",b._getFileFromServer=function(b){return c({method:"GET",url:a+"/rest"+b.serviceName+"/"+b.fileName,cache:!1,params:b.params})},b._saveFileOnServer=function(b){return c({method:"PUT",url:a+"/rest"+b.serviceName+"/"+b.fileName,headers:{"Content-Type":"text/plain"},data:{post_body:b.body}})},b._deleteFileOnServer=function(b){return c({method:"DELETE",url:a+"/rest"+b.serviceName+"/"+b.fileName,params:{script_id:b.scriptId}})},b._setEditorInactive=function(a){a?(b.editor.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1}),b.editor.renderer.$cursorLayer.element.style.opacity=0):(b.editor.setOptions({readOnly:!1,highlightActiveLine:!0,highlightGutterLine:!0}),b.editor.renderer.$cursorLayer.element.style.opacity=100)},b._loadEditor=function(a,c,d){d=d||!1,b.editor=ace.edit("ide_"+h),c?b.editor.session.setMode("ace/mode/json"):b.editor.session.setMode("ace/mode/javascript"),b._setEditorInactive(d),b.editor.session.setValue(a),b.editor.focus(),b.editor.on("input",function(){b.$apply(function(){b.isClean=b.editor.session.getUndoManager().isClean()})}),b.editor.on("blur",function(){b.$apply(function(){try{b.directData=JSON.parse(b.editor.getValue())}catch(a){}})})},b._cleanEditor=function(){b.editor.session.getUndoManager().reset(),b.editor.session.getUndoManager().markClean()};var i=b.$watch("fileName",function(a,c){if("samples"===a)return!1;if(!a)return b._loadEditor("",!1,!0),!1;var d={serviceName:b.serviceName,fileName:a,params:{include_body:!0}};b._getFileFromServer(d).then(function(a){b.currentScript=a.data,b._loadEditor(a.data.script_body,!1)},function(a){b._loadEditor("",!1)})}),j=b.$watch("directData",function(a,c){return a?(a=angular.fromJson(a),a=JSON.stringify(a,null,"	"),b._loadEditor(a,!0,!b.isEditable),b.backupDoc=angular.copy(a),void(b.currentEditor=b.editor)):(b._loadEditor("",!1,!0),!1)},!0);b.$on("$destroy",function(a){i(),j()}),b.$on("save:script",function(a){var c={serviceName:b.serviceName,fileName:b.fileName,body:b.editor.getValue()||" "};b._saveFileOnServer(c).then(function(a){b._cleanEditor(),$(function(){new PNotify({title:"Scripts",type:"success",text:"Script saved successfully."})})},function(a){throw{module:"DreamFactory System Config Module",type:"error",provider:"dreamfactory",exception:a}})}),b.$on("delete:script",function(a){var c={serviceName:b.serviceName,fileName:b.fileName,scriptId:b.currentScriptObj.script_id};b._deleteFileOnServer(c).then(function(a){b.editor.setValue("",!1),b._cleanEditor(),$(function(){new PNotify({title:"Scripts",type:"success",text:"Script deleted successfully."})})},function(a){throw{module:"DreamFactory System Config Module",type:"error",provider:"dreamfactory",exception:a}})}),b.$on("load:direct",function(a,c){b._loadEditor(c,!1)}),b.$on("reload:script",function(a,c){b._loadEditor(b.backupDoc,c)})}}}]).directive("fileModel",["$parse",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.on("change",function(){b.$apply(function(){f(b,c[0].files[0])})})}}}]).directive("fileModel2",["$parse",function(a){return{restrict:"A",scope:!1,link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.on("change",function(){b.$apply(function(){f(b,c[0].files[0])})})}}}]).directive("showtab",[function(){return{restrict:"A",link:function(a,b,c){b.click(function(a){a.preventDefault(),$(b).tab("show")}),a.activeTab=$(b).attr("id")}}}]).directive("dfSectionToolbar",["MOD_UTILITY_ASSET_PATH","$compile","dfApplicationData","$location","$timeout","$route",function(a,b,c,d,e,f){return{restrict:"E",scope:!1,transclude:!0,templateUrl:a+"views/df-toolbar.html",link:function(a,b,c){a.changeFilter=function(b){e(function(){return b!==a.filterText&&a.filterText?void 0:(a.filterText=a.filterText||null,void d.search("filter",a.filterText))},1e3)},a.filterText=d.search()&&d.search().filter?d.search().filter:"",b.find("input")[0]&&b.find("input")[0].focus()}}}]).directive("dfToolbarViewModes",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:!1,replace:!0,templateUrl:a+"views/df-view-modes.html",link:function(a,b,c){a=a.$parent,a.viewMode=["list","thumbnails","table"],a.toggleViewMode=function(b){a._toggleViewMode(b)},a._toggleViewMode=function(b){a.currentViewMode=a.viewMode[b]}}}}]).directive("dfToolbarHelp",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:!1,replace:!0,templateUrl:a+"views/df-toolbar-help.html",link:function(a,b,c){a=a.$parent}}}]).directive("dfToolbarPaginate",["MOD_UTILITY_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify","$location",function(a,b,c,d,e){return{restrict:"E",scope:{api:"=",prepFunc:"=?"},replace:!0,templateUrl:a+"views/df-toolbar-paginate.html",link:function(a,f,g){a.totalCount=b.getApiData(a.api,"meta").count,a.pagesArr=[],a.currentPage={},a.isInProgress=!1,a.getPrevious=function(){return a._isFirstPage()||a.isInProgress?!1:void a._getPrevious()},a.getNext=function(){return a._isLastPage()||a.isInProgress?!1:void a._getNext()},a.getPage=function(b){a._getPage(b)},a.prepFunc=function(a){return a},a._getDataFromServer=function(c,d,e){var f={offset:c,include_count:!0};return d&&("filter"==d?f.filter=e:f.type=e),b.getDataSetFromServer(a.api,{params:f}).$promise},a._calcTotalPages=function(a,b){return Math.ceil(a/b)},a._createPageObj=function(b){return{number:b+1,value:b,offset:b*c.getPrefs().data[a.api].limit,stopPropagation:!1}},a._createPagesArr=function(b){a.pagesArr=[];for(var c=0;b>c;c++)a.pagesArr.push(a._createPageObj(c))},a._setCurrentPage=function(b){a.currentPage=b},a._getCurrentPage=function(){return!a.currentPage&&a.pagesArr.length>0?a.currentPage=a.pagesArr[0]:a.currentPage||a.pagesArr.length||(a.pagesArr.push(a._createPageObj(0)),a.currentPage=a.pagesArr[0]),a.currentPage},a._isFirstPage=function(){return 0===a._getCurrentPage().value},a._isLastPage=function(){return a.currentPage.value===a.pagesArr.length-1},a._previousPage=function(){a.currentPage=a.pagesArr[a.currentPage.value-1]},a._nextPage=function(){a.currentPage=a.pagesArr[a.currentPage.value+1]},a._calcPagination=function(b){return a.pagesArr=[],0==a.totalCount?(a.pagesArr.push(a._createPageObj(0)),!1):void a._createPagesArr(a._calcTotalPages(a.totalCount,c.getPrefs().data[b].limit))};var h=function(){var a=e.search()&&e.search().filter?e.search().filter:void 0;if(!a)return!1;var b=["first_name","last_name","name","email"];return b.map(function(b){return b+' like "%'+a+'%"'}).join(" or ")};a._getPrevious=function(){if(a.isInProgress)return!1;a.isInProgress=!0;var b=a.pagesArr[a.currentPage.value-1].offset,c=h(),e=c?a._getDataFromServer(b,"filter",c):a._getDataFromServer(b);e.then(function(b){a.linkedData=a.prepFunc({dataArr:b.record}),a._previousPage(),a.$emit("toolbar:paginate:"+a.api+":update")},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){a.isInProgress=!1})},a._getNext=function(){if(a.isInProgress)return!1;a.isInProgress=!0;var b=a.pagesArr[a.currentPage.value+1].offset,c=h(),e=c?a._getDataFromServer(b,"filter",c):a._getDataFromServer(b);e.then(function(b){a.linkedData=a.prepFunc({dataArr:b.record}),a._nextPage(),a.$emit("toolbar:paginate:"+a.api+":update")},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){a.isInProgress=!1})},a._getPage=function(b){if(a.isInProgress)return!1;a.isInProgress=!0;var c=h(),e=c?a._getDataFromServer(b.offset,"filter",c):a._getDataFromServer(b.offset);e.then(function(c){a._setCurrentPage(b),a.$emit("toolbar:paginate:"+a.api+":update")},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){a.isInProgress=!1})};a.$watch("api",function(b,c){return b?(a._calcPagination(b),void a._setCurrentPage(a.pagesArr[0])):!1});a.$on("toolbar:paginate:"+a.api+":reset",function(c){if("/logout"!==e.path()){if(a.isInProgress)return!1;a.isInProgress=!0;var f=h(),g=f?a._getDataFromServer(0,"filter",f):a._getDataFromServer(0);g.then(function(c){a.totalCount=b.getApiData(a.api,"meta").count,a._calcPagination(a.api),a._setCurrentPage(a.pagesArr[0]),a.$emit("toolbar:paginate:"+a.api+":update")},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){a.isInProgress=!1})}}),a.$on("toolbar:paginate:"+a.api+":delete",function(e){if(!a.isInProgress){var f=a.currentPage.offset,g=!1;a._isLastPage()&&!b.getApiData(a.api).length&&(g=!0,1!==a.currentPage.number&&(f=a.currentPage.offset-c.getPrefs().data[a.api].limit)),a.isInProgress=!0,a._getDataFromServer(f).then(function(c){a.totalCount=b.getApiData(a.api,"meta").count,g&&(a._calcPagination(a.api),a._setCurrentPage(a.pagesArr[a.pagesArr.length-1])),a.$emit("toolbar:paginate:"+a.api+":update")},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){a.isInProgress=!1})}})}}}]).directive("dfDetailsHeader",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:{"new":"=",name:"=?",apiName:"=?"},template:'<div class="df-section-header df-section-all-round"><h4 data-ng-if="new">Create {{apiName}}</h4><h4 data-ng-if="!new">Edit {{name}}</h4></div>',link:function(a,b,c){}}}]).directive("dfSectionHeader",[function(){return{restrict:"E",scope:{title:"=?"},template:'<div class="df-section-header df-section-all-round"><h4>{{title}}</h4></div>',link:function(a,b,c){}}}]).directive("dfSetUserPassword",["MOD_USER_ASSET_PATH","$compile","dfStringService",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/df-input-manual-password.html",link:function(a,d,e){a.verifyPassword="",a.updatePassword=!1,a.setPassword=!1,a.identical=!0,a._verifyPassword=function(b){b=b||a.user.record.password,a.identical=c.areIdentical(b,a.verifyPassword)},a._resetUserPasswordForm=function(){a.verifyPassword="",a.setPassword=!1};var f=a.$watch("setPassword",function(c,d){if(!c)return!1;var e="";a.updatePassword?(e+='<div class="form-group"><input type="password" id="old-password" class="form-control" data-ng-model="password.old_password" placeholder="Enter Old Password" /></div>',e+='<div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="password" name="password" placeholder="Enter Password" data-ng-model="password.new_password" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword(password.new_password)" ></div><div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="verify-password" name="verify-password" placeholder="Verify Password" data-ng-model="verifyPassword" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword(password.new_password)" ></div>'):e+='<div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="password" name="password" placeholder="Enter Password" data-ng-model="user.record.password" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword()" ></div><div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="verify-password" name="verify-password" placeholder="Verify Password" data-ng-model="verifyPassword" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword()" ></div>';var f=b(e)(a);angular.element("#set-password").append(f)});a.$on("reset:user:form",function(b){a._resetUserPasswordForm()}),a.$on("$destroy",function(a){f()})}}}]).directive("dfSetSecurityQuestion",["MOD_UTILITY_ASSET_PATH","$compile",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-set-security-question.html",link:function(a,c,d){a.setQuestion=!1;a.$watch("setQuestion",function(c,d){if(!c)return!1;var e="";e+='<div class="form-group"></div><label for="user-security-question">Security Question</label><input type="text" id="user-security-question" data-ng-model="user.record.security_question" class="form-control" placeholder="Enter security question" /></div><div class="form-group"></div><label for="user-security-answer">Security Answer</label><input type="text" id="user-security-answer" data-ng-model="user.record.security_answer" class="form-control" placeholder="Enter security answer" /></div>',angular.element("#set-question").append(b(e)(a))})}}}]).directive("dfDownloadSdk",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:{btnSize:"=?"},templateUrl:a+"views/df-download-sdk.html",link:function(a,b,c){a.sampleAppLinks=[{label:"Android",href:"https://github.com/dreamfactorysoftware/android-sdk",icon:""},{label:"iOS Objective-C",href:"https://github.com/dreamfactorysoftware/ios-sdk",icon:""},{label:"iOS Swift",href:"https://github.com/dreamfactorysoftware/ios-swift-sdk",icon:""},{label:"JavaScript",href:"https://github.com/dreamfactorysoftware/javascript-sdk",icon:""},{label:"AngularJS",href:"https://github.com/dreamfactorysoftware/angular-sdk",icon:""},{label:"Angular 2",href:"https://github.com/dreamfactorysoftware/angular2-sdk",icon:""},{label:"Titanium",href:"https://github.com/dreamfactorysoftware/titanium-sdk",icon:""},{label:"ReactJS",href:"https://github.com/dreamfactorysoftware/reactjs-sdk",icon:""},{label:".NET",href:"https://github.com/dreamfactorysoftware/.net-sdk",icon:""}]}}}]).directive("dfEmptySection",["MOD_UTILITY_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-empty-section.html"}}]).directive("dfEmptySearchResult",["MOD_UTILITY_ASSET_PATH","$location",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-empty-search-result.html",link:function(a,c,d){b.search()&&b.search().filter&&(a.$parent.filterText=b.search()&&b.search().filter?b.search().filter:null)}}}]).directive("__dfMainLoading",["MOD_UTILITY_ASSET_PATH","dfApplicationData","$interval",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/df-main-loading.html",link:function(a,d,e){a.text={operation:"Loading",module:null},a.moduleNames=["Services","Apps","Roles","System","Users","Config","Email Templates","Lookup Keys","CORS Config","App Groups","Events","Current User"];var f=null;a.dfmlStart=function(){a._dfmlStart()},a.dfmlUpdate=function(){a._dfmlUpdate()},a.dfmlFinish=function(){a._dfmlFinish()},a._setProgressBar=function(a){$(".progress-bar").css({width:a+"%"})},a._getModuleName=function(b){switch(b){case"service":return a.moduleNames[0];case"app":return a.moduleNames[1];case"role":return a.moduleNames[2];case"system":return a.moduleNames[3];case"user":return a.moduleNames[4];case"config":return a.moduleNames[5];case"email_template":return a.moduleNames[6];case"lookup":return a.moduleNames[7];case"cors":return a.moduleNames[8];case"app_group":return a.moduleNames[9];case"event":return a.moduleNames[10];case"Current User":return a.moduleNames[11]}},a._getOpName=function(a){switch(a){case"loading":return"Loading"}},a._loadingDots=function(){var a=0;f=c(function(){a++,3>=a?(console.log(a),$("#loading-dots").append(".")):($("#loading-dots").html(""),console.log("reset"),a=0)},500,0,!1)},a._dfmlStart=function(){a.text.module=a._getModuleName(b.getMainLoadData().loadData.module),$(d).find("small").html(a.text.module),a._setProgressBar(0),$.each($(d).children(),function(a,b){$(b).show()})},a._dfmlUpdate=function(){var c=b.getMainLoadData().loadData;a.text.module=a._getModuleName(c.module),$(d).find("h1").html(a.text.operation),$(d).find("p").html(a.text.module),a._setProgressBar(c.percent)},a._dfmlFinish=function(){$(d).children().hide(),a._setProgressBar(0),c.cancel(f)},a.$on("dfml:start",function(b,c){a.dfmlStart()}),a.$on("dfml:update",function(b,c){a.dfmlUpdate()}),a.$on("dfml:finish",function(b,c){a.dfmlFinish()})}}}]).service("dfMainLoading",["$timeout","$window",function(a,b){function c(a){return 100/a}function d(a){$(".progress-bar").css({width:a+"%"})}var e="dreamfactoryApp",f="df-main-loading-container",g="df-loading-title",h='<div id="'+f+'" class="col-xs-10 col-sm-6 col-md-4 col-xs-offset-1 col-sm-offset-3 col-md-offset-4 df-main-loading df-auth-container"><div class="panel panel-default"><div class="panel-heading"><span id="'+g+'"></span>&nbsp;<span id="loading-dots"></span></div><div class="panel-body"><!--<h1 class="df-main-loading">{{text.operation}}</h1>--><p></p><div style="clear: both"></div><div class="progress"><div class="progress-bar df-main-loading-bar progress-bar-striped active" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" ><span class="sr-only"></span></div></div></div></div></div>';return{percentIncrease:0,currentPercent:0,start:function(a){this.percentIncrease=c(a),$("#"+e).append(h)},update:function(a){this.currentPercent+=this.percentIncrease,d(this.currentPercent),$("#"+g).html(a.substr(0,1).toUpperCase()+a.substr(1,a.length).split("_").join(" "))},finish:function(a){this.currentPercent+=this.percentIncrease,d(this.currentPercent),$("#"+f).remove(),this.currentPercent=0}}}]).directive("dfPopupLogin",["MOD_UTILITY_ASSET_PATH","$compile","$location","UserEventsService",function(a,b,c,d){return{restrict:"A",scope:!1,link:function(a,e,f){a.popupLoginOptions={showTemplate:!0},a.openLoginWindow=function(b){a._openLoginWindow(b)},a._openLoginWindow=function(c){var d='<div id="df-login-frame" style="overflow: hidden; position: absolute; top:0; z-index:99999; background: rgba(0, 0, 0, .8); width: 100%; height: 100%"><div style="padding-top: 120px;"><dreamfactory-user-login data-in-err-msg="errormsg.data.error.message" data-options="popupLoginOptions"></dreamfactory-user-login></div></div>';$("#popup-login-container").html(b(d)(a))},a.$on(d.login.loginSuccess,function(a,b){a.stopPropagation(),$("#df-login-frame").remove()}),a.$on(d.login.loginError,function(a,b){$("#df-login-frame").remove(),c.url("/logout")})}}}]).directive("dfCopyrightFooter",["MOD_UTILITY_ASSET_PATH","APP_VERSION",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-copyright-footer.html",link:function(a,c,d){a.version=b}}}]).service("dfRouteChecker",["UserDataService","SystemConfigDataService","$location",function(a,b,c){return function(){var d=a.getCurrentUser();b.getSystemConfig();d?d&&!d.is_sys_admin&&c.url("/launchpad"):c.url("/login")}}]).service("dfObjectService",["dfStringService",function(a){return{mergeDiff:function(a,b){for(var c in a)b.hasOwnProperty(c)||"$"===c.substr(0,1)||(b[c]=a[c]);return b},mergeObjects:function(a,b){for(var c in a)b[c]=a[c];return b},deepMergeObjects:function(a,b){var c=this;for(var d in a)if(b.hasOwnProperty(d))switch(Object.prototype.toString.call(b[d])){case"[object Object]":b[d]=c.deepMergeObjects(a[d],b[d]);break;case"[object Array]":b[d]=a[d];break;default:b[d]=a[d]}return b},compareObjectsAsJson:function(b,c){return a.areIdentical(angular.toJson(b),angular.toJson(c))},compareObjects:function(a,b){var c,d=Object.keys(a).sort(),e=Object.keys(b).sort();if(d.length!==e.length)return console.log("not the same nr of keys"),!1;if(d.join("")!==e.join(""))return console.log("different keys"),!1;for(c=0;c<d.length;++c)if(a[d[c]]instanceof Array){if(!(b[d[c]]instanceof Array))return console.log("first array"),!1;if(b[d[c]].sort().join("")!==a[d[c]].sort().join(""))return console.log("secound array"),!1}else if(a[d[c]]instanceof Date){if(!(b[d[c]]instanceof Date))return console.log("date 1"),!1;if(""+a[d[c]]!=""+b[d[c]])return console.log("date 2"),!1}else if(a[d[c]]instanceof Function){if(!(b[d[c]]instanceof Function))return console.log("func 1"),!1}else if(a[d[c]]instanceof Object){if(!(b[d[c]]instanceof Object))return console.log("obj 1"),!1;if(a[d[c]]===a){if(b[d[c]]!==b)return console.log("date 2"),!1}else if(this.compareObjects(a[d[c]],b[d[c]])===!1)return console.log("something else"),!1}return!0}}}]).service("dfStringService",[function(){return{areIdentical:function(a,b){function c(a,b){return a.length==b.length}function d(a,b){for(var c=Math.min(a.length,b.length),d=0;c>d;d++)if(a.charAt(d)!==b.charAt(d))return!1;return!0}return a=a||"",b=b||"",c(a,b)&&d(a,b)?!0:!1}}}]).service("SystemConfigDataService",["INSTANCE_URL",function(a){function b(){var b;if(b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.open("GET",a+"/api/v2/system/environment",!1),b.setRequestHeader("X-DreamFactory-API-Key","6498a8ad1beb9d84d63035c5d1120c007fad6de706734db9689f8996707e0f7d"),b.setRequestHeader("Content-Type","application/json"),b.send(),4==b.readyState&&200==b.status)return angular.fromJson(b.responseText);throw{module:"DreamFactory System Config Module",type:"error",provider:"dreamfactory",exception:"XMLHTTPRequest Failure:  _getSystemConfigFromServer() Failed retrieve config.  Please contact your system administrator."}}function c(){return e}function d(a){e=a}var e={};return{getSystemConfigFromServerSync:function(){return b()},getSystemConfig:function(){return c()},setSystemConfig:function(a){d(a)}}}]).service("XHRHelper",["INSTANCE_URL","ADMIN_API_KEY","$cookies",function(a,b,c){function d(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function e(a,d){a.setRequestHeader("X-DreamFactory-API-Key",b),a.setRequestHeader("X-DreamFactory-Session-Token",c.PHPSESSID);for(var e in d)a.setRequestHeader(e,d[e])}function f(a){var b="";if(!d(a)){b="?";for(var c in a)b+=c+"="+a[c]+"&"}return""!==b&&(b=b.substring(0,b.length-1),encodeURI(b)),b}function g(b,c,d,g,h,i){var j;j=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var k=f(g);return j.open(b,a+"/api/v2/"+c+k,d),e(j,h),j.overrideMimeType(i),j.send(),4===j.readyState?j:void 0}function h(a){if(!a.url||""===a.url)throw{module:"DreamFactory Utility Module",type:"error",provider:"dreamfactory",exception:"XHRHelper Request Failure: No URL provided"};var b={method:"GET",url:"",async:!1,params:{},headers:{},mimeType:"application/json"};for(var c in b)a.hasOwnProperty(c)&&(b[c]=a[c]);return g(b.method,b.url,b.async,b.params,b.headers,b.mimeType)}return{ajax:function(a){return h(a)}}}]).service("dfSessionStorage",[function(){return{setItem:function(a,b){sessionStorage.setItem(a,b)},getItem:function(a){return sessionStorage.hasOwnProperty(a)?sessionStorage.getItem(a):!1},removeItem:function(a){return sessionStorage.hasOwnProperty(a)&&!sessionStorage.removeItem(a)?!0:!1}}}]).service("dfNotify",["dfApplicationPrefs",function(a){function b(a){!function(){PNotify.prototype.options.styling="fontawesome",new PNotify({title:a.module,type:a.type,text:a.message,addclass:"stack_topleft",animation:"fade",animate_speed:150,position_animate_speed:150,stack:e,mouse_reset:!1})}()}function c(a){var b="";return"[object String]"===Object.prototype.toString.call(a)?b=a:b+=a.data.error.message,b}function d(a,b){switch(b){case"message":return c(a.message);default:return a.message=c(a.message),a}}var e={dir1:"down",dir2:"right",push:"top",firstpos1:25,firstpos2:25,spacing1:5,spacing2:5};({dir1:"down",dir2:"left",context:$("#stack-context")});return{success:function(c){switch(a.getPrefs().application.notificationSystem.success){case"pnotify":b(c);break;case"browserAlert":alert(c.message);break;case"browserLog":console.log(c.message);break;case"dfModalNotify":console.log("dfModalNotfiy");break;default:console.log("browserAlert")}},error:function(c){switch(a.getPrefs().application.notificationSystem.error){case"pnotify":c.message=d(c,"message"),b(c);break;case"browserAlert":alert(d(c,"message"));break;case"browserLog":console.error(d(c,"message"));break;case"dfModalNotify":console.log("dfModalNotfiy");break;default:console.log("browserAlert")}},warn:function(c){switch(a.getPrefs().application.notificationSystem.warn){case"pnotify":b(c);break;case"browserAlert":alert(c);break;case"browserLog":console.error(c);break;case"dfModalNotify":console.log("dfModalNotfiy");break;default:console.log("browserAlert")}},confirmNoSave:function(){return confirm("Continue without saving?")},confirm:function(c){switch(a.getPrefs().application.notificationSystem.confirm){case"pnotify":return b(options);default:return confirm(c)}},alert:function(a){alert(a)}}}]).service("dfIconService",[function(){return function(){return{launchpad:"fa fa-fw fa-bars",admin:"fa fa-fw fa-cog",login:"fa fa-fw fa-sign-in",logout:"fa fa-fw fa-sign-out",register:"fa fa-fw fa-group",profile:"fa fa-fw fa-user"}}}]).service("dfServerInfoService",["$window",function(a){return{currentServer:function(){return a.location.origin}}}]).service("dfReplaceParams",["UserDataService","$window",function(a,b){return function(c,d){var e="",f=c;if(-1!==c.indexOf("?")){var g=c.split("?");f=g[0];var h=g[1];h=h.split("&"),$.each(h,function(c,f){if(f){e+=""===e?"?":"&";var g=f.split("=");if(1<g.length){var h=g.shift(),i=g.join("=");switch(i){case"{session_id}":case"{ticket}":case"{first_name}":case"{last_name}":case"{display_name}":case"{email}":i=i.substring(1,i.length-1),i=a.getCurrentUser()[i];break;case"{user_id}":i=a.getCurrentUser().id;break;case"{app_name}":i=d;break;case"{server_url}":i=b.location.origin}e+=h+"="+i}else e+=f}})}return f+e}}]).filter("orderAndShowSchema",[function(){return function(a,b,c){var d=[];return angular.forEach(b,function(b){angular.forEach(a,function(a){a.name===b.name&&1==b.active&&d.push(a)})}),c&&d.reverse(),d}}]).filter("orderAndShowValue",[function(){return function(a,b,c){var d=[];return angular.forEach(b,function(b){for(var c in a)c===b.name&&1==b.active&&d.push(a[c])}),c&&d.reverse(),d}}]).filter("orderObjectBy",[function(){return function(a,b,c){function d(a,b){return a==b?0:b>a?-1:1}var e=[];if(angular.forEach(a,function(a){e.push(a)}),0===e.length)return e;var f=e[0].record?e[0].record[b]:e[0][b];switch(typeof f){case"number":e.sort(function(a,c){return a.hasOwnProperty("record")&&c.hasOwnProperty("record")?(a=a.record[b],c=c.record[b]):(a=a[b],c=c[b]),a=null===a||void 0===a?0:a,c=null===c||void 0===c?0:c,d(Number(a),Number(c))});break;case"string":e.sort(function(a,c){a.hasOwnProperty("record")&&c.hasOwnProperty("record")?(a=a.record[b],c=c.record[b]):(a=a[b],c=c[b]),a=null===a||void 0===a?"":a,c=null===c||void 0===c?"":c;var d=a.toUpperCase(),e=c.toUpperCase();return e>d?-1:d>e?1:0});break;default:e.sort(function(a,c){a.hasOwnProperty("record")&&c.hasOwnProperty("record")?(a=a.record[b],c=c.record[b]):(a=a[b],c=c[b]),a=null===a||void 0===a?"":a,c=null===c||void 0===c?"":c;var d=a,e=c;return e>d?-1:d>e?1:0})}return c&&e.reverse(),e}}]).filter("dfFilterBy",[function(){return function(a,b){if(!b.on)return a;var c=[];return b&&b.field&&b.value?(b.regex||(b.regex=new RegExp(b.value,"i")),angular.forEach(a,function(a){b.regex.test(a[b.field])&&c.push(a)}),c):a}}]).filter("dfOrderExplicit",[function(){return function(a,b){var c=[],d=0;return angular.forEach(a,function(a,e){a.name===b[d]&&c.push(a),d++}),c}}]),angular.module("dfSystemConfig",["ngRoute","dfUtility","dfApplication"]).constant("MODSYSCONFIG_ROUTER_PATH","/config").constant("MODSYSCONFIG_ASSET_PATH","admin_components/adf-system-config/").config(["$routeProvider","MODSYSCONFIG_ROUTER_PATH","MODSYSCONFIG_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"SystemConfigurationCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["SystemConfigDataService",function(a){}]).controller("SystemConfigurationCtrl",["$scope","dfApplicationData","SystemConfigEventsService","SystemConfigDataService","dfObjectService","dfNotify","INSTANCE_URL","$http",function(a,b,c,d,e,f,g,h){var i=function(a){return{record:angular.copy(a),recordCopy:angular.copy(a)}};a.getCacheEnabledServices=function(){a.cacheEnabledServices=[],h.get(g+"/api/v2/system/cache?fields=*").then(function(b){a.cacheEnabledServices=b.data.resource},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};f.error(b)})},a.$parent.title="Config",a.es=c.systemConfigController,a.systemEnv=b.getApiData("environment"),a.systemConfig=new i(b.getApiData("config")[0]),a.getCacheEnabledServices(),a.corsEntriesData=b.getApiData("cors"),a.globalLookupsData=b.getApiData("lookup"),a.emailTemplatesData=b.getApiData("email_template"),a.links=[{name:"system-info",label:"System Info",path:"system-info",active:!0},{name:"cache",label:"Cache",path:"cache",active:!1},{name:"cors",label:"CORS",path:"cors",active:!1},{name:"email-templates",label:"Email Templates",path:"email-templates",active:!1},{name:"global-lookup-keys",label:"Global Lookup Keys",path:"global-lookup-keys",active:!1},{name:"edit-preferences",label:"Preferences",path:"edit-preferences"}],a.updateConfig=function(){a._updateConfig()},a._updateConfigData=function(a){return b.updateApiData("config",a).$promise},a._updateSystemConfigService=function(a){d.setSystemConfig(a)},a._prepareSystemConfigData=function(){a._prepareLookupKeyData()},a._updateConfig=function(){a._prepareSystemConfigData();var b={params:{fields:"*"},data:a.systemConfig.record};a._updateConfigData(b).then(function(b){var c=b;a._updateSystemConfigService(c),a.systemConfig=new i(b);var d={module:"Config",type:"success",provider:"dreamfactory",message:"System config updated successfully."};f.success(d),a.$emit(a.es.updateSystemConfigSuccess,c)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};f.error(b)})},a.$on("$locationChangeStart",function(b){e.compareObjectsAsJson(a.systemConfig.record,a.systemConfig.recordCopy)||f.confirmNoSave()||b.preventDefault()}),a.dfLargeHelp={systemInfo:{title:"System Info Overview",text:"Displays current system information."},cacheConfig:{title:"Cache Overview",text:"Flush system-wide cache or per-service caches. Use the cache clearing buttons below to refresh any changes made to your system configuration values."},corsConfig:{title:"CORS Overview",text:"Enter allowed hosts and HTTP verbs. You can enter * for all hosts. Use the * option for development to enable application code running locally on your computer to communicate directly with your DreamFactory instance."},emailTemplates:{title:"Email Templates Overview",text:"Create and edit email templates for User Registration, User Invite, Password Reset, and your custom email services."},globalLookupKeys:{title:"Global Lookup Keys Overview",text:'An administrator can create any number of "key value" pairs attached to DreamFactory. The key values are automatically substituted on the server. For example, you can use Lookup Keys in Email Templates, as parameters in external REST Services, and in the username and password fields to connect to a SQL or NoSQL database. Mark any Lookup Key as private to securely encrypt the key value on the server and hide it in the user interface.<span style="color: red;">  Note that Lookup Keys for REST service configuration and credentials must be private.</span>'}}}]).directive("dreamfactorySystemInfo",["MODSYSCONFIG_ASSET_PATH","INSTANCE_URL","APP_VERSION","$http","dfNotify",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:a+"views/system-info.html",link:function(a,b,d){a.upgrade=function(){window.top.location="http://wiki.dreamfactory.com/"},a.APP_VERSION=c}}}]).directive("dreamfactoryCacheConfig",["MODSYSCONFIG_ASSET_PATH","INSTANCE_URL","APP_VERSION","$http","dfNotify",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:a+"views/cache-config.html",link:function(a,c,f){a.flushSystemCache=function(){d["delete"](b+"/api/v2/system/cache").success(function(){var a={module:"Cache",type:"success",provider:"dreamfactory",message:"System-wide cache flushed."};e.success(a)}).error(function(a){var b={module:"Api Error",
type:"error",provider:"dreamfactory",message:{data:{error:[a.error]}}};e.error(b)})},a.flushServiceCache=function(c){d["delete"](b+"/api/v2/system/cache/"+a.cacheEnabledServices[c].name).success(function(){var b={module:"Cache",type:"success",provider:"dreamfactory",message:a.cacheEnabledServices[c].label+" service cache flushed."};e.success(b)}).error(function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:{data:{error:[a.error]}}};e.error(b)})}}}}]).directive("dreamfactoryCorsConfig",["MODSYSCONFIG_ASSET_PATH","dfApplicationData","dfNotify",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/cors-config.html",link:function(a,d,e){var f=function(a){function b(){return Math.floor(1e5*Math.random())}var c={id:null,origin:"NEW",path:null,method:[],enabled:!1};return a=a||c,{__dfUI:{newHost:null===a.id,tempId:b()},record:angular.copy(a),recordCopy:angular.copy(a)}};a.corsEntries=null,a.selectedCorsEntry=null,a.addCorsEntry=function(){a._addCorsEntry()},a.deleteCorsEntry=function(){c.confirm("Delete "+a.selectedCorsEntry.record.origin+"?")&&a._deleteCorsEntry()},a.saveCorsEntry=function(){var b=a.selectedCorsEntry;if(null==b){var d={module:"CORS",type:"warn",provider:"dreamfactory",message:"No host selected."};return c.warn(d),void angular.element("#select-cors-host").focus()}if(null===b.record.id){if("NEW"===b.record.origin){var d={module:"CORS",type:"warn",provider:"dreamfactory",message:"Entries should have a unique origin.  Please rename your origin to something other than the default 'new' origin name."};return void c.warn(d)}a._saveCorsEntry(b)}else a._updateCorsEntry(b)},a._saveCorsEntryToServer=function(a){return b.saveApiData("cors",a).$promise},a._updateCorsEntryToServer=function(a){return b.updateApiData("cors",a).$promise},a._deleteCorsEntryFromServer=function(a){return b.deleteApiData("cors",a).$promise},a._addCorsEntry=function(){a.corsEntries.push(new f),a.selectedCorsEntry=a.corsEntries[a.corsEntries.length-1]},a._deleteCorsEntry=function(){if(a.selectedCorsEntry.__dfUI.newHost){for(var b=0;b<a.corsEntries.length;){if(a.corsEntries[b].__dfUI.tempId===a.selectedCorsEntry.__dfUI.tempId){a.corsEntries.splice(b,1);break}b++}var d={module:"CORS",type:"success",provider:"dreamfactory",message:"CORS entry deleted successfully."};return c.success(d),void(a.selectedCorsEntry=null)}var e={params:{fields:"*"},data:a.selectedCorsEntry.record};a._deleteCorsEntryFromServer(e).then(function(b){var d={module:"CORS",type:"success",provider:"dreamfactory",message:"CORS entry deleted successfully."};c.success(d),a.selectedCorsEntry=null},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._saveCorsEntry=function(b){var d={params:{fields:"*"},data:b.record};a._saveCorsEntryToServer(d).then(function(b){var d={module:"CORS",type:"success",provider:"dreamfactory",message:"CORS entry created successfully."};c.success(d);for(var e=0;e<a.corsEntries.length;){if(a.corsEntries[e].record.origin===b.origin){var g=new f(b);a.corsEntries[e]=g,a.selectedCorsEntry=g}e++}},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._updateCorsEntry=function(b){var d={params:{fields:"*"},data:b.record};a._updateCorsEntryToServer(d).then(function(a){var b={module:"CORS",type:"success",provider:"dreamfactory",message:"CORS entry updated successfully."};c.success(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})};var g=a.$watch("corsEntries",function(c,d){null===c&&(a.corsEntries=[],angular.forEach(b.getApiData("cors"),function(b){a.corsEntries.push(new f(b))}))}),h=a.$watchCollection(function(){return b.getApiData("cors")},function(b,c){b&&(a.corsEntries=[],angular.forEach(b,function(b){a.corsEntries.push(new f(b))}))});a.$on("$destroy",function(a){g(),h()})}}}]).directive("dreamfactoryEmailTemplates",["MODSYSCONFIG_ASSET_PATH","dfApplicationData","dfNotify",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/email-templates.html",link:function(a,d,e){var f=function(a){function b(){return Math.floor(1e5*Math.random())}var c={bcc:null,body_html:null,body_text:null,cc:null,defaults:[],description:null,from_email:null,from_name:null,id:null,name:"NEW EMAIL TEMPLATE",replay_to_email:null,replay_to_name:null,subject:null,to:null};return a=a||c,{__dfUI:{newTemplate:null===a.id,tempId:b()},record:angular.copy(a),recordCopy:angular.copy(a)}};a.emailTemplates=null,a.selectedEmailTemplate=null,a.addEmailTemplate=function(){a._addEmailTemplate()},a.deleteEmailTemplate=function(){c.confirm("Delete "+a.selectedEmailTemplate.record.name+"?")&&a._deleteEmailTemplate()},a.saveEmailTemplate=function(){var b=a.selectedEmailTemplate;if(null==b){var d={module:"Email Templates",type:"warn",provider:"dreamfactory",message:"No email template selected."};return c.warn(d),void angular.element("#select-email-template").focus()}if(null===b.record.id){if("NEW EMAIL TEMPLATE"===b.record.name){var d={module:"Email Templates",type:"warn",provider:"dreamfactory",message:"Email templates should have a unique name.  Please rename your email template to something other than the default 'new' template name."};return void c.warn(d)}a._saveEmailTemplate(b)}else a._updateEmailTemplate(b)},a._saveEmailTemplateToServer=function(a){return b.saveApiData("email_template",a).$promise},a._updateEmailTemplateToServer=function(a){return b.updateApiData("email_template",a).$promise},a._deleteEmailTemplateFromServer=function(a){return b.deleteApiData("email_template",a).$promise},a._addEmailTemplate=function(){a.emailTemplates.push(new f),a.selectedEmailTemplate=a.emailTemplates[a.emailTemplates.length-1]},a._deleteEmailTemplate=function(){if(a.selectedEmailTemplate.__dfUI.newTemplate){for(var b=0;b<a.emailTemplates.length;){if(a.emailTemplates[b].__dfUI.tempId===a.selectedEmailTemplate.__dfUI.tempId){a.emailTemplates.splice(b,1);break}b++}var d={module:"Email Templates",type:"success",provider:"dreamfactory",message:"Email template deleted successfully."};return c.success(d),void(a.selectedEmailTemplate=null)}var e={params:{fields:"*"},data:a.selectedEmailTemplate.record};a._deleteEmailTemplateFromServer(e).then(function(b){var d={module:"Email Templates",type:"success",provider:"dreamfactory",message:"Email template deleted successfully."};c.success(d),a.selectedEmailTemplate=null},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._saveEmailTemplate=function(b){var d={params:{fields:"*"},data:b.record};a._saveEmailTemplateToServer(d).then(function(b){var d={module:"Email Templates",type:"success",provider:"dreamfactory",message:"Email template created successfully."};c.success(d);for(var e=0;e<a.emailTemplates.length;){if(a.emailTemplates[e].record.name===b.name){var g=new f(b);a.emailTemplates[e]=g,a.selectedEmailTemplate=g}e++}},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._updateEmailTemplate=function(b){var d={params:{fields:"*"},data:b.record};a._updateEmailTemplateToServer(d).then(function(a){var b={module:"Email Templates",type:"success",provider:"dreamfactory",message:"Email template updated successfully."};c.success(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})};var g=a.$watch("emailTemplates",function(c,d){null===c&&(a.emailTemplates=[],angular.forEach(b.getApiData("email_template"),function(b){a.emailTemplates.push(new f(b))}))}),h=a.$watchCollection(function(){return b.getApiData("email_template")},function(b,c){b&&(a.emailTemplates=[],angular.forEach(b,function(b){a.emailTemplates.push(new f(b))}))});a.$on("$destroy",function(a){g(),h()})}}}]).directive("dreamfactoryGlobalLookupKeys",["MODSYSCONFIG_ASSET_PATH","dfApplicationData","dfNotify",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/global-lookup-keys.html",link:function(a,d,e){var f=function(a){function b(){return Math.floor(1e5*Math.random())}var c={id:null,name:"NEW",value:null};return a=a||c,{__dfUI:{newLookup:null===a.id,tempId:b()},record:angular.copy(a),recordCopy:angular.copy(a)}};a.globalLookups=null,a.selectedLookup=null,a.addLookup=function(){a._addLookup()},a.deleteLookup=function(){c.confirm("Delete "+a.selectedLookup.record.name+"?")&&a._deleteLookup()},a.saveLookup=function(){var b=a.selectedLookup;if(null==b){var d={module:"Global Lookup Keys",type:"warn",provider:"dreamfactory",message:"No lookup key selected."};return c.warn(d),void angular.element("#select-global-lookup").focus()}if(null===b.record.id){if("NEW"===b.record.name){var d={module:"Global Lookup Keys",type:"warn",provider:"dreamfactory",message:"Lookup keys should have a unique name.  Please rename your key to something other than the default 'new' key name."};return void c.warn(d)}a._saveLookup(b)}else a._updateLookup(b)},a._saveLookupToServer=function(a){return b.saveApiData("lookup",a).$promise},a._updateLookupToServer=function(a){return b.updateApiData("lookup",a).$promise},a._deleteLookupFromServer=function(a){return b.deleteApiData("lookup",a).$promise},a._addLookup=function(){a.globalLookups.push(new f),a.selectedLookup=a.globalLookups[a.globalLookups.length-1]},a._deleteLookup=function(){if(a.selectedLookup.__dfUI.newLookup){for(var b=0;b<a.globalLookups.length;){if(a.globalLookups[b].__dfUI.tempId===a.selectedLookup.__dfUI.tempId){a.globalLookups.splice(b,1);break}b++}var d={module:"Global Lookup Keys",type:"success",provider:"dreamfactory",message:"Lookup key deleted successfully."};return c.success(d),void(a.selectedLookup=null)}var e={params:{fields:"*"},data:a.selectedLookup.record};a._deleteLookupFromServer(e).then(function(b){var d={module:"Global Lookup Keys",type:"success",provider:"dreamfactory",message:"Lookup key deleted successfully."};c.success(d),a.selectedLookup=null},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._saveLookup=function(b){var d={params:{fields:"*"},data:b.record};a._saveLookupToServer(d).then(function(b){var d={module:"Global Lookup Keys",type:"success",provider:"dreamfactory",message:"Lookup key created successfully."};c.success(d);for(var e=0;e<a.globalLookups.length;){if(a.globalLookups[e].record.name===b.name){var g=new f(b);a.globalLookups[e]=g,a.selectedLookup=g}e++}},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._updateLookup=function(b){var d={params:{fields:"*"},data:b.record};a._updateLookupToServer(d).then(function(a){var b={module:"Global Lookup Keys",type:"success",provider:"dreamfactory",message:"Lookup key updated successfully."};c.success(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})};var g=a.$watch("globalLookups",function(c,d){null===c&&(a.globalLookups=[],angular.forEach(b.getApiData("lookup"),function(b){a.globalLookups.push(new f(b))}))}),h=a.$watchCollection(function(){return b.getApiData("lookup")},function(b,c){b&&(a.globalLookups=[],angular.forEach(b,function(b){a.globalLookups.push(new f(b))}))});a.$on("$destroy",function(a){g(),h()})}}}]).directive("dfEditPreferences",["MODSYSCONFIG_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfPrefFactory","dfNotify",function(a,b,c,d,e){return{restrict:"E",scope:{},templateUrl:a+"views/df-edit-preferences.html",link:function(a,f,g){a.prefs={},a.viewModes=["list","thumbnails","table"],angular.forEach(c.getPrefs(),function(b,c){a.prefs[c]={},angular.forEach(b,function(b,e){a.prefs[c][e]=[],angular.forEach(b,function(b,f){a.prefs[c][e].push(d(f,b))})})}),a.savePrefs=function(){a._savePrefs()},a._savePrefsToServer=function(a){return b.saveAdminPrefs(a)},a._formatPrefs=function(){var b={};return angular.forEach(a.prefs,function(a,c){b[c]={},angular.forEach(a,function(a,d){b[c][d]={},angular.forEach(a,function(a){b[c][d][a.key]=a.value})})}),b},a._savePrefs=function(){var b=a._formatPrefs();a._savePrefsToServer(b).then(function(a){var d={module:"Preferences",type:"success",provider:"dreamfactory",message:"Preferences saved."};e.success(d),c.setPrefs(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};e.error(b)})}}}}]).factory("dfPrefFactory",[function(){return function(a,b){var c=function(a,b,c){return{type:a,key:b,value:c}};switch(Object.prototype.toString.call(b)){case"[object String]":return new c("string",a,b);case"[object Array]":return new c("array",a,b);case"[object Number]":return new c("number",a,b);case"[object Boolean]":return new c("boolean",a,b);case"[object Object":return new c("object",a,b)}}}]).service("SystemConfigEventsService",[function(){return{systemConfigController:{updateSystemConfigRequest:"update:systemconfig:request",updateSystemConfigSuccess:"update:systemconfig:success",updateSystemConfigError:"update:systemconfig:error"}}}]).service("SystemConfigDataService",["INSTANCE_URL",function(a){function b(){var b;if(b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.open("GET",a+"/api/v2/system/environment",!1),b.setRequestHeader("X-DreamFactory-API-Key","6498a8ad1beb9d84d63035c5d1120c007fad6de706734db9689f8996707e0f7d"),b.setRequestHeader("Content-Type","application/json"),b.send(),4==b.readyState&&200==b.status)return angular.fromJson(b.responseText);throw{module:"DreamFactory System Config Module",type:"error",provider:"dreamfactory",exception:"XMLHTTPRequest Failure:  _getSystemConfigFromServer() Failed retrieve config.  Please contact your system administrator."}}function c(){return e}function d(a){e=a}var e={};return{getSystemConfigFromServerSync:function(){return b()},getSystemConfig:function(){return c()},setSystemConfig:function(a){d(a)}}}]),angular.module("dfAdmins",["ngRoute","dfUtility","dfApplication","dfHelp"]).constant("MOD_ADMIN_ROUTER_PATH","/admins").constant("MOD_ADMIN_ASSET_PATH","admin_components/adf-admins/").config(["$routeProvider","MOD_ADMIN_ROUTER_PATH","MOD_ADMIN_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"AdminsCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("AdminsCtrl",["$scope","dfApplicationData","dfNotify",function(a,b,c){a.$parent.title="Admins",a.links=[{name:"manage-admins",label:"Manage",path:"manage-admins"},{name:"create-admin",label:"Create",path:"create-admin"}],a.emptySectionOptions={title:"You have no Admins!",text:"Click the button below to get started adding admins.  You can always create new admins by clicking the tab located in the section menu to the left.",buttonText:"Create An Admin!",viewLink:a.links[1]},a.emptySearchResult={title:"You have no Admins that match your search criteria!",text:""}}]).directive("dfAdminDetails",["MOD_ADMIN_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify","dfObjectService","INSTANCE_URL","$http","$cookies","UserDataService","$cookieStore",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",scope:{adminData:"=?",newAdmin:"=?"},templateUrl:a+"views/df-admin-details.html",link:function(a,f,k){var l=function(a){var b={name:null,first_name:null,last_name:null,email:null,phone:null,confirmed:!1,is_active:!0,user_source:0,user_data:[],password:null,user_lookup_by_user_id:[]};return a=a||b,{__dfUI:{selected:!1},record:angular.copy(a),recordCopy:angular.copy(a)}};a.admin=null,a.newAdmin&&(a.admin=new l),a.sendEmailOnCreate=!1,a._validateData=function(){return a.setPassword&&a.verifyPassword!==a.admin.record.password?(d.error({module:"Admins",type:"error",message:"Passwords not same."}),!1):!0},a.saveAdmin=function(){a._validateData()&&(a.newAdmin?a._saveAdmin():a._updateAdmin())},a.closeAdmin=function(){a._closeAdmin()},a._saveAdminToServer=function(a){return b.saveApiData("admin",a).$promise},a._updateAdminToServer=function(a){return b.updateApiData("admin",a).$promise},a._resetAdminDetails=function(){a.newAdmin?a.admin=new l:a.adminData=null},a._prepareAdminData=function(){a._prepareLookupKeyData()},a._saveAdmin=function(){a._prepareAdminData();var b={params:{fields:"*",related:"user_lookup_by_user_id",send_invite:a.sendEmailOnCreate},data:a.admin.record};a._saveAdminToServer(b).then(function(b){var c={module:"Admins",provider:"dreamfactory",type:"success",message:"Admin saved successfully."};d.success(c),a._resetUserPasswordForm(),a.admin=new l},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})},a._updateAdmin=function(){a._prepareAdminData();var b={params:{fields:"*",related:"user_lookup_by_user_id"},data:a.admin.record};a._updateAdminToServer(b).then(function(b){if(b.session_token){g.defaults.headers.common["X-DreamFactory-Session-Token"]=b.session_token,h.PHPSESSID=b.session_token;var e=i.getCurrentUser();e.session_token=b.session_token,e.session_id=b.session_token,j.put("CurrentUserObj",e)}var f={module:"Admins",provider:"dreamfactory",type:"success",message:"Admin updated successfully."};d.success(f),a._resetUserPasswordForm(),a.admin=new l(b),c.getPrefs().sections.admin.autoClose&&a.closeAdmin(),a.lookupKeys=a.lookupKeys.filter(function(a){return null!==a.record.user_id})},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})},a._closeAdmin=function(){return a._prepareAdminData(),e.compareObjectsAsJson(a.admin.record,a.admin.recordCopy)||d.confirmNoSave()?void a._resetAdminDetails():!1};var m=a.$watch("adminData",function(b,c){return b?void(a.admin=new l(b)):!1});a.$on("$destroy",function(a){m()}),a.dfHelp={adminConfirmation:{title:"Admin Confirmation Info",text:"Is the admin confirmed? You can send an invite to unconfirmed admins."},adminLookupKeys:{title:"Admin Lookup Keys Info",text:'The DreamFactory administrator can create any number of "key value" pairs attached to a admin. The key values are automatically substituted on the server. For example, key names can be used in the username and password fields required to hook up a SQL or NoSQL database. They can also be used in Email Templates or as parameters for external REST services. Any Lookup Key can be marked as private, and in this case the key value is securely encrypted on the server and is no longer accessible through the platform interface. Lookup keys for service configuration and credentials must be made private.'}}}}}]).directive("dfConfirmAdmin",["INSTANCE_URL","MOD_ADMIN_ASSET_PATH","$http","SystemConfigDataService","dfNotify",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:b+"views/df-input-confirm-admin.html",link:function(b,f,g){b.inviteAdminOnCreate=!1,b.systemConfig=d.getSystemConfig(),b.invite=function(){b._invite(b.admin.record.id)},b._sendInvite=function(b){return c({url:a+"/api/v2/system/admin",method:"PATCH",params:{send_invite:!0},data:{id:b}})},b._invite=function(a){b._sendInvite(a).then(function(a){var b={module:"Admins",type:"success",provider:"dreamfactory",message:"Admin invite has been sent."};e.success(b)},function(a){var b={module:"Admins",type:"error",provider:"dreamfactory",exception:a.data};e.error(b)})},b._callSendInvite=function(a){b.inviteAdminOnCreate&&b._invite(a.id)}}}}]).directive("dfAdminLookupKeys",["MOD_ADMIN_ASSET_PATH","dfStringService",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-input-lookup-keys.html",link:function(a,b,c){var d=function(a){var b={name:"",value:"","private":!1,allow_admin_update:!1};return{__dfUI:{unique:!0},record:angular.copy(a||b),recordCopy:angular.copy(a||b)}};a.lookupKeys=[],a.sameKeys=[],a.newKey=function(){a._newKey()},a.removeKey=function(b){a._removeKey(b)},a._isUniqueKey=function(){a.sameKeys=[],angular.forEach(a.lookupKeys,function(b,c){angular.forEach(a.lookupKeys,function(d,e){c!==e&&b.record.name===d.record.name&&a.sameKeys.push(b)})})},a._prepareLookupKeyData=function(){var b=[];angular.forEach(a.lookupKeys,function(a){b.push(a.record)}),a.admin.record.user_lookup_by_user_id=b},a._newKey=function(){a.lookupKeys.push(new d)},a._removeKey=function(b){void 0!==a.lookupKeys[b].record.user_id?a.lookupKeys[b].record.user_id=null:a.lookupKeys.splice(b,1)};var e=a.$watch("admin",function(b,c){b&&b.record.hasOwnProperty("user_lookup_by_user_id")&&b.record.user_lookup_by_user_id.length>0&&(a.lookupKeys=[],angular.forEach(b.record.user_lookup_by_user_id,function(b){a.lookupKeys.push(new d(b))}))}),f=a.$watch("sameKeys",function(b,c){return 0===b.length?void angular.forEach(a.lookupKeys,function(a){a.__dfUI.unique=!0}):void angular.forEach(a.lookupKeys,function(a){angular.forEach(b,function(b){a.record.name===b.record.name?a.__dfUI.unique=!1:a.__dfUI.unique=!0})})});a.$watchCollection("lookupKeys",function(b,c){b&&a._isUniqueKey()});a.$on("$destroy",function(a){e(),f()})}}}]).directive("dfManageAdmins",["MOD_ADMIN_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify","$location",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:a+"views/df-manage-admins.html",link:function(a,f,g){var h=function(a){return{__dfUI:{selected:!1},record:a}};a.uploadFile=null,a.currentViewMode=c.getPrefs().sections.admin.manageViewMode,a.admins=null,a.currentEditAdmin=null,a.fields=[{name:"id",label:"ID",active:!0},{name:"email",label:"Email",active:!0},{name:"name",label:"Display Name",active:!0},{name:"first_name",label:"First Name",active:!0},{name:"last_name",label:"Last Name",active:!0},{name:"is_active",label:"Active",active:!0},{name:"confirmed",label:"Confirmed",active:!0}],a.order={orderBy:"id",orderByReverse:!1},a.selectedAdmins=[],a.editAdmin=function(b){a._editAdmin(b)},a.deleteAdmin=function(b){d.confirm("Delete "+b.record.name+"?")&&a._deleteAdmin(b)},a.deleteSelectedAdmins=function(){d.confirm("Delete selected admins?")&&a._deleteSelectedAdmins()},a.orderOnSelect=function(b){a._orderOnSelect(b)},a.setSelected=function(b){a._setSelected(b)},a._deleteFromServer=function(a){return b.deleteApiData("admin",a).$promise},a._editAdmin=function(b){a.currentEditAdmin=b},a._deleteAdmin=function(b){var c={params:{id:b.record.id}};a._deleteFromServer(c).then(function(c){var e={module:"Admins",type:"success",provider:"dreamfactory",message:"Admin successfully deleted."};d.success(e),b.__dfUI.selected&&a.setSelected(b),a.$broadcast("toolbar:paginate:admin:delete")},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})},a._orderOnSelect=function(b){var c=a.order.orderBy;c===b.name?a.order.orderByReverse=!a.order.orderByReverse:(a.order.orderBy=b.name,a.order.orderByReverse=!1)},a._setSelected=function(b){for(var c=0;c<a.selectedAdmins.length;){if(b.record.id===a.selectedAdmins[c])return b.__dfUI.selected=!1,void a.selectedAdmins.splice(c,1);c++}b.__dfUI.selected=!0,a.selectedAdmins.push(b.record.id)},a._deleteSelectedAdmins=function(){var b={params:{ids:a.selectedAdmins.join(","),rollback:!0}};a._deleteFromServer(b).then(function(b){var c={module:"Admins",type:"success",provider:"dreamfactory",message:"Admins deleted successfully."};d.success(c),a.selectedAdmins=[],a.$broadcast("toolbar:paginate:admin:reset")},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})};var i=a.$watch("admins",function(c,d){if(null==c){var f=[],g=e.search()&&e.search().filter?e.search().filter:void 0,i=null,j=null;if(g){var k=["first_name","last_name","name","email"];j=k.map(function(a){return a+' like "%'+g+'%"'}).join(" or ")}return i=b.getApiData("admin",{filter:j},!0),angular.forEach(i,function(a){f.push(new h(a))}),void(a.admins=f)}});a.$watchCollection(function(){return b.getApiData("admin")},function(c,d){var e=[];angular.forEach(b.getApiData("admin"),function(a){e.push(new h(a))}),a.admins=e});a.$on("toolbar:paginate:admin:update",function(c){var d=[];angular.forEach(b.getApiData("admin"),function(b){for(var c=new h(b),e=0;e<a.selectedAdmins.length;){if(a.selectedAdmins[e]===c.record.id){c.__dfUI.selected=!0;break}e++}d.push(c)}),a.admins=d}),a.$on("$destroy",function(b){i(),a.$broadcast("toolbar:paginate:admin:reset")})}}}]).directive("dfImportAdmins",["MOD_ADMIN_ASSET_PATH","INSTANCE_URL","$http","dfTableEventService","dfNotify",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!0,link:function(a,d,f){a.importType=null,a.field=angular.element("#upload"),a.importAdmins=function(){a._importAdmins()},a._importAdmins=function(){a.field.trigger("click")},a._uploadFile=function(d){return c({method:"POST",url:b+"/api/v2/system/admin",headers:{"Content-Type":"csv"===a.importType?"text/csv":"application/"+a.importType},params:{},data:d})},a._checkFileType=function(b){var c=b.name.split(".");c=c[c.length-1];var d=!1;switch(c){case"csv":case"json":case"xml":a.importType=c,d=!0;break;default:d=!1}return d},a.$watch("uploadFile",function(b,c){if(!b)return!1;if(b=a.uploadFile,!a._checkFileType(b)){a.uploadFile=null;var d={module:"Api Error",type:"error",provider:"dreamfactory",message:"Acceptable file formats are csv, json, and xml."};return e.error(d),!1}a._uploadFile(b).then(function(b){a.importType=null,a.uploadFile=null,$("#upload").val("");var c={module:"Admins",type:"success",provider:"dreamfactory",message:"Admins imported successfully."};e.success(c),a.$broadcast("toolbar:paginate:admin:reset")},function(b){a.importType=null,a.uploadFile=null,$("#upload").val("");var c={module:"Api Error",type:"error",provider:"dreamfactory",message:b};e.error(c),a.$broadcast("toolbar:paginate:admin:reset")})["finally"](function(){},function(){})})}}}]).directive("dfExportAdmins",["MOD_ADMIN_ASSET_PATH","INSTANCE_URL","$cookies","$http","$window",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!0,link:function(a,f,g){a.fileFormatStr=null,a.exportAdmins=function(b){a._exportAdmins(b)},a._getFile=function(a){return d({method:"GET",url:a})},a._exportAdmins=function(d){if("csv"===d||"json"===d||"xml"===d){a.fileFormatStr=d;var f="file=admin."+a.fileFormatStr+"&session_token="+c.PHPSESSID;e.location.href=b+"/api/v2/system/admin?"+f}}}}}]).directive("dfSetAdminPassword",["MOD_ADMIN_ASSET_PATH","$compile","dfStringService",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/df-input-manual-password.html",link:function(a,d,e){a.verifyPassword="",a.updatePassword=!1,a.setPassword=!1,a.identical=!0,a._verifyPassword=function(b){b=b||a.admin.record.password,a.identical=c.areIdentical(b,a.verifyPassword)},a._resetUserPasswordForm=function(){a.verifyPassword="",a.setPassword=!1};var f=a.$watch("setPassword",function(c,d){if(!c)return!1;var e="";a.updatePassword?(e+='<div class="form-group"><input type="password" id="old-password" class="form-control" data-ng-model="password.old_password" placeholder="Enter Old Password" /></div>',e+='<div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="password" name="password" placeholder="Enter Password" data-ng-model="password.new_password" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword(password.new_password)" ></div><div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="verify-password" name="verify-password" placeholder="Verify Password" data-ng-model="verifyPassword" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword(password.new_password)" ></div>'):e+='<div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="password" name="password" placeholder="Enter Password" data-ng-model="admin.record.password" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword()" ></div><div class="form-group" data-ng-class="{\'has-error\' : identical === false}"><input type="password" id="verify-password" name="verify-password" placeholder="Verify Password" data-ng-model="verifyPassword" class="form-control" data-ng-required="true" data-ng-keyup="_verifyPassword()" ></div>';var f=b(e)(a);angular.element("#set-password").append(f)});a.$on("reset:user:form",function(b){a._resetUserPasswordForm()}),a.$on("$destroy",function(a){f()})}}}]),angular.module("dfUsers",["ngRoute","dfUtility","dfApplication","dfHelp"]).constant("MOD_USER_ROUTER_PATH","/users").constant("MOD_USER_ASSET_PATH","admin_components/adf-users/").config(["$routeProvider","MOD_USER_ROUTER_PATH","MOD_USER_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"UsersCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("UsersCtrl",["$scope","dfApplicationData","dfNotify",function(a,b,c){a.$parent.title="Users",a.links=[{name:"manage-users",label:"Manage",path:"manage-users"},{name:"create-user",label:"Create",path:"create-user"}],a.emptySectionOptions={title:"You have no Users!",text:"Click the button below to get started adding users.  You can always create new users by clicking the tab located in the section menu to the left.",buttonText:"Create A User!",viewLink:a.links[1]},a.emptySearchResult={title:"You have no Users that match your search criteria!",text:""}}]).directive("dfUserDetails",["MOD_USER_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify","dfObjectService","INSTANCE_URL","$http","$cookies","UserDataService","$cookieStore",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",scope:{userData:"=?",newUser:"=?"},templateUrl:a+"views/df-user-details.html",link:function(a,k,l){var m=function(a){var b={name:null,first_name:null,last_name:null,email:null,phone:null,confirmed:!1,is_active:!0,default_app_id:null,user_source:0,user_data:[],password:null,user_lookup_by_user_id:[],user_to_app_to_role_by_user_id:[]};return a=a||b,{__dfUI:{selected:!1},record:angular.copy(a),recordCopy:angular.copy(a)}};a.user=null,a.roles=b.getApiData("role"),a.apps=b.getApiData("app"),a.newUser&&(a.user=new m),a.sendEmailOnCreate=!1,a.saveUser=function(){a._validateData()&&(a.newUser?a._saveUser():a._updateUser())},a.closeUser=function(){a._closeUser()},a._saveUserToServer=function(a){return b.saveApiData("user",a).$promise},a._updateUserToServer=function(a){return b.updateApiData("user",a).$promise},a._resetUserDetails=function(){a.newUser?a.user=new m:a.userData=null},a._prepareUserData=function(){a._prepareLookupKeyData()},a._validateData=function(){return a.setPassword&&a.verifyPassword!==a.user.record.password?(d.error({module:"Users",type:"error",message:"Passwords not same."}),!1):!0},a._saveUser=function(){a._prepareUserData();var b={params:{fields:"*",related:"user_to_app_to_role_by_user_id,user_lookup_by_user_id",send_invite:a.sendEmailOnCreate},data:a.user.record};a._saveUserToServer(b).then(function(b){var c={module:"Users",provider:"dreamfactory",type:"success",message:"User saved successfully."};d.success(c),a._resetUserPasswordForm(),a.user=new m},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})},a._updateUser=function(){a._prepareUserData();var b={params:{fields:"*",related:"user_to_app_to_role_by_user_id,user_lookup_by_user_id"},data:a.user.record};i.getCurrentUser().id===b.data.id&&(b.url=f+"/api/v2/system/:api/profile",b.queryParams={api:"@api"}),a._updateUserToServer(b).then(function(b){
if(b.session_token){g.defaults.headers.common["X-DreamFactory-Session-Token"]=b.session_token,h.PHPSESSID=b.session_token;var e=i.getCurrentUser();e.session_token=b.session_token,e.session_id=b.session_token,j.put("CurrentUserObj",e)}var f={module:"Users",provider:"dreamfactory",type:"success",message:"User updated successfully."};d.success(f),a._resetUserPasswordForm(),a.user=new m(b),c.getPrefs().sections.user.autoClose&&a.closeUser(),a.lookupKeys=a.lookupKeys.filter(function(a){return null!==a.record.user_id})},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})},a._closeUser=function(){return a._prepareUserData(),e.compareObjectsAsJson(a.user.record,a.user.recordCopy)||d.confirmNoSave()?void a._resetUserDetails():!1};var n=a.$watch("userData",function(b,c){return b?void(a.user=new m(b)):!1});a.$on("$destroy",function(a){n()}),a.dfHelp={userRole:{title:"User Role Info",text:"Roles provide a way to grant or deny access to specific applications and services on a per-user basis. Each user who is not a system admin must be assigned a role. Go to the Roles tab to create and manage roles."},userConfirmation:{title:"User Confirmation Info",text:"Is the user confirmed? You can send an invite to unconfirmed users."},userLookupKeys:{title:"User Lookup Keys Info",text:'The DreamFactory administrator can create any number of "key value" pairs attached to a user. The key values are automatically substituted on the server. For example, key names can be used in the username and password fields required to hook up a SQL or NoSQL database. They can also be used in Email Templates or as parameters for external REST services. Any Lookup Key can be marked as private, and in this case the key value is securely encrypted on the server and is no longer accessible through the platform interface. Lookup keys for service configuration and credentials must be made private.'}}}}}]).directive("dfConfirmUser",["INSTANCE_URL","MOD_USER_ASSET_PATH","$http","SystemConfigDataService","dfNotify",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:b+"views/df-input-confirm-user.html",link:function(b,f,g){b.inviteUserOnCreate=!1,b.systemConfig=d.getSystemConfig(),b.invite=function(){b._invite(b.user.record.id)},b._sendInvite=function(b){return c({url:a+"/api/v2/system/user/"+b,method:"PATCH",params:{send_invite:!0}})},b._invite=function(a){b._sendInvite(a).then(function(a){var b={module:"Users",type:"success",provider:"dreamfactory",message:"User invite has been sent."};e.success(b)},function(a){var b={module:"Users",type:"error",provider:"dreamfactory",message:a.data.error.message};e.error(b)})},b._callSendInvite=function(a){b.inviteUserOnCreate&&b._invite(a.id)}}}}]).directive("dfUserRoles",["MOD_USER_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-user-roles.html",link:function(a,b,c){a.roleToAppMap={},a.$watch("user",function(){a.user&&a.user.record.user_to_app_to_role_by_user_id.forEach(function(b){a.roleToAppMap[b.app_id]=b.role_id})}),a.selectRole=function(){Object.keys(a.roleToAppMap).forEach(function(b){a.roleToAppMap[b]?a._updateRoleApp(b,a.roleToAppMap[b]):a._removeRoleApp(b,a.roleToAppMap[b])})},a._removeRoleApp=function(b){var c=a.user.record.user_to_app_to_role_by_user_id.filter(function(a){return a.app_id==b})[0];c&&(c.user_id=null)},a._updateRoleApp=function(b,c){var d=a.user.record.user_to_app_to_role_by_user_id.filter(function(a){return a.app_id==b})[0];d?(d.app_id=b,d.role_id=c):a.user.record.user_to_app_to_role_by_user_id.push({app_id:b,role_id:c,user_id:a.user.record.id})}}}}]).directive("dfUserLookupKeys",["MOD_USER_ASSET_PATH","dfStringService",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-input-lookup-keys.html",link:function(a,b,c){var d=function(a){var b={name:"",value:"","private":!1,allow_user_update:!1};return{__dfUI:{unique:!0},record:angular.copy(a||b),recordCopy:angular.copy(a||b)}};a.lookupKeys=[],a.sameKeys=[],a.newKey=function(){a._newKey()},a.removeKey=function(b){a._removeKey(b)},a._isUniqueKey=function(){a.sameKeys=[],angular.forEach(a.lookupKeys,function(b,c){angular.forEach(a.lookupKeys,function(d,e){c!==e&&b.record.name===d.record.name&&a.sameKeys.push(b)})})},a._prepareLookupKeyData=function(){var b=[];angular.forEach(a.lookupKeys,function(a){b.push(a.record)}),a.user.record.user_lookup_by_user_id=b},a._newKey=function(){a.lookupKeys.push(new d)},a._removeKey=function(b){void 0!==a.lookupKeys[b].record.user_id?a.lookupKeys[b].record.user_id=null:a.lookupKeys.splice(b,1)};var e=a.$watch("user",function(b,c){b&&b.record.hasOwnProperty("user_lookup_by_user_id")&&b.record.user_lookup_by_user_id.length>0&&(a.lookupKeys=[],angular.forEach(b.record.user_lookup_by_user_id,function(b){a.lookupKeys.push(new d(b))}))}),f=a.$watch("sameKeys",function(b,c){return 0===b.length?void angular.forEach(a.lookupKeys,function(a){a.__dfUI.unique=!0}):void angular.forEach(a.lookupKeys,function(a){angular.forEach(b,function(b){a.record.name===b.record.name?a.__dfUI.unique=!1:a.__dfUI.unique=!0})})});a.$watchCollection("lookupKeys",function(b,c){b&&a._isUniqueKey()});a.$on("$destroy",function(a){e(),f()})}}}]).directive("dfManageUsers",["MOD_USER_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify",function(a,b,c,d){return{restrict:"E",scope:!1,templateUrl:a+"views/df-manage-users.html",link:function(a,e,f){var g=function(a){return{__dfUI:{selected:!1},record:a}};a.uploadFile={path:""},a.currentViewMode=c.getPrefs().sections.user.manageViewMode,a.users=null,a.currentEditUser=null,a.fields=[{name:"id",label:"ID",active:!0},{name:"email",label:"Email",active:!0},{name:"name",label:"Display Name",active:!0},{name:"first_name",label:"First Name",active:!0},{name:"last_name",label:"Last Name",active:!0},{name:"is_active",label:"Active",active:!0},{name:"confirmed",label:"Confirmed",active:!0}],a.order={orderBy:"id",orderByReverse:!1},a.selectedUsers=[],a.roles=b.getApiData("role"),a.editUser=function(b){a._editUser(b)},a.deleteUser=function(b){d.confirm("Delete "+b.record.name+"?")&&a._deleteUser(b)},a.deleteSelectedUsers=function(){d.confirm("Delete selected users?")&&a._deleteSelectedUsers()},a.orderOnSelect=function(b){a._orderOnSelect(b)},a.setSelected=function(b){a._setSelected(b)},a._deleteFromServer=function(a){return b.deleteApiData("user",a).$promise},a._getUserRoleName=function(b){for(var c=0;c<a.roles.length;c++)if(b===a.roles[c].id)return a.roles[c].name},a._editUser=function(b){a.currentEditUser=b},a._deleteUser=function(b){var c={params:{id:b.record.id}};a._deleteFromServer(c).then(function(c){var e={module:"Users",type:"success",provider:"dreamfactory",message:"User successfully deleted."};d.success(e),b.__dfUI.selected&&a.setSelected(b),a.$broadcast("toolbar:paginate:user:delete")},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})},a._orderOnSelect=function(b){var c=a.order.orderBy;c===b.name?a.order.orderByReverse=!a.order.orderByReverse:(a.order.orderBy=b.name,a.order.orderByReverse=!1)},a._setSelected=function(b){for(var c=0;c<a.selectedUsers.length;){if(b.record.id===a.selectedUsers[c])return b.__dfUI.selected=!1,void a.selectedUsers.splice(c,1);c++}b.__dfUI.selected=!0,a.selectedUsers.push(b.record.id)},a._deleteSelectedUsers=function(){var b={params:{ids:a.selectedUsers.join(","),rollback:!0}};a._deleteFromServer(b).then(function(b){var c={module:"Users",type:"success",provider:"dreamfactory",message:"Users deleted successfully."};d.success(c),a.selectedUsers=[],a.$broadcast("toolbar:paginate:user:reset")},function(a){var b={module:"Api Error",provider:"dreamfactory",type:"error",message:a};d.error(b)})["finally"](function(){})};var h=a.$watch("users",function(c,d){if(null==c){var e=[];return angular.forEach(b.getApiData("user"),function(a){e.push(new g(a))}),void(a.users=e)}});a.$watchCollection(function(){return b.getApiData("user")},function(c,d){var e=[];angular.forEach(b.getApiData("user"),function(a){e.push(new g(a))}),a.users=e});a.$on("toolbar:paginate:user:update",function(c){var d=[];angular.forEach(b.getApiData("user"),function(b){for(var c=new g(b),e=0;e<a.selectedUsers.length;){if(a.selectedUsers[e]===c.record.id){c.__dfUI.selected=!0;break}e++}d.push(c)}),a.users=d}),a.$on("$destroy",function(b){h(),a.$broadcast("toolbar:paginate:user:reset")})}}}]).directive("dfImportUsers",["MOD_USER_ASSET_PATH","INSTANCE_URL","$http","dfTableEventService","dfNotify",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!0,link:function(a,d,f){a.importType=null,a.field=angular.element("#upload"),a.importUsers=function(){a._importUsers()},a._importUsers=function(){a.field.trigger("click")},a._uploadFile=function(d){return c({method:"POST",url:b+"/api/v2/system/user",headers:{"Content-Type":"csv"===a.importType?"text/csv":"application/"+a.importType},params:{},data:d})},a._checkFileType=function(b){var c=b.name.split(".");c=c[c.length-1];var d=!1;switch(c){case"csv":case"json":case"xml":a.importType=c,d=!0;break;default:d=!1}return d},a.$watch("uploadFile.path",function(b,c){if(!b)return!1;if(b=a.uploadFile.path,!a._checkFileType(b)){a.uploadFile.path="";var d={module:"Api Error",type:"error",provider:"dreamfactory",message:"Acceptable file formats are csv, json, and xml."};return e.error(d),!1}a._uploadFile(b).then(function(b){a.importType=null,a.uploadFile.path="",$("#upload").val("");var c={module:"Users",type:"success",provider:"dreamfactory",message:"Users imported successfully."};e.success(c),a.$broadcast("toolbar:paginate:user:reset")},function(b){var c="";if(b.data&&b.data.error&&b.data.error.context){var d=b.data.error.context.errors[0];c=b.data.error.message+" Detail: "+b.data.error.context.resource[d]}a.importType=null,a.uploadFile.path="",$("#upload").val("");var f={module:"Api Error",type:"error",provider:"dreamfactory",message:""!=c?c:b};e.error(f),a.$broadcast("toolbar:paginate:user:reset")})["finally"](function(){},function(){})})}}}]).directive("dfExportUsers",["MOD_USER_ASSET_PATH","INSTANCE_URL","$cookies","$http","$window",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!0,link:function(a,f,g){a.fileFormatStr=null,a.exportUsers=function(b){a._exportUsers(b)},a._getFile=function(a){return d({method:"GET",url:a})},a._exportUsers=function(d){if("csv"===d||"json"===d||"xml"===d){a.fileFormatStr=d;var f="file=user."+a.fileFormatStr+"&session_token="+c.PHPSESSID;e.location.href=b+"/api/v2/system/user?"+f}}}}}]),angular.module("dfApps",["ngRoute","dfUtility","dfApplication","dfHelp","dfTable"]).constant("MOD_APPS_ROUTER_PATH","/apps").constant("MOD_APPS_ASSET_PATH","admin_components/adf-apps/").config(["$routeProvider","MOD_APPS_ROUTER_PATH","MOD_APPS_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"AppsCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("AppsCtrl",["$scope",function(a){a.$parent.title="Apps",a.links=[{name:"manage-apps",label:"Manage",path:"manage-apps"},{name:"create-app",label:"Create",path:"create-app"},{name:"import-app",label:"Import",path:"import-app"},{name:"app-groups",label:"Groups",path:"app-groups"}],a.emptySectionOptions={title:"You have no Apps!",text:"Click the button below to get started building your first application.  You can always create new applications by clicking the tab located in the section menu to the left.",buttonText:"Create An App!",viewLink:a.links[1]},a.$on("$destroy",function(a){})}]).directive("dfAppDetails",["MOD_APPS_ASSET_PATH","INSTANCE_URL","UserDataService","$location","dfServerInfoService","dfApplicationData","dfApplicationPrefs","dfNotify","$http","dfObjectService",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",scope:{appData:"=?",newApp:"=?"},templateUrl:a+"views/df-app-details.html",link:function(a,b,c){var d=function(){var a=f.getApiData("service",{type:"local_file"});return a&&a.length?a[0].id:null},i=function(a){var b={name:"",description:"",type:0,storage_service_id:d(),storage_container:"applications",path:"",url:"",role_id:null};return a=a||b,{__dfUI:{selected:!1},record:angular.copy(a),recordCopy:angular.copy(a)}};a.currentServer=e.currentServer(),a.app=null,a.locations=[{label:"No Storage Required - remote device, client, or desktop.",value:"0"},{label:"On a provisioned file storage service.",value:"1"},{label:"On this web server.",value:"3"},{label:"On a remote URL.",value:"2"}],a.roles=f.getApiData("role"),a.selectedRoleId=null,a.storageServices=f.getApiData("service",{type:"local_file,aws_s3,azure_blob,rackspace_cloud_files,openstack_object_storage"}),a.storageContainers=[],a.newApp&&(a.app=new i),a.saveApp=function(){a.newApp?a._saveApp():a._updateApp()},a.closeApp=function(){a._closeApp()},a._prepareAppData=function(b){a._assignRoleToApp();var c=angular.copy(b);switch(parseInt(c.record.type)){case 0:delete c.record.storage_service_id,delete c.record.storage_container,delete c.record.path,delete c.record.url;break;case 1:delete c.record.url;break;case 2:delete c.record.storage_service_id,delete c.record.storage_container,delete c.record.path;break;case 3:delete c.record.storage_service_id,delete c.record.storage_container,delete c.record.url}return c.record},a._saveAppToServer=function(a){return f.saveApiData("app",a).$promise},a._updateAppToServer=function(a){return f.updateApiData("app",a).$promise},a._assignRoleToApp=function(){a.app.record.role_id=null,angular.forEach(a.roles,function(b){a.selectedRoleId&&b.id===a.selectedRoleId&&(a.app.record.role_id=b.id)})},a._resetAppDetails=function(){a.newApp?a.app=new i:a.appData=null,a.selectedRoleId=null},a._saveApp=function(){var b={params:{fields:"*",related:"role_by_role_id"},data:a._prepareAppData(a.app)};a._saveAppToServer(b).then(function(b){var c={module:"Apps",type:"success",provider:"dreamfactory",message:a.app.record.name+" saved successfully."};h.success(c),a._resetAppDetails()},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};h.error(b)})["finally"](function(){})},a._updateApp=function(){var b={params:{fields:"*",related:"role_by_role_id"},data:a._prepareAppData(a.app)};a._updateAppToServer(b).then(function(b){var c={module:"Apps",type:"success",provider:"dreamfactory",message:a.app.record.name+" updated successfully."};h.success(c),a.app=new i(b.resource),g.getPrefs().sections.app.autoClose&&a._resetAppDetails()},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};h.error(b)})["finally"](function(){})},a._closeApp=function(){return j.compareObjectsAsJson(a.app.record,a.app.recordCopy)||h.confirmNoSave()?void a._resetAppDetails():!1},a.changeStorageService=function(){a.app&&a.app.record&&(a.selectedStorageService=a.storageServices.filter(function(b){return b.id==a.app.record.storage_service_id})[0])};var k=a.$watch("app.record.storage_service_id",function(b,c){if(a.changeStorageService(),!b)return!1;var d=0;for(a.storageContainers=[];d<a.storageServices.length;)a.storageServices[d].id===b&&f.getServiceComponents(a.storageServices[d].name).then(function(b){angular.forEach(b,function(b){""!==b&&"*"!==b&&a.storageContainers.push(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};h.error(b)})}),d++}),l=a.$watch("appData",function(b,c){return b?(a.app=new i(b),void angular.forEach(a.roles,function(b){b.id===a.app.record.role_id&&(a.selectedRoleId=b.id)})):!1});a.$on("$destroy",function(a){k(),l()}),a.dfHelp={applicationName:{title:"Application API Key",text:"This API KEY is unique per application and must be included with each API request as a query param (api_key=yourapikey) or a header (X-DreamFactory-API-Key: yourapikey)."},name:{title:"Display Name",text:"The display name or label for your app, seen by users of the app in the LaunchPad UI."},description:{title:"Description",text:"The app description, seen by users of the app in the LaunchPad UI."},appLocation:{title:"App Location",text:"Select File Storage if you want to store your app code on your DreamFactory instance or some other remote file storage. Select Native for native apps or running the app from code on your local machine (CORS required). Select URL to specify a URL for your app."},storageService:{title:"Storage Service",text:"Where to store the files for your app."},storageContainer:{title:"Storage Folder",text:"The folder on the selected storage service."},defaultPath:{title:"Default Path",text:"The is the file to load when your app is run. Default is index.html."},remoteUrl:{title:"Remote Url",text:"Applications can consist of only a URL. This could be an app on some other server or a web site URL."},assignRole:{title:"Assign a Default Role",text:"Unauthenticated or guest users of the app will have this role."}}}}}]).directive("dfManageApps",["MOD_APPS_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfReplaceParams","dfNotify","$window",function(a,b,c,d,e,f){return{restrict:"E",scope:!1,templateUrl:a+"views/df-manage-apps.html",link:function(a,g,h){var i=function(a){return{__dfUI:{selected:!1},record:a}};a.currentViewMode=c.getPrefs().sections.app.manageViewMode,a.apps=null,a.currentEditApp=null,a.fields=[{name:"id",label:"Id",active:!0},{name:"name",label:"Name",active:!0},{name:"api_key",label:"API Key",active:!0},{name:"description",label:"Description",active:!0},{name:"is_active",label:"Active",active:!0}],a.order={orderBy:"id",orderByReverse:!1},a.selectedApps=[],a.removeFilesOnDelete=!1,a.launchApp=function(b){a._launchApp(b)},a.editApp=function(b){a._editApp(b)},a.exportApp=function(b){a._exportApp(b)},a.deleteApp=function(b){e.confirm("Delete "+b.record.name+"?")&&(b.record["native"]||null==b.record.storage_service_id||(a.removeFilesOnDelete=e.confirm("Delete application files? Pressing cancel will retain the files in storage.")),a._deleteApp(b))},a.orderOnSelect=function(b){a._orderOnSelect(b)},a.setSelected=function(b){a._setSelected(b)},a.deleteSelectedApps=function(){e.confirm("Delete selected apps?")&&(a.removeFilesOnDelete=e.confirm("Delete application files?"),a._deleteSelectedApps())},a._deleteFromServer=function(a){return b.deleteApiData("app",a).$promise},a._launchApp=function(a){f.open(d(a.record.launch_url,a.record.name))},a._editApp=function(b){a.currentEditApp=b},a._exportApp=function(a){},a._deleteApp=function(b){var c={params:{delete_storage:a.removeFilesOnDelete,related:"role_by_role_id",fields:"*"},data:b.record};a._deleteFromServer(c).then(function(a){var b={module:"Apps",type:"success",provider:"dreamfactory",message:"App successfully deleted."};e.success(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};e.success(b)})["finally"](function(){})},a._orderOnSelect=function(b){var c=a.order.orderBy;c===b.name?a.order.orderByReverse=!a.order.orderByReverse:(a.order.orderBy=b.name,a.order.orderByReverse=!1)},a._setSelected=function(b){for(var c=0;c<a.selectedApps.length;){if(b.record.id===a.selectedApps[c])return b.__dfUI.selected=!1,void a.selectedApps.splice(c,1);c++}b.__dfUI.selected=!0,a.selectedApps.push(b.record.id)},a._deleteSelectedApps=function(){var b={params:{ids:a.selectedApps.join(","),fields:"*",rollback:!0,delete_storage:a.removeFilesOnDelete}};a._deleteFromServer(b).then(function(b){var c={module:"Apps",type:"success",provider:"dreamfactory",message:"Apps deleted successfully."};e.success(c),a.selectedApps=[],a.$broadcast("toolbar:paginate:app:reset")},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};e.error(b)})["finally"](function(){})};var j=a.$watchCollection("apps",function(c,d){if(null==c){var e=[];return angular.forEach(b.getApiData("app"),function(a){!a.hasOwnProperty("roles")&&a.hasOwnProperty("import_url")&&null!=a.import_url&&(a.roles=[]),e.push(new i(a))}),void(a.apps=e)}}),k=a.$watchCollection(function(){return b.getApiData("app")},function(c,d){var e=[];angular.forEach(b.getApiData("app"),function(a){e.push(new i(a))}),a.apps=e});a.$on("toolbar:paginate:app:update",function(c){var d=[];angular.forEach(b.getApiData("app"),function(b){for(var c=new i(b),e=0;e<a.selectedApps.length;){if(a.selectedApps[e]===c.record.id){c.__dfUI.selected=!0;break}e++}d.push(c)}),a.apps=d}),a.$on("$destroy",function(a){j(),k()})}}}]).directive("dfImportApp",["MOD_APPS_ASSET_PATH","$http","dfApplicationData","dfNotify",function(a,b,c,d){return{restrict:"E",scope:{},templateUrl:a+"views/df-import-app.html",link:function(a,e,f){a.services=c.getApiData("service",{type:"local_file,aws_s3,azure_blob"}),a.containers=[],a.appPath=null,a.storageService="",a.storageContainer="",a.field=angular.element("#upload"),a.uploadFile=null,a.sampleApps=[{name:"Address Book for Android",description:"An address book app for Android showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/android-sdk/master/package/add_android.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/android-sdk"},{name:"Address Book for iOS",description:"An address book app for iOS Objective-C showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/ios-sdk/master/example-ios/package/add_ios.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/ios-sdk"},{name:"Address Book for iOS Swift",description:"An address book app for iOS Swift showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/ios-swift-sdk/master/SampleAppSwift/package/add_ios_swift.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/ios-swift-sdk"},{name:"Address Book for JavaScript",description:"An address book app for JavaScript showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/javascript-sdk/master/add_javascript.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/javascript-sdk"},{name:"Address Book for AngularJS",description:"An address book app for AngularJS showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/angular-sdk/master/add_angular.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/angular-sdk"},{name:"Address Book for Angular 2",description:"An address book app for Angular 2 showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/angular2-sdk/master/add_angular2.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/angular2-sdk"},{name:"Address Book for Titanium",description:"An address book app for Titanium showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/titanium-sdk/master/add_titanium.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/titanium-sdk"},{name:"Address Book for ReactJS",description:"An address book app for ReactJS showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/reactjs-sdk/master/add_reactjs.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/reactjs-sdk"},{name:"Address Book for .NET",description:"An address book app for .NET showing user registration, user login, and CRUD.",package_url:"https://raw.github.com/dreamfactorysoftware/.net-sdk/master/DreamFactory.AddressBook/App_Package/add_dotnet.dfpkg",repo_url:"https://github.com/dreamfactorysoftware/.net-sdk"}],a.submitApp=function(){return a.appPath?void a._submitApp():!1},a.browseFileSystem=function(){a._resetImportApp(),a.field.trigger("click")},a.loadSampleApp=function(b){a._loadSampleApp(b)},a._isAppPathUrl=function(a){return"http://"===a.substr(0,7)||"https://"===a.substr(0,8)},a._importAppToServer=function(d){var e={params:{},data:d,dontWrapData:!0};return a._isAppPathUrl(a.appPath)?e.headers={"Content-Type":"application/json"}:(e.headers={"Content-Type":void 0},b.defaults.transformRequest=angular.identity),c.saveApiData("app",e).$promise},a._isDFPackage=function(a){return".dfpkg"===a.substr(a.lastIndexOf("."))},a._resetImportApp=function(){a.appPath=null,a.storageService="",a.storageContainer="",a.uploadFile=null,a.field.val("")},a._loadSampleApp=function(b){a.appPath=b.package_url},a._submitApp=function(){var c={};if(a._isAppPathUrl(a.appPath))c={import_url:a.appPath,storage_service_id:a.storageService.id,storage_container:a.storageContainer};else{var e=new FormData,f=a.storageService&&void 0!==a.storageService.id?a.storageService.id:0,g=a.storageContainer;e.append("file",a.uploadFile),e.append("storage_service_id",f),e.append("storage_container",g),c=e}a._importAppToServer(c).then(function(a){var b={module:"Apps",type:"success",provider:"dreamfactory",message:"App successfully imported."};d.success(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(c){a._resetImportApp(),b.defaults.transformRequest=function(a,b){return angular.isObject(a)?angular.toJson(a):void 0}})};var g=a.$watch("storageService",function(b,d){return b?void c.getServiceComponents(b.name).then(function(b){a.containers=[],angular.forEach(b,function(b,c){"*"!==b&&""!==b&&a.containers.push(b)})}):!1});a.$watch("uploadFile",function(b,c){b&&(a.appPath=b.name)});a.$on("$destroy",function(a){g()}),a.dfHelp={applicationName:{title:"Application Name",text:"This is some help text that will be displayed in the help window"}}}}}]).directive("dfAppGroups",["MOD_APPS_ASSET_PATH","dfApplicationData","dfNotify",function(a,b,c){return{restrict:"E",scope:!1,templateUrl:a+"views/df-app-groups.html",link:function(a,d,e){var f=function(a){return{__dfUI:{selected:!1},record:a}},g=function(a){function b(){return Math.floor(1e5*Math.random())}var c={id:null,name:"NEW APP GROUP",app_to_app_group_by_group_id:[]};return a=a||c,{__dfUI:{newAppGroup:a.id,tempId:b()},record:angular.copy(a),recordCopy:angular.copy(a)}};a.appGroups=null,a.apps=null,a.selectedAppGroup=null,a.addAppGroup=function(){a._addAppGroup()},a.deleteAppGroup=function(){a._deleteAppGroup()},a.saveAppGroup=function(){var b=a.selectedAppGroup;if(null==b){var d={module:"App Groups",type:"warn",provider:"dreamfactory",message:"No app group selected."};return c.warn(d),void angular.element("#select-app-group").focus()}if(null===b.record.id){if("NEW APP GROUP"===b.record.name){var d={module:"App Groups",type:"warn",provider:"dreamfactory",message:"App Groups should have a unique name.  Please rename your app group to something other than the default 'new' app group name."};return void c.warn(d)}a._saveAppGroup(b)}else a._updateAppGroup(b)},a._saveAppGroupToServer=function(a){return b.saveApiData("app_group",a).$promise},a._updateAppGroupToServer=function(a){return b.updateApiData("app_group",a).$promise},a._deleteAppGroupFromServer=function(a){return b.deleteApiData("app_group",a).$promise},a._updateAssignedApps=function(b){var c=[];angular.forEach(a.apps,function(a){var d=!1;if(a.__dfUI.selected)angular.forEach(b.record.app_to_app_group_by_group_id,function(b){b.app_id==a.record.id&&(d=!0)}),d||c.push({app_id:a.record.id});else{var e=null;angular.forEach(b.record.app_to_app_group_by_group_id,function(b){b.app_id==a.record.id&&(d=!0,e=b.id)}),d&&c.push({group_id:null,app_id:a.record.id,id:e})}}),b.record.app_to_app_group_by_group_id=c},a._checkUnsavedAppGroups=function(){for(var b=0;b<a.apps.length;){if(null===a.apps[b].__dfUI.newAppGroup)return!0;b++}return!1},a._addAppGroup=function(){a.appGroups.push(new g),a.selectedAppGroup=a.appGroups[a.appGroups.length-1]},a._deleteAppGroup=function(){if(null===a.selectedAppGroup.__dfUI.newAppGroup){for(var b=0;b<a.appGroups.length;){if(a.appGroups[b].__dfUI.tempId===a.selectedAppGroup.__dfUI.tempId){a.appGroups.splice(b,1);break}b++}var d={module:"App Groups",type:"success",provider:"dreamfactory",message:"App Group deleted successfully."};return c.success(d),void(a.selectedAppGroup=null)}var e={params:{fields:"*",related:"app_to_app_group_by_group_id"},data:a.selectedAppGroup.record};a._deleteAppGroupFromServer(e).then(function(b){var d={module:"App Groups",type:"success",provider:"dreamfactory",message:"App Group deleted successfully."};c.success(d);for(var e=0;e<a.appGroups.length;)a.appGroups[e].record.name===b.name&&a.appGroups.splice(e,1),e++;a.selectedAppGroup=null},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._saveAppGroup=function(b){a._updateAssignedApps(b);var d={params:{fields:"*",related:"app_to_app_group_by_group_id"},data:b.record};a._saveAppGroupToServer(d).then(function(b){var d={module:"App Groups",type:"success",provider:"dreamfactory",message:"App Group created successfully."};c.success(d);for(var e=0;e<a.appGroups.length;){if(a.appGroups[e].record.name===b.record[0].name){var f=new g(b.record[0]);a.appGroups[e]=f,a.selectedAppGroup=f}e++}},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._updateAppGroup=function(b){a._updateAssignedApps(b);var d={params:{fields:"*",related:"app_to_app_group_by_group_id"},data:b.record};a._updateAppGroupToServer(d).then(function(b){var d={module:"App Groups",type:"success",provider:"dreamfactory",message:"App Group updated successfully."};c.success(d);for(var e=0;e<a.appGroups.length;){if(a.appGroups[e].record.name===b.name){var f=new g(b);a.appGroups[e]=f,a.selectedAppGroup=f}e++}},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})};var h=a.$watch("appGroups",function(c,d){null===c&&(a.appGroups=[],angular.forEach(b.getApiData("app_group"),function(b){a.appGroups.push(new g(b))}))}),i=a.$watch("apps",function(c,d){null===c&&(a.apps=[],angular.forEach(b.getApiData("app"),function(b){a.apps.push(new f(b))}))}),j=a.$watch("selectedAppGroup",function(b,c){angular.forEach(a.apps,function(a){a.__dfUI.selected=!1}),b&&b.record.app_to_app_group_by_group_id.length>0&&angular.forEach(a.apps,function(a){angular.forEach(b.record.app_to_app_group_by_group_id,function(b){a.record.id===b.app_id&&(a.__dfUI.selected=!0)})})});a.$on("$destroy",function(a){h(),i(),j()}),a.dfLargeHelp={appGroups:{title:"Groups Overview",text:"Applications can optionally be put into groups. The LaunchPad UI will group the available apps accordingly."}}}}}]),angular.module("dfData",["ngRoute","dfUtility","dfTable"]).constant("MOD_DATA_ROUTER_PATH","/data").constant("MOD_DATA_ASSET_PATH","admin_components/adf-data/").config(["$routeProvider","MOD_DATA_ROUTER_PATH","MOD_DATA_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"DataCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("DataCtrl",["$scope","INSTANCE_URL","dfApplicationData",function(a,b,c){a.$parent.title="Data",a.links=[{name:"manage-data",label:"Manage",path:"manage-data"}],a.__services__=c.getApiData("service",{type:"sql_db"}),a.selected={service:null,resource:null},a.options={service:a.selected.service,table:a.selected.resource,url:b+"/api/v2/"+a.selected.service+"/_table/"+a.selected.resource,allowChildTable:!0,childTableAttachPoint:"#child-table-attach"},a.$watchCollection("selected",function(c,d){var e={service:c.service,table:c.resource,url:b+"/api/v2/"+c.service+"/_table/"+c.resource,allowChildTable:!0,childTableAttachPoint:"#child-table-attach"
};a.options=e})}]),angular.module("dfServices",["ngRoute","dfUtility","dfServiceTemplates","dfSwaggerEditor","swagger-editor"]).constant("MOD_SERVICES_ROUTER_PATH","/services").constant("MOD_SERVICES_ASSET_PATH","admin_components/adf-services/").config(["$routeProvider","MOD_SERVICES_ROUTER_PATH","MOD_SERVICES_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"ServicesCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).service("dfServiceData",["$http","$q","INSTANCE_URL",function(a,b,c){var d={};return d.getServiceTypes=function(){var e=b.defer();return d.serviceTypes&&d.serviceTypes.length?e.resolve(d.serviceTypes):a({method:"GET",url:c+"/api/v2/system/service_type"}).success(function(a){d.serviceTypes=a.resource,e.resolve(d.serviceTypes)}),e.promise},d}]).controller("ServicesCtrl",["$scope",function(a){a.$parent.title="Services",a.links=[{name:"manage-services",label:"Manage",path:"manage-services"},{name:"create-service",label:"Create",path:"create-service"}],a.emptySectionOptions={title:"You have no Services!",text:'Click the button below to get started building your first Service.  You can always create new services by clicking the "Create" tab located in the section menu to the left.',buttonText:"Create A Service!",viewLink:a.links[1]}}]).directive("dfServiceDetails",["MOD_SERVICES_ASSET_PATH","$q","dfApplicationData","dfNotify","dfObjectService","dfApplicationPrefs","dfServiceValues","$http","INSTANCE_URL",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",scope:{serviceData:"=?",newService:"=?"},templateUrl:a+"views/df-service-details.html",link:function(a,b,g){var j=function(a){var b={id:null,name:"",label:"",description:"",is_active:!0,type:"sql_db",mutable:!0,deletable:!0,config:{},service_doc_by_service_id:[{content:{paths:{},definitions:{}},format:0}]};return a=a||b,a&&a.config&&Object.keys(a.config).forEach(function(b){if(a.config[b]&&a.config[b].constructor===Object){var c=[];Object.keys(a.config[b]).forEach(function(d){c.push({key:d,value:a.config[b][d]})}),a.config[b]=c}}),{__dfUI:{selected:!1},record:angular.copy(a),recordCopy:angular.copy(a)}};a.service=null,a.newService&&(a.service=new j),a.saveService=function(){a.newService?a._saveService():a._updateService()},a.deleteService=function(){a._deleteService()},a.closeService=function(){a._closeService()},a.testSetting=function(){a._testSetting()},a._saveServiceToServer=function(a){return c.saveApiData("service",a).$promise},a._updateServiceToServer=function(a){return c.updateApiData("service",a).$promise},a._deleteServiceFromServer=function(a){return c.deleteApiData("service",a).$promise},a._prepareServiceData=function(){a._prepareServiceInfoData(),a._prepareServiceConfigData(),"rws"!==a.service.record.type&&"script"!==a.service.record.type?(delete a.service.record.service_doc_by_service_id,delete a.service.recordCopy.service_doc_by_service_id):a._prepareServiceDefinitionData()},a._trimRequestDataObj=function(a){return a.data.config.hasOwnProperty("options_ctrl")&&delete a.data.config.options_ctrl,a},a._restoreRequestDataObj=function(b){return b.resource&&(b=b.resource),b.config.hasOwnProperty("options")?(b.config.options&&b.config.options.hasOwnProperty("ssl")?b.config.options_ctrl=!0:b.config.options_ctrl=!1,a._storageType=b.config,b):b},a._resetServiceDetails=function(){a.newService?a.service=new j:a.serviceData=null,angular.element("#info-tab").trigger("click")};var k=function(){var b=angular.copy(a.service.record),c=function(a){var c=b.config[a.name];b.config[a.name]={},c.forEach(function(c){b.config[a.name][c.key]=c.value})};return a.selectedSchema.config_schema.forEach(function(a){a.type.indexOf("object")>-1&&b.config[a.name]&&b.config[a.name].length&&c(a)}),b};a._saveService=function(){a._prepareServiceData();var b=k(),c={params:{fields:"*",related:"service_doc_by_service_id"},data:b};c=a._trimRequestDataObj(c),a._saveServiceToServer(c).then(function(b){var c={module:"Services",type:"success",provider:"dreamfactory",message:"Service saved successfully."};a.service=new j(b),d.success(c),a._resetServiceDetails()},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){})},a._updateService=function(){a._prepareServiceData();var b=k(),c={params:{fields:"*",related:"service_doc_by_service_id"},data:b};c=a._trimRequestDataObj(c),a._updateServiceToServer(c).then(function(b){var c={module:"Services",type:"success",provider:"dreamfactory",message:"Service updated successfully"};b=a._restoreRequestDataObj(b),d.success(c),a.service=new j(b)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){}),f.getPrefs().sections.service.autoClose&&a._resetServiceDetails()},a._deleteService=function(){var b={params:{},data:a.service.record};a._deleteServiceFromServer(b).then(function(b){var c={module:"Services",type:"success",provider:"dreamfactory",message:"Service successfully deleted."};d.success(c),a.service=null},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){})},a._closeService=function(){return a._prepareServiceData(),e.compareObjectsAsJson(a.service.record,a.service.recordCopy)||d.confirmNoSave()?void a._resetServiceDetails():!1},a._testSetting=function(){h.get(i+"/api/v2/"+a.service.record.name).then(function(a){var b={module:"Services",type:"success",provider:"dreamfactory",message:"Test was successful!"};d.success(b)},function(a){var b={module:"Services",type:"Api Error",provider:"dreamfactory",message:a.data.error.message};d.error(b)})};var l=a.$watch("serviceData",function(b,c){return b?a.newService?!1:void(a.service=new j(b)):!1});a.$on("$destroy",function(a){l()}),a.dfHelp={createService:{title:"Create Service Information",text:"Create Service information help text"}},a.dfLargeHelp={basic:{title:"Services Overview",text:"Services are where you set up REST API connections to databases, file storage, email, and remote web services."},config:{title:"Config Overview",text:"Specify any service-specific configuration below."},serviceDef:{title:"Service Definition Overview",text:'Specify the definition of the service below. Refer to the <a target="_blank" href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md" title="Link to Swagger">OpenAPI docs</a> for details, or build and export your own from <a target="_blank" href="http://editor.swagger.io/#/" title="Link to Swagger Editor">here</a>.'}}}}}]).directive("dfServiceInfo",["MOD_SERVICES_ASSET_PATH","dfServiceValues","dfServiceData","dfApplicationData","dfObjectService","dfStorageTypeFactory","$compile","$templateCache",function(a,b,c,d,e,f,g,h){return{restrict:"E",scope:!1,templateUrl:a+"views/df-service-info.html",link:function(a,i,j){var k=function(a){var b={name:null,label:null,description:null,is_active:!0,type:"rws",mutable:!0,deletable:!0,config:{}},c=angular.copy(a)||b;return{__dfUI:{},record:c,recordCopy:angular.copy(c)}};d.getApplicationObj().apis||[];a.customConfig=[],a.hcv=new b,c.getServiceTypes().then(function(b){a.hcv.serviceTypes=b,a.newService&&(a.hcv.serviceTypes=a.hcv.serviceTypes.filter(function(a){return!a.singleton})),a.serviceInfo.record&&(a.selectedSchema=a.hcv.serviceTypes.filter(function(b){return b.name===a.serviceInfo.record.type})[0])}),a._script={},a.serviceInfo={},a._storageType={},a.sql_server_host_identifier=null,a.sql_server_db_identifier=null,a._buildFieldSet=function(b,c){var d=null;c?(d=angular.element("#additionalFields"),d.length?d.html(""):(i.append('<div id="additionalFields"></div>'),d=angular.element("#additionalFields"))):i.html(""),b&&angular.forEach(b,function(b){c?d.append(g(h.get("_service-"+b+".html"))(a)):i.append(g(h.get("_service-"+b+".html"))(a))})},a._prepareServiceNoSQLData=function(){"mongodb"===a.service.record.storage_type&&(a.service.record.config.options_ctrl===!0?a.service.record.config.options={ssl:!0}:a.service.record.config.options={})},a._prepareServiceInfoData=function(){a.service.record=e.mergeObjects(a.serviceInfo.record,a.service.record)},a._prepareRWS=function(){return a._storageType},a._prepareEmailData=function(){return a._storageType.user=a.serviceInfo.record.config.user,a._storageType.password=a.serviceInfo.record.config.password,a._storageType},a._prepareRFS=function(){switch(a.serviceInfo.record.storage_type){case"aws s3":break;case"azure blob":delete a._storageType.PartitionKey;break;case"rackspace cloudfiles":case"openstack object storage":}return a._storageType},a._prepareSF=function(){return a._storageType},a._prepareNoSQL=function(){switch(a.serviceInfo.record.storage_type){case"aws dynamodb":case"aws simpledb":case"azure tables":var b=angular.copy(a._storageType);return b.hasOwnProperty("private_paths")&&delete b.private_paths,b;case"couchdb":case"mongodb":return a._storageType}},a._prepareSQLDB=function(){return{dsn:a._storageType.dsn,user:a._storageType.user,pwd:a._storageType.pwd}},a._prepareLFS=function(){return a._storageType},a._preparePS=function(){return a._storageType},a._dsnToFields=function(b){function c(a,b,c){for(var d=0;d<a.length;d++)if(a.charAt(d)==b&&!--c)return d;return!1}if(b=b||a._storageType.dsn)switch(a._storageType.prefix=b.slice(0,b.indexOf(":")),a._storageType.prefix){case"oci":a.sql_server_host_identifier="host",a.sql_server_db_identifier="sid",a._storageType.host=b.slice(b.lastIndexOf(a.sql_server_host_identifier),c(b,")",2)).split("=")[1],a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),c(b,")",6)).split("=")[1];break;case"ibm":a.sql_server_host_identifier="HOSTNAME",a.sql_server_db_identifier="DATABASE",a._storageType.host=b.slice(b.lastIndexOf(a.sql_server_host_identifier),c(b,";",3)).split("=")[1],a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),c(b,";",2)).split("=")[1];break;case"sqlsrv":a.sql_server_host_identifier="Server",a.sql_server_db_identifier="Database";default:a.sql_server_host_identifier="host",a.sql_server_db_identifier="dbname",a._storageType.host=b.slice(b.lastIndexOf(a.sql_server_host_identifier),b.indexOf(";")).split("=")[1],b.indexOf("port=")>b.indexOf(a.sql_server_db_identifier)?a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),c(b,";",2)).split("=")[1]:b.indexOf("port=")>b.indexOf(a.sql_server_db_identifier)&&(a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),b.length).split("=")[1])}},a.updateAffectedFields=function(b,c){if("driver"==c.name&&c.values){var d=c.values.filter(function(a){return a.name===b})[0]||{};a.serviceInfo.record.config.dsn=d.dsn}},a._updateDsn=function(){var b="";switch(a._storageType.prefix){case"sqlsrv":a.sql_server_host_identifier="Server",a.sql_server_db_identifier="Database",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+=a.sql_server_host_identifier+"="+a._storageType.host+";",b+=a.sql_server_db_identifier+"="+a._storageType.dbname;break;case"oci":a.sql_server_host_identifier="host",a.sql_server_db_identifier="sid",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+="dbname=(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)("+a.sql_server_host_identifier+"="+a._storageType.host+")(PORT = 1521))) (CONNECT_DATA = ("+a.sql_server_db_identifier+"="+a._storageType.dbname+")))";break;case"ibm":a.sql_server_host_identifier="HOSTNAME",a.sql_server_db_identifier="DATABASE",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+="DRIVER={IBM DB2 ODBC DRIVER};"+a.sql_server_db_identifier+"="+a._storageType.dbname+";"+a.sql_server_host_identifier+"="+a._storageType.host+";PORT=50000;PROTOCOL=TCPIP;";break;default:a.sql_server_host_identifier="host",a.sql_server_db_identifier="dbname",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+=a.sql_server_host_identifier+"="+a._storageType.host+";",b+=a.sql_server_db_identifier+"="+a._storageType.dbname}a._storageType.dsn=b},a._fieldsToDsn=function(){return a._storageType.prefix+":"+a.sql_server_host_identifier+"="+a._storageType.host+";"+a.sql_server_db_identifier+"="+a._storageType.dbname},a._renderAdditionalEmailFields=function(){switch(a._storageType.transport_type){case"command":a._buildFieldSet(["email-command"],!0);break;case"smtp":a._buildFieldSet(["email-host","email-port","email-security","user-name","password"],!0)}},a._renderAdditionalFields=function(b){var c={};switch(b===a.serviceInfo.recordCopy.storage_type&&(c=a.serviceInfo.record.config),b){case"aws dynamodb":case"aws simpledb":a._storageType=new f("aws",c),a._buildFieldSet(["aws-access-key","aws-secret-key","aws-region"],!0);break;case"azure tables":a._storageType=new f("azure",c),a._buildFieldSet(["azure-acct-name","azure-acct-key","azure-partition-key"],!0);break;case"couchdb":a._storageType=new f("couchdb",c),a._buildFieldSet(["couch-dsn","couch-user-name","couch-password"],!0);break;case"mongodb":a._storageType=new f("mongodb",c),a._buildFieldSet(["mongo-dsn","mongo-database","mongo-user-name","mongo-password","mongo-options-ssl"],!0);break;case"aws s3":a._storageType=new f("aws",c),a._buildFieldSet(["aws-access-key","aws-secret-key","aws-region"],!0);break;case"azure blob":a._storageType=new f("azure",c),a._buildFieldSet(["azure-acct-name","azure-acct-key"],!0);break;case"rackspace cloudfiles":a._storageType=new f("rackspace",c),a._buildFieldSet(["rs-user-name","rs-api-key","rs-tenet-name","rs-region","rs-endpoint"],!0);break;case"openstack object storage":a._storageType=new f("openstack",c),a._buildFieldSet(["os-user-name","os-password","os-tenet-name","os-region","os-endpoint"],!0);break;case"aws sns":a._storageType=new f("aws",c),a._buildFieldSet(["aws-access-key","aws-secret-key","aws-region"],!0);break;default:a._buildFieldSet(null,!0)}},a._renderServiceFields=function(a){},a._renderRegionUrl=function(a,b){var c=b.find(function(b,c,d){return b.value===a?b:void 0});this._storageType.url=c.url};var l=a.$watch("_storageType.transport_type",function(b,c){return b?void a._renderAdditionalEmailFields():!1}),m=a.$watch("service",function(b,c){return b?(a.serviceInfo=new k(b.record),a.selectedSchema=a.hcv.serviceTypes&&a.hcv.serviceTypes.filter(function(b){return a.serviceInfo&&a.serviceInfo.record&&b.name===a.serviceInfo.record.type})[0],a.selectedSchema&&a.decorateSchema(),a._storageType=null,void a._renderServiceFields(a.serviceInfo.record.type)):!1});a.$on("$destroy",function(a){m(),l()}),a.dfSimpleHelp={serviceType:{title:"Service Type ",text:"Select the type of service you're adding."},name:{title:"Name ",text:"Select a name for making API requests, such as 'db' in /api/v2/db."},label:{title:"Label ",text:"The display name or label for the service."},description:{title:"Description ",text:"Write a brief description of the API (optional)."},baseUrl:{title:"Base Url ",text:"Specify the base URL for the remote web service. For example, if you named the API 'mydb' and the base URL is http://api.myservice.com/v1/api/, then a REST call to /api/v2/mydb/mytable would tell DreamFactory to call http://api.myservice.com/v1/api/mydb/mytable."},userName:{title:"Username ",text:"Specify the username for the service you're connecting to."},password:{title:"Password ",text:"Specify the password for the service you're connecting to."},connectionString:{title:"Connection String ",text:"Specify the connection string for the database you're connecting to. "},sqlVendor:{title:"SQL Vendor ",text:"Specify the type of database you're connecting to."},sqlHost:{title:"SQL Host ",text:"Specify the database host for the database you're connecting to."},sqlDatabaseName:{title:"SQL Database Name ",text:"Specify the name of the database you're connecting to."},sfSecurityToken:{title:"SalesForce Security Token ",text:"Specify the security token for the Salesforce Org you're connecting to."},sfApiVersion:{title:"SalesForce APi Version ",text:"Specify the version of the Salesforce API you're using"},noSqlType:{title:"NoSQL Service Type ",text:"Specify the type of database you're connecting to."},databaseName:{title:"Database Name",text:"Specify the name of the database you're connecting to."},awsAccessKey:{title:"AWS Access Key ",text:"Specify the AWS Access Key for the database you're connecting to."},awsSecretKey:{title:"AWS Secret Key ",text:"Specify the AWS Secret Key for the database you're connecting to."},awsRegion:{title:"AWS Region ",text:"Select the AWS Region for the database you're connecting to."},azureAcctName:{title:"Azure Account Name ",text:"Specify the Azure Account Name for the database you're connecting to."},azureAcctKey:{title:"Azure Account Key ",text:"Specify the Azure Account Key for the database you're connecting to."},azureDefaultPartitionKey:{title:"Azure Partition Key ",text:"Specify the Azure Default Partition Key for the database you're connecting to."},storageType:{title:"Storage Type ",text:"Specify the type of storage you're connecting to."},rsApiKey:{title:"RackSpace Api Key ",text:"Specify the API Key for the storage you're connecting to."},rsTenantName:{title:"RackSpace Tenant Name ",text:"Specify the Tenant Name for the storage you're connecting to."},rsTenantRegion:{title:"RackSpace Tenant Region ",text:"Specify the Region for the storage you're connecting to."},rsEndpoint:{title:"RackSpace Endpoint/URL ",text:"Specify the URL Endpoint for the storage you're connecting to."},osApiKey:{title:"OpenStack Api Key ",text:"Specify the API Key for the storage you're connecting to."},osTenantName:{title:"OpenStack Tenant Name ",text:"Specify the Tenant Name for the storage you're connecting to."},osRegion:{title:"OpenStack Region ",text:"Specify the Region for the storage you're connecting to."},osEndpoint:{title:"OpenStack Endpoint/URL ",text:"Specify the URL Endpoint for the storage you're connecting to."},emailTransportType:{title:"Email Provider",text:"Specify the type of provider."},emailHost:{title:"Email Host ",text:"Specify the email host."},emailPort:{title:"Email Port ",text:"Specify the port number."},emailSecurity:{title:"Email Security ",text:"Specify the type of security (e.g. TLS)."},emailCommand:{title:"Email Command ",text:"Specify the command path for email."},pushServiceVendor:{title:"Push Notification Service Vendor",text:"Select a Push Notfication Service Provider"}}}}}]).directive("dfServiceConfig",["MOD_SERVICES_ASSET_PATH","dfServiceValues","dfServiceData","dfApplicationData","dfObjectService","dfStorageTypeFactory","$compile","$templateCache",function(a,b,c,d,e,f,g,h){return{restrict:"E",scope:!1,templateUrl:a+"views/df-service-config.html",link:function(a,i,j){var k=function(a){var b={config:{}},c=angular.copy(a)||b;return{__dfUI:{},record:c,recordCopy:angular.copy(c)}},l=d.getApplicationObj().apis||[];a.isArray=angular.isArray,a.customConfig=[],a.addKeyValue=function(b){a.serviceInfo.record.config[b]||(a.serviceInfo.record.config[b]=[]),a.serviceInfo.record.config[b].push({key:"new_key",value:"new_value"})},a.deleteKeyValue=function(a,b){a.splice(b,1)},a.appendItemToArray=function(b,c){b[c]||(b[c]=[]);var d=a.selectedSchema.config_schema.filter(function(a){return a.name==c})[0]||{};d.items instanceof Array?a.serviceInfo.record.config[c].push({}):"string"===d.items&&a.serviceInfo.record.config[c].push("")},a.deleteStringFromArray=function(a,b){a.splice(b,1)},a.addObjectInArray=function(a,b,c){a[b]||(a[b]=[]);var d={};c.forEach(function(a){switch(a.type){case"text":case"string":d[a.name]="";break;case"boolean":d[a.name]=!1;break;case"verb_mask":d[a.name]=31}}),a[b].push(d)},a.deleteObjectFromArray=function(a,b){a=a.splice(b,1)},a.decorateSchema=function(){var b=a.serviceInfo.record.type,c=a.customConfig.filter(function(a){return a.applicableTo.some(function(a){return a===b})});c.forEach(function(b){var c=a.selectedSchema.config_schema.filter(function(a){return a.name==b.name})[0]||{};angular.extend(c,b)}),a.selectedSchema.config_schema.forEach(function(b){b["default"]?a.serviceInfo.record.config[b.name]=a.serviceInfo.record.config[b.name]||b["default"]:"content"===b.name&&"Custom"===a.selectedSchema.group&&(a.serviceInfo.record.config.content=a.serviceInfo.record.config.content||"")})},a.getReferences=function(a,b){return l[a].record.map(function(a){return{name:a.name,value:a[b]||a.id}})},a.changeServiceType=function(){(a.serviceInfo||a.serviceInfo.record)&&(a.serviceInfo.record.config={},a.selectedSchema=a.hcv.serviceTypes.filter(function(b){return b.name===a.serviceInfo.record.type})[0],a.selectedSchema&&a.decorateSchema())},a.hcv=new b,c.getServiceTypes().then(function(b){a.hcv.serviceTypes=b,a.handleFiles=function(b){if(b){var c=b&&b[0];if(c){var d=new FileReader;d.readAsText(c,"UTF-8"),d.onload=function(b){a.serviceInfo.record.config.content=b.target.result,a.$apply()},d.onerror=function(a){console.log("error")}}}},a.newService&&(a.hcv.serviceTypes=a.hcv.serviceTypes.filter(function(a){return!a.singleton})),a.serviceInfo.record&&(a.selectedSchema=a.hcv.serviceTypes.filter(function(b){return b.name===a.serviceInfo.record.type})[0])}),a._script={},a.serviceInfo={},a._storageType={},a.sql_server_host_identifier=null,a.sql_server_db_identifier=null,a._buildFieldSet=function(b,c){var d=null;c?(d=angular.element("#additionalFields"),d.length?d.html(""):(i.append('<div id="additionalFields"></div>'),d=angular.element("#additionalFields"))):i.html(""),b&&angular.forEach(b,function(b){c?d.append(g(h.get("_service-"+b+".html"))(a)):i.append(g(h.get("_service-"+b+".html"))(a))})},a._prepareServiceNoSQLData=function(){"mongodb"===a.service.record.storage_type&&(a.service.record.config.options_ctrl===!0?a.service.record.config.options={ssl:!0}:a.service.record.config.options={})},a._prepareServiceConfigData=function(){a.service.record=e.mergeObjects(a.serviceInfo.record,a.service.record)},a._prepareRWS=function(){return a._storageType},a._prepareEmailData=function(){return a._storageType.user=a.serviceInfo.record.config.user,a._storageType.password=a.serviceInfo.record.config.password,a._storageType},a._prepareRFS=function(){switch(a.serviceInfo.record.storage_type){case"aws s3":break;case"azure blob":delete a._storageType.PartitionKey;break;case"rackspace cloudfiles":case"openstack object storage":}return a._storageType},a._prepareSF=function(){return a._storageType},a._prepareNoSQL=function(){switch(a.serviceInfo.record.storage_type){case"aws dynamodb":case"aws simpledb":case"azure tables":var b=angular.copy(a._storageType);return b.hasOwnProperty("private_paths")&&delete b.private_paths,b;case"couchdb":case"mongodb":return a._storageType}},a._prepareSQLDB=function(){return{dsn:a._storageType.dsn,user:a._storageType.user,pwd:a._storageType.pwd}},a._prepareLFS=function(){return a._storageType},a._preparePS=function(){return a._storageType},a._dsnToFields=function(b){function c(a,b,c){for(var d=0;d<a.length;d++)if(a.charAt(d)==b&&!--c)return d;return!1}if(b=b||a._storageType.dsn)switch(a._storageType.prefix=b.slice(0,b.indexOf(":")),a._storageType.prefix){case"oci":a.sql_server_host_identifier="host",a.sql_server_db_identifier="sid",a._storageType.host=b.slice(b.lastIndexOf(a.sql_server_host_identifier),c(b,")",2)).split("=")[1],a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),c(b,")",6)).split("=")[1];break;case"ibm":a.sql_server_host_identifier="HOSTNAME",a.sql_server_db_identifier="DATABASE",a._storageType.host=b.slice(b.lastIndexOf(a.sql_server_host_identifier),c(b,";",3)).split("=")[1],a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),c(b,";",2)).split("=")[1];break;case"sqlsrv":a.sql_server_host_identifier="Server",a.sql_server_db_identifier="Database";default:a.sql_server_host_identifier="host",a.sql_server_db_identifier="dbname",a._storageType.host=b.slice(b.lastIndexOf(a.sql_server_host_identifier),b.indexOf(";")).split("=")[1],b.indexOf("port=")>b.indexOf(a.sql_server_db_identifier)?a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),c(b,";",2)).split("=")[1]:b.indexOf("port=")>b.indexOf(a.sql_server_db_identifier)&&(a._storageType.dbname=b.slice(b.lastIndexOf(a.sql_server_db_identifier),b.length).split("=")[1])}},a._updateDsn=function(){var b="";switch(a._storageType.prefix){case"sqlsrv":a.sql_server_host_identifier="Server",a.sql_server_db_identifier="Database",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+=a.sql_server_host_identifier+"="+a._storageType.host+";",b+=a.sql_server_db_identifier+"="+a._storageType.dbname;break;case"oci":a.sql_server_host_identifier="host",a.sql_server_db_identifier="sid",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+="dbname=(DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)("+a.sql_server_host_identifier+"="+a._storageType.host+")(PORT = 1521))) (CONNECT_DATA = ("+a.sql_server_db_identifier+"="+a._storageType.dbname+")))";break;case"ibm":a.sql_server_host_identifier="HOSTNAME",a.sql_server_db_identifier="DATABASE",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+="DRIVER={IBM DB2 ODBC DRIVER};"+a.sql_server_db_identifier+"="+a._storageType.dbname+";"+a.sql_server_host_identifier+"="+a._storageType.host+";PORT=50000;PROTOCOL=TCPIP;";break;default:a.sql_server_host_identifier="host",a.sql_server_db_identifier="dbname",a._storageType.prefix&&(b+=a._storageType.prefix+":"),b+=a.sql_server_host_identifier+"="+a._storageType.host+";",b+=a.sql_server_db_identifier+"="+a._storageType.dbname}a._storageType.dsn=b},a._fieldsToDsn=function(){return a._storageType.prefix+":"+a.sql_server_host_identifier+"="+a._storageType.host+";"+a.sql_server_db_identifier+"="+a._storageType.dbname},a._renderAdditionalEmailFields=function(){switch(a._storageType.transport_type){case"command":a._buildFieldSet(["email-command"],!0);break;case"smtp":a._buildFieldSet(["email-host","email-port","email-security","user-name","password"],!0)}},a._renderAdditionalFields=function(b){var c={};switch(b===a.serviceInfo.recordCopy.storage_type&&(c=a.serviceInfo.record.config),b){case"aws dynamodb":case"aws simpledb":a._storageType=new f("aws",c),a._buildFieldSet(["aws-access-key","aws-secret-key","aws-region"],!0);break;case"azure tables":a._storageType=new f("azure",c),a._buildFieldSet(["azure-acct-name","azure-acct-key","azure-partition-key"],!0);break;case"couchdb":a._storageType=new f("couchdb",c),a._buildFieldSet(["couch-dsn","couch-user-name","couch-password"],!0);break;case"mongodb":a._storageType=new f("mongodb",c),a._buildFieldSet(["mongo-dsn","mongo-database","mongo-user-name","mongo-password","mongo-options-ssl"],!0);break;case"aws s3":a._storageType=new f("aws",c),a._buildFieldSet(["aws-access-key","aws-secret-key","aws-region"],!0);break;case"azure blob":a._storageType=new f("azure",c),a._buildFieldSet(["azure-acct-name","azure-acct-key"],!0);break;case"rackspace cloudfiles":a._storageType=new f("rackspace",c),a._buildFieldSet(["rs-user-name","rs-api-key","rs-tenet-name","rs-region","rs-endpoint"],!0);break;case"openstack object storage":a._storageType=new f("openstack",c),a._buildFieldSet(["os-user-name","os-password","os-tenet-name","os-region","os-endpoint"],!0);break;case"aws sns":a._storageType=new f("aws",c),a._buildFieldSet(["aws-access-key","aws-secret-key","aws-region"],!0);break;default:a._buildFieldSet(null,!0)}},a._renderServiceFields=function(a){},a._renderRegionUrl=function(a,b){var c=b.find(function(b,c,d){return b.value===a?b:void 0});this._storageType.url=c.url};var m=a.$watch("_storageType.transport_type",function(b,c){return b?void a._renderAdditionalEmailFields():!1}),n=a.$watch("service",function(b,c){return b?(a.serviceInfo=new k(b.record),a.selectedSchema=a.hcv.serviceTypes&&a.hcv.serviceTypes.filter(function(b){return a.serviceInfo&&a.serviceInfo.record&&b.name===a.serviceInfo.record.type})[0],a.selectedSchema&&a.decorateSchema(),a._storageType=null,void a._renderServiceFields(a.serviceInfo.record.type)):!1});a.$on("$destroy",function(a){n(),m()}),a.dfSimpleHelp={serviceType:{title:"Service Type ",text:"Select the type of service you're adding."},name:{title:"Name ",text:"Select a name for making API requests, such as 'db' in /api/v2/db."},label:{title:"Label ",text:"The display name or label for the service."},description:{title:"Description ",text:"Write a brief description of the API (optional)."},baseUrl:{title:"Base Url ",text:"Specify the base URL for the remote web service. For example, if you named the API 'mydb' and the base URL is http://api.myservice.com/v1/api/, then a REST call to /api/v2/mydb/mytable would tell DreamFactory to call http://api.myservice.com/v1/api/mydb/mytable."},userName:{title:"Username ",text:"Specify the username for the service you're connecting to."},password:{title:"Password ",text:"Specify the password for the service you're connecting to."},connectionString:{title:"Connection String ",text:"Specify the connection string for the database you're connecting to. "},sqlVendor:{title:"SQL Vendor ",text:"Specify the type of database you're connecting to."},sqlHost:{title:"SQL Host ",text:"Specify the database host for the database you're connecting to."},sqlDatabaseName:{title:"SQL Database Name ",text:"Specify the name of the database you're connecting to."},sfSecurityToken:{title:"SalesForce Security Token ",text:"Specify the security token for the Salesforce Org you're connecting to."},sfApiVersion:{title:"SalesForce APi Version ",text:"Specify the version of the Salesforce API you're using"},noSqlType:{title:"NoSQL Service Type ",text:"Specify the type of database you're connecting to."},databaseName:{title:"Database Name",text:"Specify the name of the database you're connecting to."},awsAccessKey:{title:"AWS Access Key ",text:"Specify the AWS Access Key for the database you're connecting to."},awsSecretKey:{title:"AWS Secret Key ",text:"Specify the AWS Secret Key for the database you're connecting to."},awsRegion:{title:"AWS Region ",text:"Select the AWS Region for the database you're connecting to."},azureAcctName:{title:"Azure Account Name ",text:"Specify the Azure Account Name for the database you're connecting to."},azureAcctKey:{title:"Azure Account Key ",text:"Specify the Azure Account Key for the database you're connecting to."},azureDefaultPartitionKey:{title:"Azure Partition Key ",text:"Specify the Azure Default Partition Key for the database you're connecting to."},storageType:{title:"Storage Type ",text:"Specify the type of storage you're connecting to."},rsApiKey:{title:"RackSpace Api Key ",text:"Specify the API Key for the storage you're connecting to."},rsTenantName:{title:"RackSpace Tenant Name ",text:"Specify the Tenant Name for the storage you're connecting to."},rsTenantRegion:{title:"RackSpace Tenant Region ",text:"Specify the Region for the storage you're connecting to."},rsEndpoint:{title:"RackSpace Endpoint/URL ",text:"Specify the URL Endpoint for the storage you're connecting to."},osApiKey:{title:"OpenStack Api Key ",text:"Specify the API Key for the storage you're connecting to."},osTenantName:{title:"OpenStack Tenant Name ",text:"Specify the Tenant Name for the storage you're connecting to."},osRegion:{title:"OpenStack Region ",text:"Specify the Region for the storage you're connecting to."},osEndpoint:{title:"OpenStack Endpoint/URL ",text:"Specify the URL Endpoint for the storage you're connecting to."},emailTransportType:{title:"Email Provider",text:"Specify the type of provider."},emailHost:{title:"Email Host ",text:"Specify the email host."},emailPort:{title:"Email Port ",text:"Specify the port number."},emailSecurity:{title:"Email Security ",text:"Specify the type of security (e.g. TLS)."},emailCommand:{title:"Email Command ",text:"Specify the command path for email."
},pushServiceVendor:{title:"Push Notification Service Vendor",text:"Select a Push Notfication Service Provider"}}}}}]).directive("dfManageServices",["MOD_SERVICES_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify",function(a,b,c,d){return{restrict:"E",scope:!1,templateUrl:a+"views/df-manage-services.html",link:function(a,e,f){var g=function(a){return{__dfUI:{selected:!1},record:a}};a.currentViewMode=c.getPrefs().sections.service.manageViewMode,a.services=null,a.currentEditService=null,a.fields=[{name:"id",label:"Id",active:!0},{name:"name",label:"Name",active:!0},{name:"label",label:"Label",active:!0},{name:"description",label:"Description",active:!0},{name:"is_active",label:"Active",active:!0},{name:"mutable",label:"Mutable",active:!0}],a.order={orderBy:"id",orderByReverse:!1},a.selectedServices=[],a.allSelected=!1,a.toggleViewMode=function(b){a._toggleViewMode(b)},a.editService=function(b){a._editService(b)},a.deleteService=function(b){d.confirm("Delete "+b.record.label+"?")&&a._deleteService(b)},a.deleteSelectedServices=function(){d.confirm("Delete selected services?")&&a._deleteSelectedServices()},a.orderOnSelect=function(b){a._orderOnSelect(b)},a.setSelected=function(b){a._setSelected(b)},a._deleteFromServer=function(a){return b.deleteApiData("service",a).$promise},a._filterServices=function(a){var b=["All","Schema","Local Portal Service"];return angular.forEach(a,function(c,d){angular.forEach(b,function(b,e){c.name===b&&a.splice(d,1)})}),a},a._editService=function(b){a.currentEditService=b},a._deleteService=function(b){var c={params:{id:b.record.id}};a._deleteFromServer(c).then(function(c){var e={module:"Services",type:"success",provider:"dreamfactory",message:"Service successfully deleted."};d.success(e),b.__dfUI.selected&&a.setSelected(b),a.$broadcast("toolbar:paginate:service:delete")},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){})},a._orderOnSelect=function(b){var c=a.order.orderBy;c===b.name?a.order.orderByReverse=!a.order.orderByReverse:(a.order.orderBy=b.name,a.order.orderByReverse=!1)},a._setSelected=function(b){for(var c=0;c<a.selectedServices.length;){if(b.record.id===a.selectedServices[c])return b.__dfUI.selected=!1,void a.selectedServices.splice(c,1);c++}b.__dfUI.selected=!0,a.selectedServices.push(b.record.id)},a._deleteSelectedServices=function(){var b={params:{ids:a.selectedServices.join(","),rollback:!0}};a._deleteFromServer(b).then(function(b){var c={module:"Services",type:"success",provider:"dreamfactory",message:"Services deleted successfully."};d.success(c),a.selectedServices=[],a.$broadcast("toolbar:paginate:service:reset")},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){})};var h=a.$watchCollection("services",function(c,d){if(null==c){var e=[];return angular.forEach(a._filterServices(b.getApiData("service")),function(a){e.push(new g(a))}),void(a.services=e)}});a.$watchCollection(function(){return b.getApiData("service")},function(c,d){var e=[];angular.forEach(a._filterServices(b.getApiData("service")),function(a){e.push(new g(a))}),a.services=e});a.$on("toolbar:paginate:service:update",function(c){var d=[];angular.forEach(a._filterServices(b.getApiData("service")),function(b){for(var c=new g(b),e=0;e<a.selectedServices.length;){if(a.selectedServices[e]===c.record.id){c.__dfUI.selected=!0;break}e++}d.push(c)}),a.services=d}),a.$on("$destroy",function(b){h(),a.$broadcast("toolbar:paginate:service:reset")})}}}]).directive("dfServiceDefinition",["MOD_SERVICES_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-service-definition.html",link:function(a,b,c){a.isEditorClean=!0,a.isEditable=!1,a.currentEditor=null,a.currentFile=null,a._prepareServiceDefinitionData=function(){a.service.record.service_doc_by_service_id&&(a.service.record.service_doc_by_service_id[0]=a.service.record.service_doc_by_service_id[0]||{},a.service.record.service_doc_by_service_id[0].content=a.currentEditor.session.getValue().split("/n").join(""))},a.$watch("service",function(b,c){if(b)switch(b.record.hasOwnProperty("service_doc_by_service_id")&&b.record.service_doc_by_service_id.length?a.currentFile=angular.fromJson(b.record.service_doc_by_service_id[0].content):a.currentFile={paths:{},definitions:{}},b.record.type){case"rws":case"script":a.isEditable=!0;break;default:a.isEditable=!0}}),$("#json-editor-tab").on("click",function(){a.currentEditor.renderer.updateText(),a.currentEditor.focus(),$(window).trigger("resize")}),$(window).on("resize",function(){var a=$(window).height();$('div[id^="ide_"]').css({height:a-400+"px"})})}}}]).factory("dfStorageTypeFactory",["dfObjectService",function(a){return function(b,c){"[object String]"===Object.prototype.toString.call("data")&&(c=angular.fromJson(c)),(!c||!Object.keys(c).length>0)&&(c=null);var d=function(b){var c={private_paths:[],access_key:null,secret_key:null,region:null};return b?a.mergeObjects(b,c):c},e=function(b){var c={private_paths:[],account_name:null,account_key:null,PartitionKey:null};return b?a.mergeObjects(b,c):c},f=function(b){var c={private_paths:[],url:null,api_key:null,username:null,tenant_name:null,region:null};return b?a.mergeObjects(b,c):c},g=function(b){var c={private_paths:[],url:null,password:null,username:null,tenant_name:null,region:null};return b?a.mergeObjects(b,c):c},h=function(b){var c={dsn:null,user:null,pwd:null,db:null,options:{},options_ctrl:null};return b?(b.options.hasOwnProperty("ssl")?b.options_ctrl=!0:b.options_ctrl=!1,a.mergeObjects(b,c)):c},i=function(b){var c={dsn:null,user:null,pwd:null};return b?a.mergeObjects(b,c):c},j=function(b){var c={username:null,password:null,security_token:null,version:null};return b?a.mergeObjects(b,c):c},k=function(b){var c={transport_type:"default",host:null,port:null,security:"SSL",command:null};return b?a.mergeObjects(b,c):c},l=function(b){var c={dsn:null,user:null,pwd:null};return b?a.mergeObjects(b,c):c},m=function(b){var c={private_paths:[]};return b?a.mergeObjects(b,c):c},n=function(a){return[]},o=function(b){var c={cache_config:{enabled:!1,ttl:null},client_exclusions:{parameters:[]}};return b?a.mergeObjects(b,c):c};switch(b){case"aws":return new d(c);case"azure":return new e(c);case"rackspace":return new f(c);case"openstack":return new g(c);case"mongodb":return new h(c);case"couchdb":return new i(c);case"salesforce":return new j(c);case"email":return new k(c);case"sql":return new l(c);case"local file storage":return new m(c);case"local sql db":return new n(c);case"remote web service":return new o(c)}}}]).factory("dfServiceValues",["SystemConfigDataService",function(a){return function(){var a="sqlsrv";a="dblib";var b={emailOptions:[{name:"Server Default",value:"default"},{name:"Server Command",value:"command"},{name:"SMTP",value:"smtp"}],securityOptions:[{name:"SSL",value:"SSL"},{name:"TLS",value:"TLS"}],sqlVendors:[{name:"MySQL",prefix:"mysql"},{name:"Microsoft SQL Server",prefix:a},{name:"PostgreSQL",prefix:"pgsql"},{name:"Oracle",prefix:"oci"},{name:"IBM DB2",prefix:"ibm"}],NoSQLOptions:[{name:"Amazon DynamoDB",value:"aws dynamodb"},{name:"Amazon SimpleDB",value:"aws simpledb"},{name:"Windows Azure Tables",value:"azure tables"},{name:"CouchDB",value:"couchdb"},{name:"MongoDB",value:"mongodb"}],awsRegions:[{name:"US EAST (N Virgina)",value:"us-east-1"},{name:"US WEST (N California)",value:"us-west-1"},{name:"US WEST (Oregon)",value:"us-west-2"},{name:"EU WEST (Ireland)",value:"eu-west-1"},{name:"Asia Pacific (Singapore)",value:"ap-southeast-1"},{name:"Asia Pacific (Sydney)",value:"ap-southeast-2"},{name:"Asia Pacific (Tokyo)",value:"ap-northeast-1"},{name:"South America (Sao Paulo)",value:"sa-east-1"}],rackspaceRegions:[{name:"London",value:"LON",url:"https://lon.identity.api.rackspacecloud.com"},{name:"Chicago",value:"ORD",url:"https://identity.api.rackspacecloud.com"},{name:"Dallas / Fort Worth",value:"DFW",url:"https://identity.api.rackspacecloud.com"}],remoteOptions:[{name:"Amazon S3",value:"aws s3"},{name:"Windows Azure Storage",value:"azure blob"},{name:"RackSpace CloudFiles",value:"rackspace cloudfiles"},{name:"OpenStack Object Storage",value:"openstack object storage"}],pushOptions:[{name:"Amazon SNS",value:"aws sns"}]};return b}}]),angular.module("dfServiceTemplates",[]).run(["$templateCache",function(a){a.put("_service-is-active.html",'<div class="form-group"><div class="checkbox"><label><input data-ng-model="serviceInfo.record.is_active" type="checkbox" /> Active</label></div></div>'),a.put("_service-type.html",'<div class="form-group"><label>Service Type</label><df-simple-help data-options="dfSimpleHelp.serviceType"></df-simple-help><select class="form-control" data-ng-disabled="!newService" data-ng-change="_renderServiceFields(serviceInfo.record.type)" data-ng-model="serviceInfo.record.type" data-ng-options="option.value as option.label for option in hcv.serviceTypes"></select></div>'),a.put("_service-api-name.html",'<div class="form-group"><label>API Name</label><df-simple-help data-options="dfSimpleHelp.apiName"></df-simple-help><input class="form-control" data-ng-disabled="!newService" data-ng-disabled="serviceInfo.record.deletable" data-ng-model="serviceInfo.record.api_name" type="text" required/></div>'),a.put("_service-name.html",'<div class="form-group"><label>Name</label><df-simple-help data-options="dfSimpleHelp.name"></df-simple-help><input class="form-control" data-ng-model="serviceInfo.record.name" type="text" required/></div>'),a.put("_service-description.html",'<div class="form-group"><label>Description</label><df-simple-help data-options="dfSimpleHelp.description"></df-simple-help><input class="form-control" data-ng-model="serviceInfo.record.description" type="text"/></div>'),a.put("_service-base-url.html",'<div class="form-group"><label>Base URL</label><df-simple-help data-ng-if="!_storageType.transport_type" data-options="dfSimpleHelp.baseUrl"></df-simple-help><input class="form-control" data-ng-model="serviceInfo.record.base_url" type="text"/></div>'),a.put("_service-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" id="serviceInfo-record-user" name="serviceInfo-record-user" data-ng-model="serviceInfo.record.config.user" type="text"/></div>'),a.put("_service-password.html",'<div class="form-group"><label>Password</label><df-simple-help data-options="dfSimpleHelp.password"></df-simple-help><input class="form-control" id="serviceInfo-record-password" name="serviceInfo-record-password" data-ng-model="serviceInfo.record.config.password" type="password"/></div>'),a.put("_service-remote-web-service-cache.html",'<div class="row"><div class="col-xs-12"><hr /></div></div><h3>Caching</h3><div class="form-group"><div class="input-group"><span class="input-group-addon"><input data-ng-model="_storageType.cache_config.enabled" type="checkbox"/></span><input class="form-control" data-ng-model="_storageType.cache_config.ttl" type="text" placeholder="Enter cache time to live (seconds)" data-ng-disabled="!_storageType.cache_config.enabled"/></div></div>'),a.put("_service-email-transport-type.html",'<div class="form-group"><label>Provider</label><df-simple-help data-options="dfSimpleHelp.emailTransportType"></df-simple-help><select class="form-control" data-ng-model="_storageType.transport_type" data-ng-options="option.value as option.name for option in hcv.emailOptions"></select></div>'),a.put("_service-email-host.html",'<div class="form-group"><label>Host</label><df-simple-help data-options="dfSimpleHelp.emailHost"></df-simple-help><input class="form-control" data-ng-model="_storageType.host" type="text" placeholder="e.g. SMTP.gmail.com"/></div>'),a.put("_service-email-port.html",'<div class="form-group"><label>Port</label><df-simple-help data-options="dfSimpleHelp.emailPort"></df-simple-help><input class="form-control" data-ng-model="_storageType.port" type="text" placeholder="e.g. 465"/></div>'),a.put("_service-email-security.html",'<div class="form-group"><label>Security</label><df-simple-help data-options="dfSimpleHelp.emailSecurity"></df-simple-help><select class="form-control" data-ng-options="option.value as option.name for option in hcv.securityOptions" data-ng-model="_storageType.security"></select></div>'),a.put("_service-email-command.html",'<div class="form-group"><label>Command</label><df-simple-help data-options="dfSimpleHelp.emailCommand"></df-simple-help><input class="form-control" data-ng-value="" type="text" data-ng-model="_storageType.command" placeholder="e.g. /usr/sbin/sendmail -bs"/></div>'),a.put("_service-sql-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" data-ng-model="_storageType.user" type="text"/></div>'),a.put("_service-sql-password.html",'<div class="form-group"><label>Password</label><df-simple-help data-options="dfSimpleHelp.password"></df-simple-help><input class="form-control" data-ng-model="_storageType.pwd" type="password"/></div>'),a.put("_service-sql-vendor.html",'<div data-ng-hide="!newService" class="form-group"><label>SQL Vendor</label><df-simple-help data-options="dfSimpleHelp.sqlVendor"></df-simple-help><select class="form-control" data-ng-model="_storageType.prefix" data-ng-change="_updateDsn()"  data-ng-options="server.prefix as server.name for server in hcv.sqlVendors"><option value="">-- Select Vendor --</option></select></div>'),a.put("_service-sql-host.html",'<div data-ng-hide="!newService" class="form-group"><label>Host</label><df-simple-help data-options="dfSimpleHelp.sqlHost"></df-simple-help><input data-ng-disabled="!_storageType.prefix" class="form-control" data-ng-keyup="_updateDsn()" data-ng-model="_storageType.host"/></div>'),a.put("_service-sql-database-name.html",'<div data-ng-hide="!newService" class="form-group"><label>Database Name</label><df-simple-help data-options="dfSimpleHelp.sqlDatabaseName"></df-simple-help><input data-ng-disabled="!_storageType.host" class="form-control" data-ng-keyup="_updateDsn()" data-ng-model="_storageType.dbname"/></div>'),a.put("_service-sql-dsn.html",'<div class="form-group"><label>Connection String</label><df-simple-help data-options="dfSimpleHelp.connectionString"></df-simple-help><input class="form-control" data-ng-model="_storageType.dsn" type="text" placeholder="{{sql_placeholder}}"/></div>'),a.put("_service-sf-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" data-ng-model="_storageType.username" type="text"/></div>'),a.put("_service-sf-password.html",'<div class="form-group"><label>Password</label><df-simple-help data-options="dfSimpleHelp.password"></df-simple-help><input class="form-control" data-ng-model="_storageType.password" type="password"/></div>'),a.put("_service-sf-security-token.html",'<div class="form-group"><label>Security Token</label><df-simple-help data-options="dfSimpleHelp.sfSecurityToken"></df-simple-help><input class="form-control" data-ng-model="_storageType.security_token" type="text"/></div>'),a.put("_service-sf-api-version.html",'<div class="form-group"><label>API Version</label><df-simple-help data-options="dfSimpleHelp.sfApiVersion"></df-simple-help><input class="form-control" data-ng-model="_storageType.version" placeholder="v28.0" type="text"/></div>'),a.put("_service-nosql-type.html",'<div class="form-group"><label>NoSQL Vendor</label><df-simple-help data-options="dfSimpleHelp.noSqlType"></df-simple-help><select class="form-control" data-ng-change="_renderAdditionalFields(serviceInfo.record.storage_type)" data-ng-options="option.value as option.name for option in hcv.NoSQLOptions" data-ng-model="serviceInfo.record.storage_type" data-ng-required="true"><option value="">-- Select Vendor --</option></select></div>'),a.put("_service-aws-access-key.html",'<div class="form-group"><label>Access Key</label><df-simple-help data-options="dfSimpleHelp.awsAccessKey"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.access_key"/></div>'),a.put("_service-aws-secret-key.html",'<div class="form-group"><label>Secret Key</label><df-simple-help data-options="dfSimpleHelp.awsSecretKey"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.secret_key"/></div>'),a.put("_service-aws-region.html",'<div class="form-group"><label>Region</label><df-simple-help data-options="dfSimpleHelp.awsRegion"></df-simple-help><select class="form-control" data-ng-options="region.value as region.name for region in hcv.awsRegions" data-ng-model="_storageType.region"></select></div>'),a.put("_service-azure-acct-name.html",'<div class="form-group"><label>Account Name</label><df-simple-help data-options="dfSimpleHelp.azureAcctName"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.account_name"/></div>'),a.put("_service-azure-acct-key.html",'<div class="form-group"><label>Account Key</label><df-simple-help data-options="dfSimpleHelp.azureAcctKey"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.account_key"/></div>'),a.put("_service-azure-partition-key.html",'<div class="form-group"><label>Default Partition Key</label><df-simple-help data-options="dfSimpleHelp.azureDefaultPartitionKey"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.PartitionKey"/></div>'),a.put("_service-couch-dsn.html",'<div class="form-group"><label>Connection String</label><df-simple-help data-options="dfSimpleHelp.connectionString"></df-simple-help><input data-ng-model="_storageType.dsn" type="text" class="form-control"/></div>'),a.put("_service-couch-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" data-ng-model="_storageType.user" type="text"/></div>'),a.put("_service-couch-password.html",'<div class="form-group"><label>Password</label><df-simple-help data-options="dfSimpleHelp.password"></df-simple-help><input class="form-control" data-ng-model="_storageType.pwd" type="password"/></div>'),a.put("_service-mongo-dsn.html",'<div class="form-group"><label>Connection String</label><df-simple-help data-options="dfSimpleHelp.connectionString"></df-simple-help><input class="form-control" data-ng-model="_storageType.dsn" type="text"/></div>'),a.put("_service-mongo-database.html",'<div class="form-group"><label>Database Name</label><df-simple-help data-options="dfSimpleHelp.databaseName"></df-simple-help><input class="form-control" data-ng-model="_storageType.db" type="text"/></div>'),a.put("_service-mongo-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" data-ng-model="_storageType.user" type="text"/></div>'),a.put("_service-mongo-password.html",'<div class="form-group"><label>Password</label><df-simple-help data-options="dfSimpleHelp.password"></df-simple-help><input class="form-control" data-ng-model="_storageType.pwd" type="password"/></div>'),a.put("_service-mongo-options-ssl.html",'<div class="form-group"><div class="checkbox"><label><input data-ng-model="_storageType.options_ctrl" type="checkbox"/>Connect with SSL (PHP driver and MongoDB server must support SSL)</label></div></div>'),a.put("_service-storage-type.html",'<div class="form-group"><label>Storage Type</label><df-simple-help data-options="dfSimpleHelp.storageType"></df-simple-help><select class="form-control" data-ng-change="_renderAdditionalFields(serviceInfo.record.storage_type)" data-ng-options="option.value as option.name for option in hcv.remoteOptions" data-ng-model="serviceInfo.record.storage_type" type="text"><option value="">-- Select Storage Type --</option></select></div>'),a.put("_service-rs-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.username"/></div>'),a.put("_service-rs-api-key.html",'<div class="form-group"><label>API Key</label><df-simple-help data-options="dfSimpleHelp.rsApiKey"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.api_key"/></div>'),a.put("_service-rs-tenet-name.html",'<div class="form-group"><label>Tenant Name</label><df-simple-help data-options="dfSimpleHelp.rsTenantName"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.tenant_name"/></div>'),a.put("_service-rs-region.html",'<div class="form-group"><label>Region</label><df-simple-help data-options="dfSimpleHelp.rsTenantRegion"></df-simple-help><select class="form-control" data-ng-change="_renderRegionUrl(_storageType.region, hcv.rackspaceRegions)" data-ng-options="option.value as option.name for option in hcv.rackspaceRegions" data-ng-model="_storageType.region"></select></div>'),a.put("_service-rs-endpoint.html",'<div class="form-group"><label>URL/Endpoint</label><df-simple-help data-options="dfSimpleHelp.rsEndpoint"></df-simple-help><input class="form-control" data-ng-disabled="!_storageType.region" type="text" data-ng-model="_storageType.url"/></div>'),a.put("_service-os-user-name.html",'<div class="form-group"><label>Username</label><df-simple-help data-options="dfSimpleHelp.userName"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.username"/></div>'),a.put("_service-os-password.html",'<div class="form-group"><label>Password</label><df-simple-help data-options="dfSimpleHelp.osApiKey"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.password"/></div>'),a.put("_service-os-tenet-name.html",'<div class="form-group"><label>Tenant Name</label><df-simple-help data-options="dfSimpleHelp.osTenantName"></df-simple-help><input class="form-control" type="text" data-ng-model="_storageType.tenant_name"/></div>'),a.put("_service-os-region.html",'<div class="form-group"><label>Region</label><df-simple-help data-options="dfSimpleHelp.osRegion"></df-simple-help><input class="form-control" type="text" ng-model="_storageType.region"/></div>'),a.put("_service-os-endpoint.html",'<div class="form-group"><label>URL/Endpoint</label><df-simple-help data-options="dfSimpleHelp.osEndpoint"></df-simple-help><input class="form-control" data-ng-disabled="!_storageType.region" type="text" data-ng-model="_storageType.url"/></div>'),a.put("_service-push-type.html",'<div class="form-group"><label>Push Notification Service Vendor</label><df-simple-help data-options="dfSimpleHelp.pushServiceVendor"></df-simple-help><select class="form-control" data-ng-change="_renderAdditionalFields(serviceInfo.record.storage_type)" data-ng-options="option.value as option.name for option in hcv.pushOptions" data-ng-model="serviceInfo.record.storage_type" type="text"><option value="">-- Select Storage Type --</option></select></div>')}]),angular.module("dfRoles",["ngRoute","dfUtility","dfTable"]).constant("MOD_ROLES_ROUTER_PATH","/roles").constant("MOD_ROLES_ASSET_PATH","admin_components/adf-roles/").config(["$routeProvider","MOD_ROLES_ROUTER_PATH","MOD_ROLES_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"RolesCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("RolesCtrl",["$scope",function(a){a.$parent.title="Roles",a.links=[{name:"manage-roles",label:"Manage",path:"manage-roles"},{name:"create-role",label:"Create",path:"create-role"}],a.emptySectionOptions={title:"You have no Roles!",text:"Click the button below to get started creating your first role.  You can always create new roles by clicking the tab located in the section menu to the left.",buttonText:"Create A Role!",viewLink:a.links[1]}}]).directive("dfRoleDetails",["MOD_ROLES_ASSET_PATH","dfApplicationData","dfNotify","dfObjectService","dfApplicationPrefs","$q","SystemConfigDataService","dfSystemData",function(a,b,c,d,e,f,g,h){return{restrict:"E",scope:{roleData:"=?",newRole:"=?"},templateUrl:a+"views/df-role-details.html",link:function(a,f,i){var j=function(a){var b={name:null,description:null,is_active:!1,default_app_id:null,role_service_access_by_role_id:[],id:null,role_lookup_by_role_id:[]};return a=a||b,{__dfUI:{selected:!1},record:angular.copy(a),recordCopy:angular.copy(a)}};a.basicInfoError=!1,a.role=null,a.adldap=g.getSystemConfig().authentication.adldap.length,a.newRole&&(a.role=new j),a.services=b.getApiData("service"),"All"!==a.services[0].name&&a.services.unshift({id:null,name:"All",components:["","*"]}),a.saveRole=function(){a.newRole?a._saveRole():a._updateRole()},a.deleteRole=function(){a._deleteRole()},a.closeRole=function(){a._closeRole()},a._saveRoleToServer=function(a){return b.saveApiData("role",a).$promise},a._updateRoleToServer=function(a){return b.updateApiData("role",a).$promise},a._deleteRoleFromServer=function(a){return b.deleteApiData("role",a).$promise},a._prepareRoleData=function(){return a.role.record.name?(a.basicInfoError=!1,a.adldap&&a.role.record.dn&&(a.role.record.role_adldap_by_role_id=a.role.record.id?[{role_id:a.role.record.id,dn:a.role.record.dn}]:[{dn:a.role.record.dn}],delete a.role.record.dn),a._prepareServiceAccessData(),void a._prepareRoleLookUpKeysData()):void(a.basicInfoError=!0)},a._resetRoleDetails=function(){a.newRole?a.role=new j:a.roleData=null,angular.element("#basic-tab").trigger("click"),a.$broadcast("dfPaginate:reset:user"),a.$broadcast("dfPaginate:reset:app"),a.lookupKeysError=!1,a.basicInfoError=!1},a._saveRole=function(){a._prepareRoleData();var b={params:{fields:"*",related:"role_service_access_by_role_id,role_lookup_by_role_id"},data:a.role.record};a._saveRoleToServer(b).then(function(b){var d={module:"Roles",type:"success",provider:"dreamfactory",message:"Role saved successfully."};a.role=new j(b),c.success(d),a._resetRoleDetails()},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})["finally"](function(){})},a._updateRole=function(){a._prepareRoleData();var b={params:{fields:"*",related:"role_service_access_by_role_id,role_lookup_by_role_id"},data:a.role.record};a._updateRoleToServer(b).then(function(b){a.adldap?h.resource({params:{fields:"*",related:"role_adldap_by_role_id"}}).get({api:"role",id:b.id,related:"role_adldap_by_role_id"}).$promise.then(function(c){c.role_adldap_by_role_id&&c.role_adldap_by_role_id.length>0&&(b.dn=c.role_adldap_by_role_id[0].dn),a.role=new j(b)},function(c){a.role=new j(b)}):a.role=new j(b);var d={module:"Roles",type:"success",provider:"dreamfactory",message:"Role updated successfully."};c.success(d)},function(b){a.role.record.role_adldap_by_role_id&&a.role.record.role_adldap_by_role_id.length>0&&(a.role.record.dn=a.role.record.role_adldap_by_role_id[0].dn);var d={module:"Api Error",type:"error",provider:"dreamfactory",message:b};c.error(d)})["finally"](function(){}),e.getPrefs().sections.role.autoClose&&a._resetRoleDetails()},a._deleteRole=function(){var b={params:{},data:a.role.record};a._deleteRoleFromServer(b).then(function(b){var d={module:"Roles",type:"success",provider:"dreamfactory",message:"Role successfully deleted."};c.success(d),a.role=null},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})["finally"](function(){})},a._closeRole=function(){return a._prepareRoleData(),d.compareObjectsAsJson(a.role.record,a.role.recordCopy)||c.confirmNoSave()?void a._resetRoleDetails():!1};var k=a.$watch("roleData",function(b,c){return b?a.newRole?!1:void(a.role=new j(b)):!1});a.$on("$destroy",function(b){k(),a.$broadcast("dfPaginate:reset:records")}),a.dfSimpleHelp={serviceAccess:{title:"Role Service Access Information",text:"Access rules for DreamFactory services. Use caution when allowing system access."}},a.dfLargeHelp={basic:{title:"Roles Overview",text:"Roles provide a way to grant or deny API access to specific services or apps."},access:{title:"Access Overview",text:"This section allows you set set up rules for a role restricting what services and components users assigned to the role will have access to. Advanced Filters are for implementing additional server side filter logic on database transactions."},lookupkeys:{title:"Lookup Keys Overview",text:'The DreamFactory administrator can create any number of "key value" pairs attached to a role. The key values are automatically substituted on the server. For example, key names can be used in the username and password fields required to hook up a SQL or NoSQL database. They can also be used in Email Templates or as parameters for external REST services. Any Lookup Key can be marked as private, and in this case the key value is securely encrypted on the server and is no longer accessible through the platform interface.<span style="color: red;">  Lookup keys for service configuration and credentials must be made private.</span>'}}}}}]).directive("assignServiceAccess",["MOD_ROLES_ASSET_PATH","dfNotify",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-assign-service-access.html",link:function(a,c,d){var e=function(){return{__dfUI:{allowFilters:!1,showFilters:!1,hasError:!1},record:{verb_mask:0,requestor_mask:1,component:"*",service:a.services[0]||null,service_id:a.services[0].id||null,filters:[],filter_op:"AND"}}};a.roleServiceAccesses=[],a.addServiceAccess=function(){a._addServiceAccess()},a.removeServiceAccess=function(b){a._removeServiceAccess(b)},a._prepareServiceAccessData=function(){var b=[];angular.forEach(a.roleServiceAccesses,function(a){var c=angular.copy(a.record);delete c.service,b.push(c)}),a.role.record.role_service_access_by_role_id=b},a._addServiceAccess=function(){a.roleServiceAccesses.push(new e)},a._removeServiceAccess=function(b){a.roleServiceAccesses[b].record.id?a.roleServiceAccesses[b].record.role_id=null:a.roleServiceAccesses.splice(b,1)},a._getService=function(c){for(var d=0;d<a.services.length;){if(a.services[d].id===c)return a.services[d];d++}var e={module:"DreamFactory Roles Module",type:"error",provider:"dreamfactory",message:'Service with id "'+c+'" not found.'};b.error(e)};var f=a.$watch("role",function(c,d){return c?(a.roleServiceAccesses=[],void(a.newRole?a.roleServiceAccesses=[]:angular.forEach(c.record.role_service_access_by_role_id,function(c){var d=new e;if(d.record=c,d.record.service=a._getService(c.service_id),d.record.service.hasOwnProperty("components")&&"string"==typeof d.record.service.components){d.__dfUI.hasError=!0,d.record.component=null;var f={module:"Roles",type:"error",provider:"dreamfactory",message:d.record.service.components};b.error(f)}a.roleServiceAccesses.push(d)}))):!1});a.$on("$destroy",function(a,b){f()})}}}]).directive("dfServiceAccess",["MOD_ROLES_ASSET_PATH","dfNotify","$http","INSTANCE_URL",function(a,b,c,d){return{restrict:"E",replace:!0,scope:{serviceAccess:"=",index:"="},templateUrl:a+"views/df-service-access.html",link:function(a,e,f){var g=function(){return{name:"",operator:"=",value:""}};a.filterOperators=["=","!=",">","<",">=","<=","in","not in","starts with","ends with","contains","is null","is not null"],a.toggleServiceAccessFilters=function(){a._toggleServiceAccessFilters()},a.addServiceAccessFilter=function(){a._addServiceAccessFilter()},a.removeServiceAccessFilter=function(b){a._removeServiceAccessFilter(b)},a.toggleServiceFilterOp=function(){a._toggleServiceFilterOp()},a.allowFilters=function(){switch(a.serviceAccess.record.service.type){
case"sql_db":case"mongo_db":case"aws_dynamodb":case"aws_simpledb":case"azure_table":case"couch_db":case"salesforce_db":a.serviceAccess.__dfUI.allowFilters=!0;break;default:a.serviceAccess.__dfUI.allowFilters=!1}},a._toggleServiceAccessFilters=function(){a.serviceAccess.__dfUI.show_filters=!a.serviceAccess.__dfUI.show_filters},a._addServiceAccessFilter=function(){a.serviceAccess.record.filters.push(new g)},a._removeServiceAccessFilter=function(b){a.serviceAccess.record.filters.splice(b,1)},a._toggleServiceFilterOp=function(){a.serviceAccess.record.filter_op="AND"===a.serviceAccess.record.filter_op?"OR":"AND"},a._getComponents=function(){return c.get(d+"/api/v2/"+a.serviceAccess.record.service.name+"/?as_access_list=true")},a._checkForFailure=function(){if("string"==typeof a.serviceAccess.record.components){a.serviceAccess.__dfUI.hasError=!0,a.serviceAccess.record.component=null;var c={module:"Roles",type:"error",provider:"dreamfactory",message:a.serviceAccess.record.components};b.error(c)}else a.serviceAccess.__dfUI.hasError=!1};var h=a.$watch("serviceAccess",function(b,c){return c&&c.record.service?void a.allowFilters():!1}),i=a.$watch("serviceAccess.record.service",function(b,c){return b?(a.allowFilters(),a.serviceAccess.record.service_id=b.id,a.serviceAccess.record.service.components=["","*"],"All"!==a.serviceAccess.record.service.name&&"rws"!==a.serviceAccess.record.service.type&&"script"!==a.serviceAccess.record.service.type&&a._getComponents().then(function(b){a.serviceAccess.record.service.components=b.data.resource},function(a){throw{module:"DreamFactory Utility Module",type:"error",provider:"dreamfactory",exception:a}}),a._checkForFailure(),void a._checkForFailure()):!1});a.$on("$destroy",function(a){i(),h()})}}}]).directive("dfManageRoles",["MOD_ROLES_ASSET_PATH","dfApplicationData","dfApplicationPrefs","dfNotify","dfSystemData","SystemConfigDataService",function(a,b,c,d,e,f){return{restrict:"E",scope:!1,templateUrl:a+"views/df-manage-roles.html",link:function(a,g,h){var i=function(a){return{__dfUI:{selected:!1},record:a}};a.adldap=f.getSystemConfig().authentication.adldap.length,a.currentViewMode=c.getPrefs().sections.role.manageViewMode,a.roles=null,a.currentEditRole=null,a.fields=[{name:"id",label:"Id",active:!0},{name:"name",label:"Name",active:!0},{name:"description",label:"Description",active:!0},{name:"is_active",label:"Active",active:!0}],a.order={orderBy:"id",orderByReverse:!1},a.selectedRoles=[],a.editRole=function(b){a.adldap?e.resource({params:{fields:"*",related:"role_adldap_by_role_id"}}).get({api:"role",id:b.id,related:"role_adldap_by_role_id"}).$promise.then(function(c){c.role_adldap_by_role_id&&c.role_adldap_by_role_id.length>0&&(b.dn=c.role_adldap_by_role_id[0].dn),a._editRole(b)},function(c){a._editRole(b)}):a._editRole(b)},a.deleteRole=function(b){d.confirm("Delete "+b.record.name+"?")&&a._deleteRole(b)},a.deleteSelectedRoles=function(){d.confirm("Delete selected roles?")&&a._deleteSelectedRoles()},a.orderOnSelect=function(b){a._orderOnSelect(b)},a.setSelected=function(b){a._setSelected(b)},a._deleteFromServer=function(a){return b.deleteApiData("role",a).$promise},a._editRole=function(b){a.currentEditRole=b},a._deleteRole=function(b){var c={params:{},data:b.record};a._deleteFromServer(c).then(function(c){var e={module:"Roles",type:"success",provider:"dreamfactory",message:"Role successfully deleted."};d.success(e),b.__dfUI.selected&&a.setSelected(b),a.$broadcast("toolbar:paginate:role:delete")},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){})},a._orderOnSelect=function(b){var c=a.order.orderBy;c===b.name?a.order.orderByReverse=!a.order.orderByReverse:(a.order.orderBy=b.name,a.order.orderByReverse=!1)},a._setSelected=function(b){for(var c=0;c<a.selectedRoles.length;){if(b.record.id===a.selectedRoles[c])return b.__dfUI.selected=!1,void a.selectedRoles.splice(c,1);c++}b.__dfUI.selected=!0,a.selectedRoles.push(b.record.id)},a._deleteSelectedRoles=function(){var b={params:{ids:a.selectedRoles.join(","),rollback:!0}};a._deleteFromServer(b).then(function(b){var c={module:"Roles",type:"success",provider:"dreamfactory",message:"Roles deleted successfully."};d.success(c),a.selectedRoles=[],a.$broadcast("toolbar:paginate:role:reset")},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})["finally"](function(){})};var j=a.$watchCollection("roles",function(c,d){if(null==c){var e=[];return angular.forEach(b.getApiData("role"),function(a){e.push(new i(a))}),void(a.roles=e)}});a.$watchCollection(function(){return b.getApiData("role")},function(c,d){var e=[];angular.forEach(b.getApiData("role"),function(a){e.push(new i(a))}),a.roles=e});a.$on("toolbar:paginate:role:update",function(c){var d=[];angular.forEach(b.getApiData("role"),function(b){for(var c=new i(b),e=0;e<a.selectedRoles.length;){if(a.selectedRoles[e]===c.record.id){c.__dfUI.selected=!0;break}e++}d.push(c)}),a.roles=d}),a.$on("$destroy",function(a){j()})}}}]).directive("dfAssignLookUpKeys",["MOD_ROLES_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-assign-lookup-keys.html",link:function(a,b,c){var d=function(a){var b={name:"",value:"","private":!1,allow_user_update:!1};return{__dfUI:{unique:!0},record:angular.copy(a||b),recordCopy:angular.copy(a||b)}};a.roleLookUpKeys=[],a.sameKeys=[],a.lookupKeysError=!1,a.addLookUpKey=function(){a._addLookUpKey()},a.deleteLookUpKey=function(b){a._deleteLookUpKey(b)},a._prepareRoleLookUpKeysData=function(){var b=[];angular.forEach(a.roleLookUpKeys,function(a){b.push(a.record)}),a.role.record.role_lookup_by_role_id=b},a._isUniqueKey=function(){a.sameKeys=[],angular.forEach(a.roleLookUpKeys,function(b,c){angular.forEach(a.roleLookUpKeys,function(d,e){c!==e&&b.record.name===d.record.name&&a.sameKeys.push(b)})})},a._addLookUpKey=function(){a.roleLookUpKeys.push(new d)},a._deleteLookUpKey=function(b){void 0!==a.roleLookUpKeys[b].record.role_id?a.roleLookUpKeys[b].record.role_id=null:a.roleLookUpKeys.splice(b,1)};var e=a.$watch("role",function(b,c){return b?(a.roleLookUpKeys=null,void(a.newRole?a.roleLookUpKeys=[]:(a.roleLookUpKeys=[],angular.forEach(b.record.role_lookup_by_role_id,function(b){a.roleLookUpKeys.push(new d(b))})))):!1}),f=a.$watch("sameKeys",function(b,c){return 0===b.length&&0===a.roleLookUpKeys.length?void(a.lookupKeysError=!1):0===b.length&&a.roleLookUpKeys.length>0?void angular.forEach(a.roleLookUpKeys,function(b){b.__dfUI.unique=!0,a.lookupKeysError=!1}):(angular.forEach(a.roleLookUpKeys,function(a){angular.forEach(b,function(b){a.record.name===b.record.name?a.__dfUI.unique=!1:a.__dfUI.unique=!0})}),void(a.lookupKeysError=!0))}),g=a.$watchCollection("roleLookUpKeys",function(b,c){b&&a._isUniqueKey()});a.$on("$destroy",function(a){e(),f(),g()})}}}]),angular.module("dfSchema",["ngRoute","dfUtility"]).constant("MOD_SCHEMA_ROUTER_PATH","/schema").constant("MOD_SCHEMA_ASSET_PATH","admin_components/adf-schema/").config(["$routeProvider","MOD_SCHEMA_ROUTER_PATH","MOD_SCHEMA_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"SchemaCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("SchemaCtrl",["INSTANCE_URL","$scope","$http","dfApplicationData","dfNotify","dfObjectService",function(a,b,c,d,e,f){var g=function(a){function b(a){var b=[];return angular.forEach(a,function(a){var c={__dfUI:{newTable:!1},name:a.name,label:a.label};b.push(c)}),b}return{__dfUI:{unfolded:!1},name:a.name,label:a.label,components:b(a.components),updateComponents:function(a){this.components=b(a)}}},h=function(a){return{__dfUI:{newTable:!a},record:a,currentService:b.currentService}};b.$parent.title="Schema",b.links=[{name:"manage-schema",label:"Manage",path:"manage-schema"}],b.bindTable=null;var i={};angular.forEach(d.getApiData("service",{type:"sql_db"}),function(a){i[a.name]=new g(a)}),b.schemaManagerData=i,b.currentService=null,b.currentTable=null,b.lastTable="",b.activeComponent=null,b.currentEditTable=null,b.currentUploadSchema=null,b.addTable=function(){if(b.currentUploadSchema&&!b.uploadIsEditorClean){if(!e.confirm("You have unsaved changes.  Continue without saving?"))return;b.currentUploadSchema=null}else if(null!==b.bindTable&&!f.compareObjectsAsJson(b.bindTable.record,b.bindTable.recordCopy)){if(!e.confirm("You have unsaved changes.  Continue without saving?"))return;b.currentEditTable=null}b._addTable()},b.getTable=function(){return!b.currentUploadSchema||b.uploadIsEditorClean||e.confirm("You have unsaved changes.  Continue without saving?")?void(null===b.bindTable||f.compareObjectsAsJson(b.bindTable.record,b.bindTable.recordCopy)?(b.lastTable=angular.copy(b.currentTable),b._getTable(b.currentTable)):e.confirm("You have unsaved changes.  Continue without saving?")?(b.lastTable=angular.copy(b.currentTable),b._getTable(b.currentTable)):b.currentTable=angular.copy(b.lastTable)):void(b.currentTable=angular.copy(b.lastTable))},b.deleteTable=function(){e.confirm("Are you sure you want to drop table "+b.currentEditTable.record.name+"?")&&b._deleteTable()},b.addByJson=function(){if(null!==b.bindTable&&!f.compareObjectsAsJson(b.bindTable.record,b.bindTable.recordCopy)){if(!e.confirm("You have unsaved changes.  Continue without saving?"))return;b.lastTable="",b.currentEditTable=null}b.currentEditTable=null,b._addByJson()},b.refreshService=function(a){b._refreshService(a)},b._getTableFromServer=function(d){return c({method:"GET",url:a+"/api/v2/"+b.currentService.name+"/_schema/"+d.name,params:{refresh:!0}})},b._deleteTableFromServer=function(d){return c({method:"DELETE",url:a+"/api/v2/"+b.currentService.name+"/_schema/"+d.name})},b._saveSchemaToServer=function(d){return c({method:"POST",url:a+"/api/v2/"+b.currentService.name+"/_schema",data:d.data})},b._refreshServiceFromServer=function(){return d.getServiceComponents(b.currentService.name,a+"/api/v2/"+b.currentService.name+"/_schema",{params:{refresh:!0,fields:"name,label"}})},b._addTable=function(){b.currentEditTable=new h(null),b.currentTable=""},b._getTable=function(a){if(!a)return b.currentTable=null,void(b.currentEditTable=null);var c={name:a};b._getTableFromServer(c).then(function(a){b.currentUploadSchema=null,b.currentEditTable=new h(a.data)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};e.error(b)})},b._deleteTable=function(){var a={name:b.currentTable};b._deleteTableFromServer(a).then(function(a){for(var c={module:"Schema",type:"success",provider:"dreamfactory",message:"Table deleted successfully."},f=0;f<b.currentService.components.length;){if(b.currentService.components[f].name===b.currentTable){b.currentService.components.splice(f,1),b.currentTable="",b.currentEditTable=null;break}f++}d.updateServiceComponentsLocal(b.currentService),e.success(c)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};e.error(b)})},b._addByJson=function(){b.currentUploadSchema=!0},b._refreshService=function(c){for(var f=null,g=0;g<b.currentService.components.length;g++)b.currentService.components[g].name===b.currentTable&&(f=b.currentService.components[g]);d.getServiceComponents(b.currentService.name,a+"/api/v2/"+b.currentService.name+"/_schema",{params:{refresh:!0,fields:"name,label"}},c).then(function(a){b.currentService.updateComponents(a);var d={module:"Schema",type:"success",provider:"dreamfactory",message:b.currentService.name+" refreshed."};c&&e.success(d),f&&(b.currentTable=f.name,b.getTable())},function(a){var b={module:"Schema",type:"error",provider:"dreamfactory",message:a};e.error(b)})};var j=b.$watch("schemaManagerData",function(a,b){if(null===a){var c={};angular.forEach(d.getApiData("service",{type:"sql_db"}),function(a){c[a.name]=new g(a)})}}),k=b.$watchCollection(function(){return d.getApiData("service",{type:"sql_db"})},function(a,c){if(a){var e={};angular.forEach(d.getApiData("service",{type:"sql_db"}),function(a){e[a.name]=new g(a)}),b.schemaManagerData=e}}),l=b.$watch("currentEditTable",function(a,c){null===a&&(b.currentTable="")});b.$on("$destroy",function(a){j(),k(),l()}),b.$on("update:components",function(a,c){b.currentService.components.push({__dfUI:{newTable:!1},name:c.name,label:c.label}),b.currentTable=b.currentService.components[b.currentService.components.length-1].name}),b.dfLargeHelp={manageSchema:{title:"Schema Manager Overview",text:"Choose a database service from the list to view or edit the schema. You can create a new database service in the Services section of this Admin Console."}}}]).directive("dfTableDetails",["MOD_SCHEMA_ASSET_PATH","INSTANCE_URL","dfNotify","$http","dfObjectService","dfApplicationData",function(a,b,c,d,e,f){return{restrict:"E",scope:{tableData:"=",table:"=?bindTable"},templateUrl:a+"views/df-table-details.html",link:function(a,g,h){var i=function(a){var b={name:null,label:null,plural:null,primary_key:null,name_field:null,related:null,access:[],field:[{name:"example_field",label:"Example Field",type:"string"}]};return a=a||b,{__dfUI:{newTable:null===a.name},record:angular.copy(a),recordCopy:angular.copy(a),currentService:a.currentService}},j=function(b){return{__dfUI:{newField:!b},record:b||null,currentService:a.table.currentService}},k=function(b){return{__dfUI:{newRelation:!b},record:b||null,currentService:a.table.currentService}};a.table=null,a.currentEditField=null,a.currentEditRelation=null,a.viewMode="table",a.editor=null,a.isEditorClean=!0,a.isEditable=!0,a.editField=function(b){a._editField(b)},a.addField=function(){a._addField()},a.deleteField=function(b){c.confirm("Are you sure you want to delete field "+b.name+"?")&&a._deleteField(b)},a.editRelation=function(b){a._editRelation(b)},a.closeTable=function(){a._closeTable()},a.saveTable=function(){a._saveTable()},a.updateTable=function(){a._updateTable()},a.setPrimaryKey=function(b){a._setPrimaryKey(b)},a.toggleViewMode=function(){if(a._validateJSON())a._toggleViewMode();else{var b={module:"JSON Error",type:"error",provider:"dreamfactory",message:"Invalid JSON.  Please correct any errors and validate to switch back to table view."};c.error(b)}},a.checkJSON=function(){a._checkJSON()},a._saveTableToServer=function(a){return d({method:"POST",url:b+"/api/v2/"+a.path+"?fields=*",data:{resource:[a.data]}})},a._updateTableToServer=function(a){return d({method:"PUT",url:b+"/api/v2/"+a.path+"?fields=*",data:{resource:[a.data]}})},a._deleteFieldFromTableOnServer=function(a){return d({method:"DELETE",url:b+"/api/v2/"+a.path})},a._validateJSON=function(){try{var b=JSON.parse(a.editor.getValue());if(b)return a.editor.setValue(angular.toJson(b,!0),-1),!0}catch(c){return!1}},a._insertNewTableToAppObj=function(b){var c=f.getApplicationObj();if(c.apis.hasOwnProperty("service")&&c.apis.service.hasOwnProperty("resource"))for(var d=0;d<c.apis.service.resource.length;d++)if(c.apis.service.resource[d].name===a.tableData.currentService.name){c.apis.service.resource[d].components.push({name:b.name,label:b.label});break}f.setApplicationObj(c)},a._editField=function(b){a.currentEditField=new j(b)},a._addField=function(){a.table.record.field.push({}),a.currentEditField=new j(a.table.record.field[a.table.record.field.length-1])},a._deleteField=function(b){if(a.table.__dfUI.newTable){for(var d=0;d<a.table.record.field.length;){if(a.table.record.field[d].name===b.name){a.table.record.field.splice(d,1);break}d++}return void(a.table.recordCopy=angular.copy(a.table.record))}var e={path:a.tableData.currentService.name+"/_schema/"+a.table.record.name+"/"+b.name};a._deleteFieldFromTableOnServer(e).then(function(d){for(var e=0;e<a.table.record.field.length;){if(a.table.record.field[e].name===b.name){a.table.record.field.splice(e,1);break}e++}a.table.recordCopy=angular.copy(a.table.record);var f={module:"Schema",type:"success",provider:"dreamfactory",message:"Field deleted."};c.success(f)},function(a){var b={module:"Schema",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._editRelation=function(b){a.currentEditRelation=new k(b)},a._closeTable=function(){return e.compareObjectsAsJson(a.table.record,a.table.recordCopy)||c.confirmNoSave()?(a.table=null,a.tableData=null,a.currentEditField=null,void(a.currentEditRelation=null)):!1},a._saveTable=function(){var b={params:{include_schema:!0},data:a.table.record,path:a.tableData.currentService.name+"/_schema"};a._saveTableToServer(b).then(function(b){var d={module:"Schema",type:"success",provider:"dreamfactory",message:"Table saved successfully."},e=b.data.resource[0];a.$emit("update:components",e),a._insertNewTableToAppObj(e);var g=a.table.currentService;a.table=new i(e),a.table.currentService=g,f.updateServiceComponentsLocal(g),c.success(d)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._updateTable=function(){var b={params:{include_schema:!0},data:a.table.record,path:a.tableData.currentService.name+"/_schema"};a._updateTableToServer(b).then(function(b){var d={module:"Schema",type:"success",provider:"dreamfactory",message:"Table updated successfully."},e=b.data.resource[0],f=a.table.currentService;a.table=new i(e),a.table.currentService=f,c.success(d)},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})},a._setPrimaryKey=function(b){for(var c=0;c<a.table.record.field.length;){if(a.table.record.field[c].is_primary_key){a.table.record.field[c].is_primary_key=!1;break}c++}b.is_primary_key=!0,a.table.record.primary_key=b.name},a._toggleViewMode=function(){a.viewMode="json"===a.viewMode?"table":"json","table"===a.viewMode&&(a.table.record=angular.fromJson(a.editor.getValue()))},a._checkJSON=function(){if(a._validateJSON()){var b={module:"Schema",type:"success",provider:"dreamfactory",message:"Valid JSON."};c.success(b)}else{var b={module:"Api Error",type:"error",provider:"dreamfactory",message:"JSON Invalid."};c.error(b)}};var l=a.$watch("tableData",function(b,c){null!==b&&(a.table=b.__dfUI.newTable?new i:new i(b.record),a.table.currentService=b.currentService)});a.$on("$destroy",function(a){l()}),a.$on("update:managedtable",function(a){})}}}]).directive("dfFieldDetails",["MOD_SCHEMA_ASSET_PATH","INSTANCE_URL","$http","dfNotify","dfObjectService","dfApplicationData",function(a,b,c,d,e,f){return{restrict:"E",scope:{fieldData:"=",currentTable:"="},templateUrl:a+"views/df-field-details.html",link:function(a,g,h){var i=function(a){var b={allow_null:!1,auto_increment:!1,db_function:null,db_type:null,"default":null,fixed_length:!1,is_foreign_key:!1,is_foreign_ref_service:!1,is_primary_key:!1,is_unique:!1,is_virtual_foreign_key:!1,label:null,length:null,name:null,precision:null,ref_fields:"",ref_service:null,ref_table:"",required:!1,scale:0,supports_multibyte:!1,type:null,validation:null,value:[]};return a=a||b,{__dfUI:{newField:null==a.type},record:a,recordCopy:angular.copy(a)}};a.typeOptions=[{name:"I will manually enter a type",value:""},{name:"id",value:"id"},{name:"string",value:"string"},{name:"integer",value:"integer"},{name:"text",value:"text"},{name:"boolean",value:"boolean"},{name:"binary",value:"binary"},{name:"float",value:"float"},{name:"double",value:"double"},{name:"decimal",value:"decimal"},{name:"datetime",value:"datetime"},{name:"date",value:"date"},{name:"time",value:"time"},{name:"reference",value:"reference"},{name:"user_id",value:"user_id"},{name:"user_id_on_create",value:"user_id_on_create"},{name:"user_id_on_update",value:"user_id_on_update"},{name:"timestamp",value:"timestamp"},{name:"timestamp_on_create",value:"timestamp_on_create"},{name:"timestamp_on_update",value:"timestamp_on_update"},{name:"virtual",value:"virtual"}],a.returnTypeOptions=[{name:"string",value:"string"},{name:"integer",value:"integer"},{name:"boolean",value:"boolean"},{name:"binary",value:"binary"},{name:"float",value:"float"},{name:"double",value:"double"},{name:"decimal",value:"decimal"}],a.refServices=f.getApiData("service",{type:"sql_db"}),a.refTables=null,a.refFields=null,a.closeField=function(b){if(!e.compareObjectsAsJson(a.field.record,a.field.recordCopy)){if(!b&&!d.confirmNoSave())return!1;e.mergeObjects(a.field.recordCopy,a.field.record)}a._closeField()},a.saveField=function(){a._saveField()},a.changeForeignKey=function(){a.field.record.is_foreign_key?(a._loadReferenceTables(),a._loadReferenceFields()):(a.field.record.is_virtual_foreign_key=!1,a.field.record.is_foreign_ref_service=!1,a.field.record.ref_service=null,a.field.record.ref_table=null,a.field.record.ref_fields=null,a.refTables=null,a.refFields=null)},a.changeForeignReferenceService=function(){a.field.record.is_foreign_ref_service||(a.field.record.ref_service=null),a.field.record.ref_table=null,a.field.record.ref_fields=null,a._loadReferenceTables(),a._loadReferenceFields()},a._loadReferenceTables=function(){var e=a.fieldData.currentService.name;a.field.record.ref_service&&(e=a.field.record.ref_service),c.get(b+"/api/v2/"+e+"/_schema/").then(function(b){a.refTables=b.data.resource},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})},a._loadReferenceFields=function(){if(!a.field.record.ref_table)return void(a.refFields=null);var e=a.fieldData.currentService.name;a.field.record.ref_service&&(e=a.field.record.ref_service),c.get(b+"/api/v2/"+e+"/_schema/"+a.field.record.ref_table).then(function(b){a.refFields=b.data.field},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};d.error(b)})},a._saveFieldToServer=function(){var d=angular.copy(a.field.record);return c({url:b+"/api/v2/"+a.fieldData.currentService.name+"/_schema/"+a.currentTable+"/"+d.name,method:"PATCH",data:d})},a._closeField=function(){a.field=null,a.fieldData=null},a._saveField=function(){a._saveFieldToServer().then(function(b){var c={module:"Schema",type:"success",provider:"dreamfactory",message:"Field saved."};d.success(c),a.field=new i(a.field.record),a.$emit("update:managedtable")},function(a){var b={module:"Schema",type:"error",provider:"dreamfactory",message:a};d.error(b)})};var j=a.$watch("fieldData",function(b,c){b&&(a.field=b.__dfUI.newField?new i:new i(b.record),b.record.ref_table||(a.refFields=null))});a.helpText={db_function:{title:"DB Function",text:"Enter a db function like max(fieldname) or concat(field1, '.', field2)"}},a.$on("$destroy",function(a){j()})}}}]).directive("dfRelationDetails",["MOD_SCHEMA_ASSET_PATH","INSTANCE_URL","$http","dfNotify","dfObjectService","dfApplicationData",function(a,b,c,d,e,f){return{restrict:"E",scope:{relationData:"=",currentTable:"="},templateUrl:a+"views/df-relation-details.html",link:function(a,f,g){var h=function(a){var b={alias:null,name:null,label:null,description:null,always_fetch:!1,type:null,field:null,is_virtual:!1,is_foreign_service:!1,ref_service:null,ref_table:null,ref_fields:null,is_foreign_junction_service:!1,junction_service:null,junction_table:null,junction_field:null,junction_ref_field:null};return a=a||b,{__dfUI:{newRelation:null==a.type},record:a,recordCopy:angular.copy(a)}};a.closeRelation=function(b){if(!e.compareObjectsAsJson(a.relation.record,a.relation.recordCopy)){if(!b&&!d.confirmNoSave())return!1;e.mergeObjects(a.relation.recordCopy,a.relation.record)}a._closeRelation()},a.saveRelation=function(){a._saveRelation()},a._saveRelationToServer=function(){var d={related:[angular.copy(a.relation.record)]};return c({url:b+"/api/v2/"+a.relationData.currentService.name+"/_schema/"+a.currentTable,method:"PATCH",data:d})},a._closeRelation=function(){a.relation=null,a.relationData=null},a._saveRelation=function(){a._saveRelationToServer().then(function(b){var c={module:"Schema",type:"success",provider:"dreamfactory",message:"Relation saved."};d.success(c),a.relation=new h(a.relation.record),a.$emit("update:managedtable")},function(a){var b={module:"Schema",type:"error",provider:"dreamfactory",message:a};d.error(b)})};var i=a.$watch("relationData",function(b,c){b&&(a.relation=b.__dfUI.newRelation?new h:new h(b.record))});a.helpText={db_function:{title:"DB Function",text:"Enter a db function like max(fieldname) or concat(field1, '.', field2)"}},a.$on("$destroy",function(a){i()})}}}]).directive("dfSchemaNavigator",["MOD_SCHEMA_ASSET_PATH","dfApplicationData",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-schema-navigator.html",link:function(a,b,c){}}}]).directive("dfSchemaEditor",["MOD_SCHEMA_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-schema-editor.html",link:function(a,b,c){}}}]).directive("dfSchemaResizable",[function(){return{restrict:"A",scope:{},link:function(a,b,c){$(function(){$("#schema-navigator-resizable").resizable({alsoResize:"#schema-navigator-resizable-also"}),$("#schema-navigator-resizable-also").resizable()})}}}]).directive("dfUploadSchema",["MOD_SCHEMA_ASSET_PATH","dfNotify",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-upload-schema.html",link:function(a,c,d){a.uploadEditor=null,a.uploadIsEditorClean=!0,a.uploadIsEditable=!0,a.uploadSchemaData={resource:[{name:"todo",label:"Todo",plural:"Todos",alias:null,field:[{name:"id",label:"Id",type:"id"},{name:"name",label:"Name",type:"string",size:80,allow_null:!1},{name:"complete",label:"Complete",type:"boolean"}]}]},a.uploadSchema=function(){a._uploadSchema()},a.closeUploadSchema=function(){a._closeUploadSchema()},a._uploadSchema=function(){var c={params:{include_schema:!0},data:angular.fromJson(a.uploadEditor.getValue())};a._saveSchemaToServer(c).then(function(c){var d={module:"Schema",type:"success",provider:"dreamfactory",message:"Tables created successfully."};angular.forEach(c.data.table,function(b){a.currentService.components.push({__dfUI:{newTable:!1},name:b.name,path:"_schema/"+b.name})}),a.uploadEditor.session.getUndoManager().reset(),a.uploadEditor.session.getUndoManager().markClean(),a.uploadIsEditorClean=!0,b.success(d)},function(a){var c={module:"Api Error",type:"error",provider:"dreamfactory",message:a};b.error(c)})},a._closeUploadSchema=function(){if(!a.uploadIsEditorClean){if(!b.confirm("You have unsaved changes.  Continue without saving?"))return;a.$parent.currentUploadSchema=null}a.$parent.currentUploadSchema=null}}}}]).directive("jsonEdit",function(){return{restrict:"A",require:"ngModel",template:'<textarea ng-model="jsonEditing"></textarea>',replace:!0,scope:{model:"=jsonEdit"},link:function(a,b,c,d){function e(b){a.jsonEditing=angular.copy(j(b))}function f(b){a.model=i(b)}function g(){d.$setValidity("json",!0)}function h(){d.$setValidity("json",!1)}function i(a){try{return angular.fromJson(a)}catch(b){return h(),a}}function j(a){return angular.toJson(a,!0)}function k(a){var b=!0;try{angular.fromJson(a)}catch(c){b=!1}return b}e(a.model),a.$watch("jsonEditing",function(a,b){a!=b&&(k(a)?(g(),f(a)):h())},!0),a.$watch("model",function(a,b){a!=b&&e(a)},!0)}}}),angular.module("dfScripts",["ngRoute","dfUtility"]).constant("MODSCRIPTING_ROUTER_PATH","/scripts").constant("MODSCRIPTING_ASSET_PATH","admin_components/adf-scripts/").constant("MODSCRIPTING_EXAMPLES_PATH","admin_components/adf-scripts/examples/").config(["$routeProvider","MODSCRIPTING_ROUTER_PATH","MODSCRIPTING_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"ScriptsCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$http",function(a,b){}]).controller("ScriptsCtrl",["INSTANCE_URL","SystemConfigDataService","$scope","$http","dfApplicationData","dfNotify","MODSCRIPTING_EXAMPLES_PATH",function(a,b,c,d,e,f,g){c.$parent.title="Scripts";var h=function(a,b,c){return{name:a,type:b||"v8js",content:c||"",is_active:!1,__newScript:!0}};c.highlightScript=function(){d({method:"GET",url:a+"/api/v2/system/event",params:{only_scripted:!0}}).then(function(a){c.highlightedEvents=a.data.resource,c.events.process.$$isHighlighted=c.highlightEvent(c.events.process),c.events.broadcast.$$isHighlighted=c.highlightEvent(c.events.broadcast)})},c.handleFiles=function(a){if(a){var b=a&&a[0];if(b){var d=new FileReader;d.readAsText(b,"UTF-8"),d.onload=function(a){c.currentScriptObj.content=a.target.result,c.$apply()},d.onerror=function(a){console.log("error")}}}},c.__getDataFromHttpResponse=function(a){return a?a.hasOwnProperty("data")?a.data.hasOwnProperty("record")?a.data.record:a.data.hasOwnProperty("resource")?a.data.resource:a.data:void 0:[]},c.isHostedSystem=!1,c.eventTypes=[{name:"process-scripts",label:"Process Event Scripts",item_name:"process"}],c.samplesScripts=null,e.getApiData("event",null,!0).then(function(a){c.events=e.getApiData("event"),c.highlightScript()}),c.scriptTypes=e.getApiData("script_type"),c.uppercaseVerbLabels=!0,c.allowedVerbs=["get","post","put","patch","delete"],c.currentEventTypeObj=null,c.currentServiceObj=null,c.currentPathObj=null,c.currentScriptObj=null,c.editor=null,c.isEditorClean=!0,c.setEventType=function(a){c._setEventType(a)},c.setService=function(a,b){c._setService(a,b)},c.setPath=function(a,b){c._setPath(a,b)},c.setScript=function(a){c._setScript(a)},c.setEventList=function(a,b,d){c.cachePath={verbs:c.currentPathObj.verbs,name:c.currentPathObj.name},c._setEventList(a,b,d)},c.clearEventList=function(){c.currentPathObj.events&&(c.cachePath.name=c.currentPathObj.name,c.cachePath.verb=c.currentPathObj.verb,c.cachePath.events=c.currentPathObj.events,c.currentPathObj.events=null,c.currentPathObj.verb=null,c.currentPathObj.verbs=null)},c.saveScript=function(){c._saveScript()},c.deleteScript=function(){f.confirm("Delete "+c.currentScriptObj.name+"?")&&c._deleteScript()},c.loadSamples=function(){c._loadSamples()},c._getEventFromServer=function(b){return d({method:"GET",url:a+"/api/v2/"+b.eventName,params:b.params})},c._getScriptFromServer=function(b){return d({method:"GET",url:a+"/api/v2/system/event/"+b.name,params:b.params})},c._saveScriptToServer=function(b){return d({method:"POST",url:a+"/api/v2/system/event/"+b.name,params:b.params,data:b.data}).then(c.highlightScript)},c._deleteScriptFromServer=function(b){return d({method:"DELETE",url:a+"/api/v2/system/event/"+b.name,params:b.params}).then(c.highlightScript)},c._isVariablePath=function(a){return"-1"!=a.path.indexOf("}")},c._resetAll=function(){if(0===c.menuPathArr.length||!c.menuBack())return!1;for(;0!==c.menuPathArr.length;)c._menuBack();return!0},c._setEventType=function(a){c._resetAll(),c.menuPathArr.push(a.label),c.currentEventTypeObj=a,c.pathFilter="";"process"===a.item_name?c.events.process.$$isHighlighted=c.highlightEvent(c.events.process):c.events.broadcast.$$isHighlighted=c.highlightEvent(c.events.broadcast)},c.highlightEvent=function(a){var b=!1;for(var d in a)"boolean"!=typeof a[d]&&(a[d].$$isHighlighted=c.highlightCurrentServiceObj({paths:a[d]}),a[d].$$isHighlighted&&(b=!0));return b},c._setService=function(a,b){return c.menuPathArr.push(a),c.currentServiceObj={name:a,paths:b},c.pathFilter="",c.highlightCurrentServiceObj(c.currentServiceObj),!1},c.highlightCurrentServiceObj=function(a){var b=!1;for(var d in a.paths)"boolean"!=typeof a.paths[d]&&(a.paths[d].$$isHighlighted=c.highlightCurrentPathObj({verbs:i(d,a.paths[d].verb,a.paths[d].parameter)}),a.paths[d].$$isHighlighted&&(b=!0));return b};var i=function(a,b,c){var d,e=angular.copy(b);return a.indexOf("{")>=0&&a.indexOf("}")>=0&&c&&angular.forEach(b,function(a,b){angular.forEach(c,function(c,f){angular.forEach(c,function(c,g){angular.forEach(a,function(a,g){d=a.replace("{"+f+"}",c),
e[b].push(d)})})})}),e};c._setPath=function(a,b){c.menuPathArr.push(a);var d=i(a,b.verb,b.parameter);c.currentPathObj={name:a,verbs:d},c.pathFilter="",c.highlightCurrentPathObj(c.currentPathObj)},c.highlightCurrentPathObj=function(a){var b=!1;for(var d in a.verbs)if("boolean"!=typeof a.verbs[d]){var e=a.verbs[d].filter(function(a){return c.highlightedEvents.some(function(b){return b===a})}).length;e&&(b=!0,a.verbs[d].$$isHighlighted=!0)}return b},c._setEventList=function(a,b,d){c.currentPathObj.name=a,c.currentPathObj.events=d,c.currentPathObj.verb=b,a&&c.menuPathArr.push("["+b.toUpperCase()+"] "+a)},c.isHighlightedItem=function(a){return c.highlightedEvents&&c.highlightedEvents.filter(function(b){return b===a}).length},c._setScript=function(a){var b={name:a,params:{}};c._getScriptFromServer(b).then(function(b){c.currentScriptObj=c.__getDataFromHttpResponse(b),c.menuPathArr.push(a)},function(b){c.currentScriptObj=new h(a,null,null),c.menuPathArr.push(a)})["finally"](function(){})},c._saveScript=function(){if(!c.currentScriptObj.name)return alert("Please enter a script name."),!1;c.currentScriptObj.content=c.editor.getValue()||" ";var a={name:c.currentScriptObj.name,params:{},data:c.currentScriptObj};c._saveScriptToServer(a).then(function(a){c.editor.session.getUndoManager().reset(),c.editor.session.getUndoManager().markClean(),c.isEditorClean=!0,$(function(){new PNotify({title:"Scripts",type:"success",text:'Script "'+c.currentScriptObj.name+'" saved successfully.'})})},function(a){throw{module:"Scripts",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){})},c._deleteScript=function(){var a={name:c.currentScriptObj.name,params:{}};c._deleteScriptFromServer(a).then(function(a){$(function(){new PNotify({title:"Scripts",type:"success",text:'Script "'+c.currentScriptObj.name+'" deleted successfully.'})}),c.menuPathArr.pop(),c.currentScriptObj=null,c.editor.session.getUndoManager().reset(),c.editor.session.getUndoManager().markClean()},function(a){throw{module:"Scripts",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){})},c._loadSamples=function(){return c._resetAll()?(d.get(g+"example.scripts.js").then(function(a){c.sampleScripts=new h("sample-scripts","v8js",a.data),c.currentEventTypeObj={name:"sample-scripts",label:"Sample Scripts"},c.currentScriptObj=c.sampleScripts,c.menuPathArr.push("Sample Scripts")},function(a){f.error(a),c.sampleScrips=""}),!1):void 0}}]).directive("scriptSidebarMenu",["MODSCRIPTING_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/script-sidebar-menu.html",link:function(a,b,c){a.menuOpen=!0,a.menuPathArr=[],a.pathFilter="",a.toggleMenu=function(){a._toggleMenu()},a.menuBack=function(){if(!a.isEditorClean){if(!a._confirmCloseScript())return!1;a.editor.session.getUndoManager().reset(),a.editor.session.getUndoManager().markClean(),a.isEditorClean=!0}return a._menuBack(),!0},a.jumpTo=function(b){a._jumpTo(b)},a._confirmCloseScript=function(){return confirm("You have unsaved changes.  Close anyway?")},a._menuBack=function(){if(!a.currentEventTypeObj)return!1;switch(a.currentEventTypeObj.name){case"process-scripts":switch(a.menuPathArr.length){case 0:break;case 1:a.menuPathArr.pop(),a.currentEventTypeObj=null,a.pathFilter="";break;case 2:a.menuPathArr.pop(),a.currentServiceObj=null,a.pathFilter="",a.highlightEvent(a.events.process);break;case 3:a.menuPathArr.pop(),a.currentPathObj=null,a.pathFilter="",a.highlightCurrentServiceObj(a.currentServiceObj);break;case 4:a.currentPathObj.events?(a.menuPathArr.splice(2,2),a.setPath(a.cachePath.name,{verb:a.cachePath.verbs})):(a.menuPathArr.pop(),a.currentScriptObj=null);break;case 5:a.currentScriptObj=null,a._setEventList(null,a.cachePath.verb,a.cachePath.events),a.menuPathArr.pop()}break;case"broadcast-scripts":switch(a.menuPathArr.length){case 0:break;case 1:a.menuPathArr.pop(),a.currentEventTypeObj=null,a.pathFilter="";break;case 2:a.menuPathArr.pop(),a.currentScriptObj=null,a.highlightEvent(a.events.broadcast);break;case 3:a.menuPathArr.pop(),a.currentPathObj=null,a.pathFilter="",a.highlightCurrentServiceObj(a.currentServiceObj);break;case 4:a.currentPathObj.events?(a.menuPathArr.splice(2,2),a.setPath(a.cachePath.name,{verb:a.cachePath.verbs})):(a.menuPathArr.pop(),a.currentScriptObj=null);break;case 5:a.currentScriptObj=null,a._setEventList(null,a.cachePath.verb,a.cachePath.events),a.menuPathArr.pop()}break;case"sample-scripts":a.menuPathArr.pop(),a.currentScriptObj=null,a.currentPathObj=null,a.currentServiceObj=null,a.currentEventTypeObj=null}},a._jumpTo=function(b){for(;a.menuPathArr.length-1!==b;)a.menuBack()},a._toggleMenu=function(){a.menuOpen=!a.menuOpen},a.$broadcast("script:loaded:success")}}}]).directive("dfAceEditorScripting",["INSTANCE_URL","MODSCRIPTING_ASSET_PATH","$http",function(a,b,c){return{restrict:"E",scope:{currentEditObj:"=?",isClean:"=?",editor:"=?"},templateUrl:b+"views/df-ace-editor.html",link:function(a,b,c){a.backupDoc="",a._setEditorInactive=function(b){b?(a.editor.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1}),a.editor.renderer.$cursorLayer.element.style.opacity=0):(a.editor.setOptions({readOnly:!1,highlightActiveLine:!0,highlightGutterLine:!0}),a.editor.renderer.$cursorLayer.element.style.opacity=100)},a._loadEditor=function(b,c,d){d=d||!1,a.editor&&a.editor.destroy(),a.editor=ace.edit("ide"),c?a.editor.session.setMode("ace/mode/json"):a.editor.session.setMode("ace/mode/javascript"),a.backupDoc=angular.copy(b),a._setEditorInactive(d),a.editor.session.setValue(b),a.editor.focus(),a.editor.on("input",function(){a.$apply(function(){a.isClean=a.editor.session.getUndoManager().isClean()})}),a.editor.on("blur",function(){a.$apply(function(){try{a.currentEditObj=a.editor.getValue()}catch(b){}})})};var d=a.$watch("currentEditObj",function(b,c){return"samples"===b?!1:null===!b||void 0===b?(a._loadEditor("",!1,!0),!1):void a._loadEditor(b,!1,!1)});a.$on("$destroy",function(b){d(),a.editor.destroy()})}}}]),angular.module("dfProfile",["ngRoute","dfUtility","dfUserManagement","dfApplication"]).constant("MOD_PROFILE_ROUTER_PATH","/profile").constant("MOD_PROFILE_ASSET_PATH","admin_components/adf-profile/").config(["$routeProvider","MOD_PROFILE_ROUTER_PATH","MOD_PROFILE_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"ProfileCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkProfileRoute:["dfApplicationData","SystemConfigDataService","$location","dfNotify",function(a,b,c,d){var e=a.getCurrentUser(),f=b.getSystemConfig(),g={};return!e&&f.allow_guest_user?(g={module:"DreamFactory Profile Module",type:"warn",provider:"dreamfactory",message:"Profile not available for guest users."},d.warn(g),void c.url("/launchpad")):void(e||f.allow_guest_user||c.url("/login"))}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("ProfileCtrl",["$scope","UserDataService",function(a,b){a.currentUser=b.getCurrentUser(),a.$parent.title="",a.links=[{name:"edit-profile",label:"Profile",path:"edit-profile"}]}]).directive("dfEditProfile",["MOD_PROFILE_ASSET_PATH","INSTANCE_URL","dfNotify","dfApplicationData","UserDataService","dfObjectService","$http","$cookies","$cookieStore","SystemConfigDataService",function(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",scope:{},templateUrl:a+"views/df-edit-profile.html",link:function(a,k,l){var m=function(a){return(a.adldap||a.oauth_provider)&&(angular.element("#set-password-section").hide(),angular.element("#set-security-question-section").hide()),{__dfUI:{},record:angular.copy(a),recordCopy:angular.copy(a)}},n=function(){return{reset:!0,login:!1,old_password:null,new_password:null}};a.user=null,a.password=null,a.bitnami_demo=j.getSystemConfig().platform.bitnami_demo,a.apps=d.getApiData("app"),a.updateUser=function(){a._updateUser()},a._getUserProfileFromServer=function(){return g({method:"GET",url:b+"/api/v2/user/profile"})},a._updateUserToServer=function(a){return g({method:"PUT",url:b+"/api/v2/user/profile",data:a.data})},a._updateUsers=function(a){return a.url=b+"/api/v2/system/admin/profile",d.updateApiData("admin",a).$promise},a._updateUserPasswordToServer=function(a){return g({method:"POST",url:b+"/api/v2/user/password",params:a.params,data:a.data})},a._updateAdminPasswordToServer=function(a){return g({method:"POST",url:b+"/api/v2/system/admin/password",params:a.params,data:a.data})},a._updateUser=function(){if(e.getCurrentUser().is_sys_admin){var b=a.user.record;b.id=e.getCurrentUser().id;var d={params:{fields:"*"},data:b};if(a._updateUsers(d).then(function(b){var d=b.session_token||b.data&&b.data.session_token;if(d){g.defaults.headers.common["X-DreamFactory-Session-Token"]=d,h.PHPSESSID=d;var f=e.getCurrentUser();f.session_token=d,f.session_id=d,i.put("CurrentUserObj",f)}var j={module:"Profile",type:"success",provider:"dreamfactory",message:"Profile updated successfully."};a.setQuestion=!1,c.success(j)},function(a){var b={module:"Profile",type:"error",provider:"dreamfactory",message:a};c.error(b)}),a.user.record.hasOwnProperty("security_question")&&delete a.user.record.security_question,a.user.record.hasOwnProperty("security_answer")&&delete a.user.record.security_answer,e.setCurrentUser(f.mergeObjects(a.user.record,e.getCurrentUser())),a.setPassword){var j={params:{reset:a.password.reset,login:a.password.login},data:{old_password:a.password.old_password,new_password:a.password.new_password}};a._updateAdminPasswordToServer(j).then(function(b){var d={module:"Profile",type:"success",provider:"dreamfactory",message:"Password updated successfully."};c.success(d),a.setPassword=!1},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})}}else{var k={data:a.user.record};if(a._updateUserToServer(k).then(function(b){var d=b.session_token||b.data.session_token;if(d){g.defaults.headers.common["X-DreamFactory-Session-Token"]=d,h.PHPSESSID=d;var j=e.getCurrentUser();j.session_token=d,j.session_id=d,i.put("CurrentUserObj",j)}var k={module:"Profile",type:"success",provider:"dreamfactory",message:"Profile updated successfully."};a.setQuestion=!1,c.success(k),a.user.record.hasOwnProperty("security_question")&&delete a.user.record.security_question,a.user.record.hasOwnProperty("security_answer")&&delete a.user.record.security_answer,e.setCurrentUser(f.mergeObjects(a.user.record,e.getCurrentUser()))},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)}),a.setPassword){var j={params:{reset:a.password.reset,login:a.password.login},data:{old_password:a.password.old_password,new_password:a.password.new_password}};a._updateUserPasswordToServer(j).then(function(b){var d={module:"Profile",type:"success",provider:"dreamfactory",message:"Password updated successfully."};c.success(d),a.setPassword=!1},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};c.error(b)})}}};var o=a.$watch("user",function(b,d){null===b&&a._getUserProfileFromServer().then(function(b){a.user=new m(b.data)},function(b){var d={module:"Api Error",type:"error",provider:"dreamfactory",message:b};c.error(d),a.user="error"})}),p=a.$watch("setPassword",function(b,c){b?(a.updatePassword=!0,a.password=new n):a.password=null});a.$on("$destroy",function(a){o(),p()})}}}]),angular.module("dfApplication",["dfUtility","dfUserManagement","ngResource"]).run(["$q","dfApplicationData","dfApplicationPrefs","dfAvailableApis","dfSessionStorage","UserDataService","SystemConfigDataService","$location","$rootScope",function(a,b,c,d,e,f,g,h,i){var j=g.getSystemConfigFromServerSync();g.setSystemConfig(j),!e.getItem("dfApplicationObj")&&f.getCurrentUser()?(b.initInProgress=!0,i.initInProgress=!0,b.initDeferred=a.defer(),j.is_hosted?b.init(d.getApis().addEventApi().apis).then(function(){b.initDeferred.resolve(),b.initInProgress=!1},function(){b.initInProgress=!1,h.url("/logout")}):b.init(d.getApis().apis).then(function(){b.initDeferred.resolve(),b.initInProgress=!1},function(){b.initInProgress=!1,h.url("/logout")})):e.getItem("dfApplicationObj")&&f.getCurrentUser()?(b.initInProgress=!0,i.initInProgress=!0,b.initDeferred=a.defer(),j.is_hosted?b.init(d.getApis().addEventApi().apis).then(function(){b.initDeferred.resolve(),b.initInProgress=!1},function(){b.initInProgress=!1,h.url("/logout")}):b.init(d.getApis().apis).then(function(){b.initDeferred.resolve(),b.initInProgress=!1},function(){b.initInProgress=!1,h.url("/logout")})):e.getItem("dfApplicationObj")||f.getCurrentUser()?e.getItem("dfApplicationObj")&&!f.getCurrentUser()?(e.removeItem("dfApplicationObj"),b.destroyApplicationObj(),h.url("/login")):alert("dfAplicationData: INIT: This should not be reached"):b.destroyApplicationObj()}]).service("dfApplicationData",["$q","$http","INSTANCE_URL","dfObjectService","UserDataService","dfSystemData","dfSessionStorage","dfApplicationPrefs","$rootScope","$location","dfMainLoading",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){return a.params?void angular.forEach(a.params,function(b,c){null==b&&delete a.params[c]}):void(a.params={})}function m(b){var c={api_name:b,params:{}};return c.params=h.getPrefs().data[b],l(c),"system"===c.api_name&&(c.api_name=""),f.getSystemApisFromServer(c).then(function(a){switch(b){case"system":A.apis.system={},A.apis.system.resource=a.data.resource;break;case"config":A.apis.config={},A.apis.config.resource=new Array(a.data);break;default:A.apis[b]=a.data}},a.reject)}function n(b){var c,d=a.defer();if(A.currentUser=e.getCurrentUser(),A.currentUser.is_sys_admin){var c=u();c=angular.fromJson(c.response),null!==c&&c.hasOwnProperty("application")&&null!==c.application&&h.setPrefs(c)}if(A.currentUser.is_sys_admin){var f=[];b.length;f=b.map(m),a.all(f).then(function(){g.setItem("dfApplicationObj",angular.toJson(A,!0)),d.resolve(),i.initInProgress=!1},d.reject)}else d.resolve();return d.promise}function o(){A={currentUser:null,apis:{}}}function p(a,b){l(b);var c=b.params;return c.api=a,b.dontWrapData||(b.data={resource:[b.data]}),f.resource(b).post(c,b.data,function(b){b&&b.resource&&"[object Array]"===Object.prototype.toString.call(b.resource)&&b.resource.length>0&&(b=b.resource[0]),v(a,b)})}function q(a,b){l(b);var c=b.params;return c.api=a,"config"===a&&(c.id=null),f.resource({url:b.url})[b.method||"put"](c,b.data,function(b){w(a,b)})}function r(a,b){l(b);var c=b.params;return c.api=a,c.rollback=h.getPrefs().data[a].rollback,f.resource()["delete"](c,b.data,function(b){x(a,b)})}function s(a,b){b=b||{params:{}};var c=h.getPrefs().data[a];b.params=d.mergeObjects(c,b.params);var e=b.params;return e.api=a,f.resource(b).get(e,function(b){y(a,b)})}function t(a){var b={resource:[{name:"adminPreferences",value:a}]};return e.saveUserSetting(b)}function u(){return e.getUserSetting("adminPreferences",!0)}function v(a,b){return A.apis.hasOwnProperty(a)&&"[object Array]"===Object.prototype.toString.call(A.apis[a].resource)&&A.apis[a].resource.push(b),A.apis.hasOwnProperty(a)&&A.apis[a].hasOwnProperty("meta")&&"[object Object]"===Object.prototype.toString.call(A.apis[a].meta)&&(A.apis[a].meta.hasOwnProperty("count")?A.apis[a].meta.count++:A.apis[a].meta.count=1),g.setItem("dfApplicationObj",angular.toJson(A,!0))?!0:void 0}function w(a,b){if(b.resource&&(b=b.resource),A.apis.hasOwnProperty(a)&&"[object Array]"===Object.prototype.toString.call(A.apis[a].resource))for(var c=!1,d=0;!c&&d<=A.apis[a].resource.length-1;)b.id===A.apis[a].resource[d].id&&(c=!0,A.apis[a].resource.splice(d,1,b)),d++;return g.setItem("dfApplicationObj",angular.toJson(A,!0))?!0:void 0}function x(a,b){function c(b){for(var c=!1,d=0;!c&&d<A.apis[a].resource.length;)b.id===A.apis[a].resource[d].id&&(c=!0,A.apis[a].resource.splice(d,1)),d++}function d(){A.apis.hasOwnProperty(a)&&A.apis[a].hasOwnProperty("meta")&&"[object Object]"===Object.prototype.toString.call(A.apis[a].meta)&&A.apis[a].meta.hasOwnProperty("count")&&A.apis[a].meta.count--}return A.apis.hasOwnProperty(a)&&"[object Array]"===Object.prototype.toString.call(A.apis[a].resource)&&(b.hasOwnProperty("resource")?angular.forEach(b.resource,function(a){c(a),d()}):(c(b),d()),g.setItem("dfApplicationObj",angular.toJson(A,!0)))?!0:void 0}function y(a,b){return A.apis.hasOwnProperty(a)&&"[object Array]"===Object.prototype.toString.call(A.apis[a].resource)&&(A.apis[a].resource=b.resource),g.setItem("dfApplicationObj",angular.toJson(A,!0))?!0:void 0}function z(){return j.path()}var A={currentUser:null,apis:{}},B={numElemsToLoad:0,percentLoaded:0,loadData:{op:"Loading",module:null,percent:0}};return{initInProgress:!1,initDeferred:null,init:function(a){return a=a||[],n(a)},getApplicationObj:function(){return A},setApplicationObj:function(a){A=a},setApplicationObjOverride:function(a){A=a,this.updateApplicationStore()},updateApplicationStore:function(){g.setItem("dfApplicationObj",angular.toJson(A,!0))},destroyApplicationObj:function(){return o(),g.removeItem("dfApplicationObj")?!0:void 0},getApiData:function(a,b,c){if(b=b||null,"meta"===b&&A.apis.hasOwnProperty(a)&&A.apis[a].meta)return A.apis[a].meta;if(c){if(b&&b.filter){var d=h.getPrefs();angular.extend(d.data.admin,b),h.setPrefs(d)}else{var d=h.getPrefs();d.data.admin&&d.data.admin.filter&&delete d.data.admin.filter,h.setPrefs(d)}return m(a)}if(A.apis.hasOwnProperty(a)){if(b){var e=[];for(var f in b){switch(Object.prototype.toString.call(b[f])){case"[object String]":b[f]=b[f].split(",");break;case"[object Array]":}angular.forEach(A.apis[a].resource,function(a){angular.forEach(b[f],function(b){a.hasOwnProperty(f)&&a[f]===b&&e.push(a)})})}return e}return A.apis[a].resource?A.apis[a].resource:A.apis[a]}},saveApiData:function(a,b){return A.apis.hasOwnProperty(a)?p(a,b):void 0},updateApiData:function(a,b){return A.apis.hasOwnProperty(a)?q(a,b):void 0},deleteApiData:function(a,b){return A.apis.hasOwnProperty(a)?r(a,b):void 0},getDataSetFromServer:function(a,b){return A.apis.hasOwnProperty(a)?s(a,b):void 0},getCurrentUser:function(){return A.hasOwnProperty("currentUser")?A.currentUser:void 0},saveAdminPrefs:function(a){return t(a)},getAdminPrefs:function(){return u()},getMainLoadData:function(){return B},getLocation:function(){return z()},getServiceComponents:function(d,e,f,g){var h=a.defer(),i=this.getApiData("service",{name:d})[0];if(i.components&&!g)h.resolve(i.components);else{var j=e||c+"/api/v2/"+i.name+"/?as_access_list=true";b.get(j,f||{}).success(function(a){i.components=a.resource||a,h.resolve(i.components),w("service",i)})}return h.promise},updateServiceComponentsLocal:function(a){var b=this.getApiData("service",{name:a.name})[0];b.components=a.components}}}]).service("dfSystemData",["$http","XHRHelper","INSTANCE_URL","$resource","dfObjectService",function(a,b,c,d,e){function f(a){var c=b.ajax(a),c=$.ajax(a);return 4==c.readyState&&200==c.status?angular.fromJson(c.responseText):4==c.readyState&&401===c.status?"Unauthorized":void 0}return{getSystemApisFromServerSync:function(a){var b={url:"system/"+a.api_name,params:a.params};return f(b)},getSystemApisFromServer:function(b){return a({url:c+"/api/v2/system/"+b.api_name,method:"GET",params:b.params})},http:function(b,d){return{"delete":function(){return a({url:c+"/api/v2/system/"+b,method:"DELETE",data:d.data})}}},resource:function(a){a=a||{};var b={headers:""};a=e.mergeObjects(a,b);var f=a.url||c+"/api/v2/system/:api/:id",g=a.queryParams||{api:"@api",id:"@id"};return d(f,g,{get:{method:"GET",headers:a.headers},post:{method:"POST",headers:a.headers},put:{method:"PUT",headers:a.headers},patch:{method:"PATCH",headers:a.headers},"delete":{method:"DELETE",headers:a.headers}})}}}]).service("dfApplicationPrefs",[function(){var a={application:{notificationSystem:{success:"pnotify",error:"pnotify",warn:"pnotify"}},data:{app:{include_count:!0,limit:100,related:"role_by_role_id"},app_group:{include_count:!0,limit:100,related:"app_to_app_group_by_group_id"},role:{include_count:!0,related:"role_service_access_by_role_id,role_lookup_by_role_id",limit:100},admin:{include_count:!0,limit:20,related:"user_lookup_by_user_id"},user:{include_count:!0,limit:20,related:"user_lookup_by_user_id,user_to_app_to_role_by_user_id"},service:{include_count:!0,include_components:!0,limit:100,related:"service_doc_by_service_id"},config:{},email_template:{},lookup:{},cors:{},event:{full_map:!0}},sections:{app:{autoClose:!1,manageViewMode:"table"},role:{autoClose:!1,manageViewMode:"table"},admin:{autoClose:!1,manageViewMode:"table"},user:{autoClose:!1,manageViewMode:"table"},service:{autoClose:!1,manageViewMode:"table"}}};return{getPrefs:function(){return a},setPrefs:function(b){a=b}}}]).service("dfAvailableApis",[function(){return{apis:["system","environment","config","service_type","service","app","role","admin","user","email_template","lookup","cors","app_group","event","script_type"],getApis:function(){return this},addEventApi:function(){return this}}}]).factory("httpVerbInterceptor",["$q","SystemConfigDataService",function(a,b){return{request:function(a){if(b.getSystemConfig().restricted_verbs.length<=0)return a;for(var c=b.getSystemConfig().restricted_verbs,d=0,e=a.method;d<c.length;){if(e===c[d]){a.method="POST",a.headers["X-HTTP-METHOD"]=e;break}d++}return a}}}]).factory("httpWrapperInterceptor",["SystemConfigDataService",function(a){return{request:function(b){var c=a.getSystemConfig()||{};if(!c.config)return b;if(b.data instanceof Array&&c.config.alway_wrap_resources){var d={};d[c.config.resource_wrapper]=angular.copy(b.data),b.data=d}return b},response:function(b){var c=a.getSystemConfig()||{};if("object"!=typeof b.data||!c.config)return b;var d=Object.keys(b.data);return c.config.always_wrap_resources&&1===d.length&&b.data[d[0]]instanceof Array&&d[0]===c.config.resource_wrapper&&(b.data=b.data[c.config.resource_wrapper]),b}}}]).factory("httpValidSession",["$q","$rootScope","$location","INSTANCE_URL","$injector","$cookies",function(a,b,c,d,e,f){var g=function(a){var b=e.get("$http"),c=e.get("UserDataService"),g=c.getCurrentUser(),j=e.get("$q").defer(),k=g.is_sys_admin?"/api/v2/system/admin/session":"/api/v2/user/session";return b({method:"PUT",url:d+k}).then(function(d){b.defaults.headers.common["X-DreamFactory-Session-Token"]=d.data.session_token,f.PHPSESSID=f.PHPSESSID===d.data.session_token?f.PHPSESSID:d.data.session_token,c.setCurrentUser(d.data),h(a.config,j)},function(){i(a,j)}),j.promise},h=function(a,b){var c=e.get("$http");return c({method:a.method,url:a.url}).then(b.resolve,b.reject),b.promise},i=function(a,c){f.PHPSESSID="";var d=e.get("$http");d.defaults.headers.common["X-DreamFactory-Session-Token"]="";var g=e.get("UserDataService");g.unsetCurrentUser();var c=(e.get("UserEventsService"),c||e.get("$q").defer());return b.$$childHead.openLoginWindow(a),b.$on("user:login:success",function(){h(a.config,c)}),c.promise};return{request:function(a){return a},requestError:function(b){return a.reject(b)},response:function(a){return a},responseError:function(d){switch(c.path()){case"/login":case"/user-invite":case"/register-confirm":case"/register":case"/register-complete":break;default:if((401===d.status||401===d.data.error.code)&&-1===d.config.url.indexOf("/session")&&b.initInProgress===!1)return"Token has expired"===d.data.error.message||-1!==d.config.url.indexOf("/profile")?g(d):i(d)}return a.reject(d)}}}]).directive("dfPaginateTable",["MOD_UTILITY_ASSET_PATH","INSTANCE_URL","$http","dfApplicationData","dfApplicationPrefs","dfNotify",function(a,b,c,d,e,f){return{restrict:"E",scope:{api:"=",linkedData:"=",prepFunc:"&"},templateUrl:a+"views/df-paginate-table.html",link:function(a,b,c){a.totalCount=d.getApiData(a.api,"meta").count,a.pagesArr=[],a.currentPage={},a.isInProgress=!1,a.getPrevious=function(){return a._isFirstPage()||a.isInProgress?!1:void a._getPrevious()},a.getNext=function(){return a._isLastPage()||a.isInProgress?!1:void a._getNext()},a.getPage=function(b){a._getPage(b)},a._getDataFromServer=function(b){return d.getDataSetFromServer(a.api,{params:{offset:b}}).$promise},a._calcTotalPages=function(a,b){return Math.ceil(a/b)},a._createPageObj=function(b){return{number:b+1,value:b,offset:b*e.getPrefs().data[a.api].limit,stopPropagation:!1}},a._createPagesArr=function(b){a.pagesArr=[];for(var c=0;b>c;c++)a.pagesArr.push(a._createPageObj(c))},a._setCurrentPage=function(b){a.currentPage=b},a._getCurrentPage=function(){return!a.currentPage&&a.pagesArr.length>0?a.currentPage=a.pagesArr[0]:a.currentPage||a.pagesArr.length||(a.pagesArr.push(a._createPageObj(0)),a.currentPage=a.pagesArr[0]),a.currentPage},a._isFirstPage=function(){return 0===a._getCurrentPage().value},a._isLastPage=function(){return a.currentPage.value===a.pagesArr.length-1},a._previousPage=function(){a.currentPage=a.pagesArr[a.currentPage.value-1]},a._nextPage=function(){a.currentPage=a.pagesArr[a.currentPage.value+1]},a._calcPagination=function(b){return a.pagesArr=[],0==a.totalCount?(a.pagesArr.push(a._createPageObj(0)),!1):void a._createPagesArr(a._calcTotalPages(a.totalCount,e.getPrefs().data[b].limit))},a._getPrevious=function(){if(a.isInProgress)return!1;a.isInProgress=!0;var b=a.pagesArr[a.currentPage.value-1].offset;a._getDataFromServer(b).then(function(b){a.linkedData=a.prepFunc({dataArr:b.resource}),a._previousPage()},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};f.error(b)})["finally"](function(){a.isInProgress=!1})},a._getNext=function(){if(a.isInProgress)return!1;a.isInProgress=!0;var b=a.pagesArr[a.currentPage.value+1].offset;a._getDataFromServer(b).then(function(b){a.linkedData=a.prepFunc({dataArr:b.resource}),a._nextPage()},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};f.error(b)})["finally"](function(){a.isInProgress=!1})},a._getPage=function(b){return a.isInProgress?!1:(a.isInProgress=!0,void a._getDataFromServer(b.offset).then(function(c){a.linkedData=a.prepFunc({dataArr:c.resource}),a._setCurrentPage(b)},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};f.error(b)})["finally"](function(){a.isInProgress=!1}))};a.$watch("api",function(b,c){return b?(a._calcPagination(b),void a._setCurrentPage(a.pagesArr[0])):!1});a.$on("dfPaginate:reset:"+a.api,function(b){if(a.isInProgress)return!1;a.isInProgress=!0;var c=0;a._getDataFromServer(c).then(function(b){a.linkedData=a.prepFunc({dataArr:b.resource}),a._setCurrentPage(a.pagesArr[0])},function(a){var b={module:"DreamFactory Paginate Table",type:"error",provider:"dreamfactory",message:a};f.error(b)})["finally"](function(){a.isInProgress=!1})})}}}]),angular.module("dfHelp",[]).constant("MOD_HELP_ASSET_PATH","admin_components/adf-help/").directive("dfSimpleHelp",["MOD_HELP_ASSET_PATH",function(a){return{restrict:"E",replace:!0,scope:{options:"=?"},templateUrl:a+"views/simple-help.html",link:function(a,b,c){var d=$(b).children(".help-box");a.showHelp=function(){a._showHelp()},a.closeHelp=function(){a._closeHelp()},a._setVisible=function(){d.is(":hidden")&&d.show()},a._setHidden=function(){d.is(":visible")&&d.hide()},a._setWidth=function(){d.css({width:$(window).outerWidth()/3})},a._showHelp=function(){return d.is(":visible")?(a.closeHelp(),!1):(d.addClass("dfp-right-bottom"),a._setWidth(),void a._setVisible())},a._closeHelp=function(){return d.is(":hidden")?!1:(d.removeClass("dfp-right-bottom"),void a._setHidden())}}}}]).directive("dfLargeHelp",["MOD_HELP_ASSET_PATH","$compile",function(a,b){return{restrict:"E",replace:!0,scope:{options:"="},templateUrl:a+"views/df-large-help.html",link:function(a,b,c){a.$watch("options",function(a,c){a&&(a.hasOwnProperty("title")&&$(b).children(".df-large-help-title").html(a.title),a.hasOwnProperty("text")&&$(b).children(".df-large-help-text").html(a.text))})}}}]),angular.module("dfLaunchPad",["ngRoute","dfUtility","dfTable"]).constant("MOD_LAUNCHPAD_ROUTER_PATH","/launchpad").constant("MOD_LAUNCHPAD_ASSET_PATH","admin_components/adf-launchpad/").config(["$routeProvider","MOD_LAUNCHPAD_ROUTER_PATH","MOD_LAUNCHPAD_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"LaunchpadCtrl",resolve:{loadApps:["SystemConfigDataService","UserDataService","$location","$q","$http","INSTANCE_URL",function(a,b,c,d,e,f){var g=d.defer(),h=a.getSystemConfig(),i=h.app_group,j=h.no_group_app,k=location.search.substring(1);return k?void c.url("/login"):i&&0!=i.length||j&&0!=j.length||b.getCurrentUser()?(b.getCurrentUser()?b.getCurrentUser()&&e.get(f+"/api/v2/system/environment").then(function(a){g.resolve(a.data)},function(a){g.reject(a)}):g.resolve(h),g.promise):void c.url("/login")}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("LaunchpadCtrl",["$scope","UserDataService","SystemConfigDataService","loadApps",function(a,b,c,d){a.apps=[],a.noAppsMsg=!1,a.onlyNoGroupApps=!1,a.noGroupTitle="Other Apps",a.$watch(function(){return d},function(b,c){if(b){if(a.apps=[],b.hasOwnProperty("app_group")&&angular.forEach(b.app_group,function(b){b.app.length&&(angular.forEach(b.app,function(a,c){a.url||b.app.splice(c,1)}),a.apps.push(b))}),b.hasOwnProperty("no_group_app")&&b.no_group_app.length>0){a.onlyNoGroupApps=0===a.apps.length;var d=[];angular.forEach(b.no_group_app,function(a,b){a.url&&d.push(a)}),a.onlyNoGroupApps?a.apps=d:d.length>0&&a.apps.push({name:a.noGroupTitle,id:"000",app:d})}a.noAppsMsg=0===a.apps.length}},!0)}]).directive("dfAppGroup",["MOD_LAUNCHPAD_ASSET_PATH",function(a){return{restrict:"E",scope:{appGroup:"="},replace:!0,templateUrl:a+"views/df-app-group.html",link:function(a,b,c){}}}]).directive("dfApp",["MOD_LAUNCHPAD_ASSET_PATH","$window","dfReplaceParams",function(a,b,c){return{restrict:"E",scope:{app:"="},replace:!0,templateUrl:a+"views/df-app.html",link:function(a,d,e){a.launchApp=function(b){a._launchApp(b)},a._launchApp=function(a){b.open(c(a.url,a.name))}}}}]),angular.module("dfWidgets",[]).constant("MOD_WIDGETS_ASSET_PATH","admin_components/adf-widgets/").directive("dfTwitter",["MOD_WIDGETS_ASSET_PATH","$http",function(a,b){return{restrict:"E",scope:{},templateUrl:a+"views/df-twitter.html",link:function(a,b,c){}}}]).directive("dfBlog",["MOD_WIDGETS_ASSET_PATH",function(a){return{restrict:"E",scope:{},templateUrl:a+"views/df-blog.html",link:function(a,b,c){}}}]).directive("dfEvents",["MOD_WIDGETS_ASSET_PATH",function(a){return{restrict:"E",scope:{},templateUrl:a+"views/df-events.html",link:function(a,b,c){}}}]).directive("dfNews",["MOD_WIDGETS_ASSET_PATH",function(a){return{restrict:"E",scope:{},templateUrl:a+"views/df-news.html",link:function(a,b,c){}}}]),angular.module("dfSwaggerEditor",["ngRoute","dfUtility","dfApplication","dfHelp"]).constant("MOD_SWAGGER_EDITOR_ASSET_PATH","admin_components/adf-swagger-editor/").run(["INSTANCE_URL","$templateCache",function(a,b){}]).directive("dfSwaggerEditorMain",["MOD_SWAGGER_EDITOR_ASSET_PATH","$timeout",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/main.html",link:function(a,b,c){a.swaggerFile=null,a.$watch("service",function(b,c){b&&b.record.hasOwnProperty("service_doc_by_service_id")&&(a.swaggerFile=angular.copy(angular.fromJson(b.record.service_doc_by_service_id[0].content)))})}}}]).directive("dfSwaggerInfo",["MOD_SWAGGER_EDITOR_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-swagger-info.html",link:function(a,b,c){}}}]).directive("dfSwaggerProduceConsume",["MOD_SWAGGER_EDITOR_ASSET_PATH",function(a){return{restrict:"E",scope:!1,templateUrl:a+"views/df-swagger-produce-consume.html",link:function(a,b,c){a.produceTypes={json:{name:"application/json",label:"JSON",checked:!1},xml:{name:"application/xml",label:"XML",checked:!1},csv:{name:"application/csv",label:"CSV",checked:!1}},a.consumeTypes={json:{name:"application/json",label:"JSON",checked:!1},xml:{name:"application/xml",label:"XML",checked:!1},csv:{name:"application/csv",label:"CSV",checked:!1}},a._typeAddRemove=function(b,c){var d=0;if(b.checked)a.swaggerFile[c].push(b.name);else for(;d<a.swaggerFile[c].length;){if(a.swaggerFile[c][d]===b.name){
a.swaggerFile[c].splice(d,1);break}d++}},a.$watch("swaggerFile",function(b,c){b&&(b.produces.length&&angular.forEach(b.produces,function(b){switch(b){case"application/json":a.produceTypes.json.checked=!0;break;case"application/xml":a.produceTypes.xml.checked=!0}}),b.consumes.length&&angular.forEach(b.consumes,function(b){switch(b){case"application/json":a.consumeTypes.json.checked=!0;break;case"application/xml":a.consumeTypes.xml.checked=!0}}))})}}}]).directive("dfSwaggerApis",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerFactory","SwaggerModels",function(a,b,c){return{restrict:"E",scope:{swaggerFile:"=?"},templateUrl:a+"views/df-swagger-apis.html",link:function(a,d,e){a.apis=[];var f=0;a.addApi=function(){a._addApi()},a._addApi=function(c){c=c||null;var d=new b("api",c);d.__dfUI.id=f,a.swaggerFile.apis.push(d.record),f++},a.$watch("swaggerFile",function(b,d){b&&(b.hasOwnProperty("apis")&&(a.apis=[],angular.forEach(b.apis,function(b){a._addApi(b)})),b.hasOwnProperty("models")&&c.setModels(b.models))})}}}]).directive("dfSwaggerApi",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerFactory",function(a,b){return{restrict:"E",scope:{api:"="},templateUrl:a+"views/df-swagger-api.html",link:function(a,b,c){a.apiVisible=!1,a.toggleApi=function(){a._toggleApi()},a._toggleApi=function(){a.apiVisible=!a.apiVisible}}}}]).directive("dfSwaggerOperations",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerFactory",function(a,b){return{restrict:"E",scope:{operationsData:"=?"},templateUrl:a+"views/df-swagger-operations.html",link:function(a,c,d){a.operations=[],a.operationsVisible=!1,a.addOperation=function(){a._addOperation()},a.toggleOperations=function(){a._toggleOperations()},a._addOperation=function(c){c=c||null,a.operations.push(new b("operation",c))},a._toggleOperations=function(){a.operationsVisible=!a.operationsVisible};var e=a.$watch("operationsData",function(b,c){b&&(a.operations=[],angular.forEach(b,function(b){a._addOperation(b)}))});a.$on("$destroy",function(a){e()})}}}]).directive("dfSwaggerOperation",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerModels",function(a,b){return{restrict:"E",scope:{operation:"="},templateUrl:a+"views/df-swagger-operation.html",link:function(a,c,d){a.methods=["GET","POST","PUT","PATCH","DELETE","MERGE","OPTIONS","HEAD"],a.models=b.getModels(),a.operationVisible=!1,a.toggleOperation=function(){a._toggleOperation()},a._toggleOperation=function(){a.operationVisible=!a.operationVisible}}}}]).directive("dfSwaggerOperationProduceConsume",["MOD_SWAGGER_EDITOR_ASSET_PATH",function(a){return{restrict:"E",scope:{operation:"=?"},templateUrl:a+"views/df-swagger-operation-produce-consume.html",link:function(a,b,c){a.produces=[],a.consumes=[],a.produceTypes={json:{name:"application/json",label:"JSON",checked:!1},xml:{name:"application/xml",label:"XML",checked:!1},csv:{name:"application/csv",label:"CSV",checked:!1}},a.consumeTypes={json:{name:"application/json",label:"JSON",checked:!1},xml:{name:"application/xml",label:"XML",checked:!1},csv:{name:"application/csv",label:"CSV",checked:!1}},a.$watch("operation",function(b,c){b&&(b.hasOwnProperty("produces")&&b.produces.length&&angular.forEach(b.produces,function(b){switch(b){case"application/json":a.produceTypes.json.checked=!0;break;case"application/xml":a.produceTypes.xml.checked=!0}}),b.hasOwnProperty("consumes")&&b.consumes.length&&angular.forEach(b.consumes,function(b){switch(b){case"application/json":a.consumeTypes.json.checked=!0;break;case"application/xml":a.consumeTypes.xml.checked=!0}}))})}}}]).directive("dfSwaggerResponseMessages",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerFactory",function(a,b){return{restrict:"E",replace:!0,scope:{respData:"=?"},templateUrl:a+"views/df-swagger-response-messages.html",link:function(a,c,d){a.responseMessages=[],a.responseMessagesVisible=!1,a.toggleResponseMessages=function(){a._toggleResponseMessages()},a.addResponseMessage=function(){a._addResponseMessage()},a._addResponseMessage=function(c){c=c||null,a.responseMessages.push(new b("response-message",c))},a._toggleResponseMessages=function(){a.responseMessagesVisible=!a.responseMessagesVisible};var e=a.$watch("respData",function(b,c){b&&angular.forEach(b,function(b){a.responseMessages=[],a._addResponseMessage(b)})});a.$on("$destroy",function(a){e()})}}}]).directive("dfSwaggerResponseMessage",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerModels",function(a,b){return{restrict:"E",scope:{respMessage:"="},templateUrl:a+"views/df-swagger-response-message.html",link:function(a,b,c){}}}]).directive("dfSwaggerParameters",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerFactory",function(a,b){return{restrict:"E",scope:{parametersData:"=?"},templateUrl:a+"views/df-swagger-parameters.html",link:function(a,c,d){a.parameters=[],a.parametersVisible=!1,a.currentEditParameter=null,a.editParameter=function(b){a._editParameter(b)},a.toggleParameters=function(){a._toggleParameters()},a.addParameter=function(){a._addParameter()},a._editParameter=function(b){a.currentEditParameter=b},a._addParameter=function(c){c=c||null,a.parameters.push(new b("parameter",c))},a._toggleParameters=function(){a.parametersVisible=!a.parametersVisible};var e=a.$watch("parametersData",function(b,c){b&&(a.parameters=[],angular.forEach(b,function(b){a._addParameter(b)}))});a.$on("$destroy",function(a){e()})}}}]).directive("dfSwaggerParameter",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerModels","$compile","$templateCache",function(a,b,c,d){return{restrict:"E",scope:{parameter:"="},templateUrl:a+"views/df-swagger-parameter.html",link:function(a,c,d){var e=[{record:{id:"string"}},{record:{id:"number"}},{record:{id:"integer"}},{record:{id:"boolean"}},{record:{id:"array"}},{record:{id:"file"}}];a.types=null,a.paramTypes=["query","path","header","form","body"],a.collectionFormats=["csv","ssv","tsv","pipes","multi"],a.parameterVisible=!1,a.toggleParameter=function(){a._toggleParameter()},a._toggleParameter=function(){a.parameterVisible=!a.parameterVisible};a.$watch("parameter.record.paramType",function(c,d){return"body"===c?void(a.types=b.getModels()):void(a.types=e)});a.$on("$destroy",function(a){})}}}]).directive("dfSwaggerModelEditor",["MOD_SWAGGER_EDITOR_ASSET_PATH","SwaggerModels","dfNotify",function(a,b,c){return{restrict:"E",scope:{},templateUrl:a+"views/df-swagger-model-editor.html",link:function(a,d,e){a.isEditorClean=!0,a.isEditable=!0,a.currentEditor=null,a.models=b.getModels(),a.currentModel=null,a.newModel=function(){a._newModel()},a.loadModel=function(b){a._loadModel(b)},a.saveModel=function(){a._saveModel()},a.deleteModel=function(b){c.confirm("Delete model: "+b.record.id+" ?")&&a._deleteModel(b)},a._newModel=function(){a.isEditorClean?(b.createModel(),a._loadModel(a.models[a.models.length-1])):c.confirm("You have unsaved changes that will be lost.  Continue?")&&(b.createModel(),a._loadModel(a.models[a.models.length-1]))},a._saveModel=function(){a.currentModel.record=angular.fromJson(a.currentEditor.session.getValue());var b={module:"Dreamfactory Services Module",type:"success",provider:"dreamfactory",message:a.currentModel.id+" saved."};c.success(b)},a._loadModel=function(b){a.isEditorClean?a.currentModel=b:c.confirm("You have unsaved changes that will be lost.  Continue?")&&(a.currentModel=b)},a._deleteModel=function(b){for(var c=0;c<a.models.length;)a.models[c].__dfUI.uniqueId===b.__dfUI.uniqueId&&a.models.splice(c,1),c++}}}}]).directive("dfSwaggerFileEditor",["MOD_SWAGGER_EDITOR_ASSET_PATH","dfNotify",function(a,b){return{restrict:"E",scope:{swaggerFile:"=?"},templateUrl:a+"views/df-swagger-file-editor.html",link:function(a,c,d){a.isEditorClean=!0,a.isEditable=!0,a.currentEditor=null,a.currentFile=null,a.saveSwaggerFile=function(){a._saveSwaggerFile()},a._saveSwaggerFile=function(){a.isEditorClean?b.error("Nothing to save"):a.swaggerFile=angular.fromJson(a.currentEditor.session.getValue())},a.$watch("swaggerFile",function(b,c){b&&(a.currentFile=b)},!0)}}}]).factory("SwaggerModels",[function(){var a=0,b=function(b){var c={id:"NEW MODEL",properties:{}};return b=b||c,{__dfUI:{uniqueId:a++},record:angular.copy(b),recordCopy:angular.copy(b)}},c=[];return{getModels:function(){return c},setModels:function(a){angular.forEach(a,function(a){c.push(new b(a))})},getModel:function(a){for(var b=0;b<c.length;){if(c[b]===a)return c[b];b++}return!1},createModel:function(a){c.push(new b(a))},removeModel:function(a){for(var b=0;b<c.length;){if(c[b]===a)return void c.splice(b,1);b++}return!1}}}]).factory("SwaggerFactory",[function(){return function(a,b){var c=function(a){var b={path:"NEW API",descriptions:null,operations:[]};return a=a||b,{__dfUI:{id:null},record:angular.copy(a),recordCopy:angular.copy(a)}},d=function(a){var b={method:"GET",summary:null,nickname:"NEW OPERATION",produces:[],consumes:[],notes:null,type:null,event_name:[],responseMessages:[]};return a=a||b,{__dfUI:{id:null},record:angular.copy(a),recordCopy:angular.copy(a)}},e=function(a){var b={code:null,message:null};return a=a||b,{__dfUI:{},record:angular.copy(a),recordCopy:angular.copy(a)}},f=function(a){var b={name:"NEW PARAM",description:null,allowMultiple:!1,type:"string",format:null,paramType:"query",required:!1,"default":null};return a=a||b,{record:angular.copy(a),recordCopy:angular.copy(a)}};switch(a){case"api":return new c(b);case"operation":return new d(b);case"response-message":return new e(b);case"parameter":return new f(b)}}}]),angular.module("dfApiDocs",["ngRoute","dfUtility"]).constant("MOD_APIDOCS_ROUTER_PATH","/apidocs").constant("MOD_APIDOCS_ASSET_PATH","admin_components/adf-apidocs/").config(["$routeProvider","MOD_APIDOCS_ROUTER_PATH","MOD_APIDOCS_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"ApiDocsCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("ApiDocsCtrl",["$scope","INSTANCE_URL","dfApplicationData",function(a,b,c){a.$parent.title="API Docs",a.links=[{name:"apidocs",label:"View",path:"apidocs"}]}]).directive("swagger",["MOD_APIDOCS_ASSET_PATH","$window","$location",function(a,b,c){return{restrict:"E",scope:{},templateUrl:a+"views/swagger.html",link:function(a,b,d){a.server=c.protocol()+"://"+c.host(),c.port()?a.server+=":"+c.port()+"/df-swagger-ui/dist/index.html":a.server+="/df-swagger-ui/dist/index.html",a.$broadcast("apidocs:loaded")}}}]),angular.module("dfFileManager",["ngRoute","dfUtility"]).constant("MOD_FILE_MANAGER_ROUTER_PATH","/file-manager").constant("MOD_FILE_MANAGER_ASSET_PATH","admin_components/adf-file-manager/").config(["$routeProvider","MOD_FILE_MANAGER_ROUTER_PATH","MOD_FILE_MANAGER_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"FileCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("FileCtrl",["$scope","INSTANCE_URL","dfApplicationData",function(a,b,c){a.$parent.title="Files",a.links=[{name:"manage-files",label:"Manage",path:"manage-files"}]}]).directive("dfFileManager",["MOD_FILE_MANAGER_ASSET_PATH","INSTANCE_URL",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-file-manager.html",link:function(a,c,d){$("#root-file-manager iframe").attr("src",b+"/filemanager/?path=/&allowroot=true").show(),a.$broadcast("filemanager:loaded")}}}]),angular.module("dfPackageManager",["ngRoute","dfUtility"]).constant("MOD_PACKAGE_MANAGER_ROUTER_PATH","/package-manager").constant("MOD_PACKAGE_MANAGER_ASSET_PATH","admin_components/adf-package-manager/").config(["$routeProvider","MOD_PACKAGE_MANAGER_ROUTER_PATH","MOD_PACKAGE_MANAGER_ASSET_PATH",function(a,b,c){a.when(b,{templateUrl:c+"views/main.html",controller:"PackageCtrl",resolve:{checkAppObj:["dfApplicationData",function(a){return a.initInProgress?a.initDeferred.promise:void 0}],checkCurrentUser:["UserDataService","$location","$q",function(a,b,c){var d=a.getCurrentUser(),e=c.defer();if(!d)throw b.url("/login"),{routing:!0};if(d&&!d.is_sys_admin)throw b.url("/launchpad"),{routing:!0};return e.resolve(),e.promise}]}})}]).run(["INSTANCE_URL","$templateCache",function(a,b){}]).controller("PackageCtrl",["$scope","INSTANCE_URL","dfApplicationData",function(a,b,c){a.$parent.title="Packages",a.links=[{name:"manage-packages",label:"Manage",path:"manage-packages"}],a.dfLargeHelp={packageManager:{title:"Packages Overview",text:"To create a DreamFactory package file for your app, follow these instructions. <br/><ul><li>Select the app from the list.</li><li>Choose the database schema you'd like to export.</li><li>Choose which services you'd like to export.</li><li>Press Export to be prompted to save your new .dfpkg file.</li></ul>"}}}]).directive("dfSelectApp",["MOD_PACKAGE_MANAGER_ASSET_PATH","INSTANCE_URL","$http","dfApplicationData","dfNotify",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:a+"views/df-select-app.html",link:function(a,f,g){a.apps=angular.copy(d.getApiData("app")),a.selectedApp="",a.includeAppFiles=!1,a.selectAll=!1;var h=a.$watch("selectedApp",function(d,f){d&&(!f&&d||f.hasOwnProperty("id")&&f.id!==d.id)&&c({method:"GET",url:b+"/api/v2/system/app/"+d.id,params:{fields:"*"}}).then(function(b){for(var c=0;c<a.apps.length;){if(a.apps[c].id===b.data.id)return a.apps[c]=b.data,void(a.selectedApp=a.apps[c]);c++}},function(a){var b={module:"Api Error",type:"error",provider:"dreamfactory",message:a};e.error(b)})});a.$watch("selectAll",function(b,c){a.services&&a.services.forEach(function(a){a.__dfUI.selected=b})}),a.$on("$destroy",function(a){h()})}}}]).directive("dfSelectSchema",["MOD_PACKAGE_MANAGER_ASSET_PATH","dfApplicationData",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-select-schema.html",link:function(a,c,d){var e=function(a){return{__dfUI:{selected:!1},record:a}};a.databases=null,a.prepareSchemaData=function(){var b={};return angular.forEach(a.databases,function(a){b[a.name]=[],angular.forEach(a.tables,function(c){c.__dfUI.selected&&b[a.name].push(c.record)}),0===b[a.name].length&&delete b[a.name]}),JSON.stringify(b)};var f=a.$watch("databases",function(c,d){if(null==c){var f=b.getApiData("service",{type:"sql_db"});a.databases=[],angular.forEach(f,function(c){b.getServiceComponents(c.name).then(function(b){var d=[],f="_schema/";angular.forEach(b,function(a){if(0===a.indexOf(f)){var b=a.slice(f.length);""!=b&&-1===b.indexOf("*",b.length-1)&&Array.isArray(c.components)&&(b=b.slice(0,-1),d.push(new e(b)))}}),a.databases.push({name:c.name,tables:d,service_id:c.id})})})}}),g=a.$watch("selectedApp",function(b,c){b||angular.forEach(a.databases,function(a){angular.forEach(a.tables,function(a){a.__dfUI.selected=!1})})});a.$on("$destroy",function(){f(),g()})}}}]).directive("dfSelectServices",["MOD_PACKAGE_MANAGER_ASSET_PATH","dfApplicationData",function(a,b){return{restrict:"E",scope:!1,templateUrl:a+"views/df-select-services.html",link:function(a,c,d){var e=function(a){return{__dfUI:{selected:!1},record:a}};a.services=null,a.prepareServicesData=function(){var b=[];return angular.forEach(a.services,function(a){a.__dfUI.selected&&b.push(a.record.name)}),b.join(",")};var f=a.$watch("services",function(c,d){if(null==c){var f=[];angular.forEach(b.getApiData("service"),function(a){switch(a.name){case"All":case"Database":case"Schema":case"Local Portal Service":case"Local File Storage":break;default:f.push(new e(a))}}),a.services=f}}),g=a.$watch("selectedApp",function(b,c){b||angular.forEach(a.services,function(a){a.__dfUI.selected=!1})});a.$on("$destroy",function(){f(),g()})}}}]).directive("dfExportPackage",["INSTANCE_URL","ADMIN_API_KEY","UserDataService","$window",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!0,link:function(e,f,g){e.exportPackage=function(){e._exportPackage()},e._exportPackage=function(){var f=a+"/api/v2/system/app/"+e.selectedApp.id+"?pkg=true&api_key="+b+"&session_token="+c.getCurrentUser().session_token+"&include_files="+e.includeAppFiles+"&service="+e.prepareServicesData()+"&schema="+e.prepareSchemaData();d.location.href=f}}}}]),angular.module("dfTable",["dfUtility"]).constant("DF_TABLE_ASSET_PATH","admin_components/adf-table/").run(["$templateCache",function(a){a.put("df-input-text.html",'<input type="{{templateData.type}}"  class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),a.put("df-input-ref-text.html",'<input type="{{templateData.type}}"  class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),a.put("df-input-number.html",'<input type="{{templateData.type}}" step="any" class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),a.put("df-input-int.html",'<input type="{{templateData.type}}" step="1" class="form-control" placeholder="{{templateData.placeholder}}" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required">'),a.put("df-input-textarea.html",'<textarea class="form-control" rows="3" data-ng-model="currentEditRecord[field.name]" data-ng-disabled="!templateData.editable" data-ng-required="field.required"></textarea>'),a.put("df-input-binary.html","<p>BINARY DATA</p>"),a.put("df-input-datetime.html","<p>DATETIME</p>"),a.put("df-input-reference.html",'<div class="well"><df-table data-options="relatedOptions" data-parent-record="currentEditRecord" data-export-field="field"></df-table></div>'),a.put("df-input-checkbox.html",'<label><input type="checkbox" data-ng-model="currentEditRecord[field.name]" data-ng-checked="currentEditRecord[field.name]" data-ng-required="field.required"></label>'),a.put("df-input-bool-picklist.html",'<div class="form-group"><select class="form-control" data-ng-model="currentEditRecord[field.name]" data-ng-options="bool.value as bool.name for bool in __dfBools" data-ng-required="field.required"></select></div>'),a.put("df-input-select.html",'<select class="form-control" data-ng-model="currentEditRecord[field.name]" data-ng-options="obj[overrideFields[templateData.prop].display.value] as obj[overrideFields[templateData.prop].display.label] for obj in overrideFields[templateData.prop].records" data-ng-required="field.required" data-ng-disabled="currentEditRecord[templateData.dependent]"><option value="">-- None --</option></select>'),a.put("df-input-values-picklist.html",'<div class="row"><div class="col-xs-12 col-md-6"><div class="input-group"><input type="text" class="form-control" data-ng-model="currentEditRecord[field.name]" placeholder="Enter Value or Choose from list" data-ng-required="field.required"><div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu pull-right df-dropdown-height"><li data-ng-click="assignValue(item)" data-ng-repeat="item in data"><a>{{item}}</a></li></ul></div><!-- /btn-group --></div><!-- /input-group --></div><!-- /.col-lg-6 --></div>'),a.put("df-input-values-only-picklist.html",'<div class="form-group"><select class="form-control" data-ng-model="currentEditRecord[field.name]" data-ng-options="item for item in data" data-ng-required="field.required"></select></div>'),a.put("df-input-date-time-picker.html",'<div class="form-group col-xs-12">\n <div class="input-group col-sm-6 col-md-4">\n<span class="input-group-btn">\n<button type="button" data-ng-disabled="!templateData.editable" class="btn btn-default btn-small" data-ng-click="open($event)"><i class="fa fa-calendar fa-fw"></i></button><button type="button" class="btn btn-default" data-ng-disabled="!templateData.editable" data-ng-click="setNow()">Now</button>\n</span>\n<input type="text" class="form-control" data-ng-disabled="!templateData.editable" data-datepicker-popup="{{format}}" data-ng-model="dt" data-is-open="opened"  data-date-disabled="disabled(date, mode)" data-ng-required="field.required" data-close-text="Close" /></div>\n<div class="col-sm-6 col-md-2">\n<timepicker style="display: inline-block" data-ng-model="mytime" data-ng-change="changed()" show-meridian="ismeridian"></timepicker>\n</div>\n</div>')}]).directive("dfTable",["DF_TABLE_ASSET_PATH","$http","$q","$filter","$compile","dfObjectService","dfTableEventService","dfTableCallbacksService",function(a,b,c,d,e,f,g,h){return{restrict:"E",scope:{userOptions:"=options",parentRecord:"=?",exportField:"=?"},templateUrl:a+"views/dreamfactory-table.html",link:function(a,d,i){a.es=g,a.defaults={service:"",table:"",url:"",normalizeData:!1,normalizeSchema:!0,autoClose:!0,params:{filter:null,limit:50,offset:0,fields:"*",include_schema:!0,include_count:!0},defaultFields:null,overrideFields:[],extendFieldTypes:[],extendData:[],extendSchema:[],relatedData:[],excludeFields:[],groupFields:[],exportValueOn:!1,allowChildTable:!1,childTableAttachPoint:null,isChildTable:!1},a.options={},a.disableTableBtns=!1,a.record=null,a.schema=null,a.overrideFields={},a.tableFields={onStartTotalActiveFields:0},a.tableFieldsAll=!1,a.tableFilterOn=!0,a.defaultFieldsShown={},a.numAutoSelectFields=8,a.selectedAll=!1,a.filterOn=!1,a.filter={viewBy:"",prop:"",value:null},a.order={orderBy:"",orderByReverse:!1},a.filteredRecords=!1,a.orderedRecords=!1,a.activeTab=null,a.activeView="table",a.pagesArr=[],a.currentPage={},a.currentEditRecord=null,a.extendFieldTypes={},a.inProgress=!1,a.count=0,a._exportValue=null,a.newRecord=null,a.relatedExpand=!1,a.extendedData={},a.extendedSchema={},a.excludedFields={},a.filteredSchema=[],a.groupedSchema=[],a.childTableActive=!1,a.childTableOptions={},a.childTableParentRecord=null,a.setTab=function(b){a._setTab(b)},a.toggleSelected=function(b){return a.childTableActive?!1:void a._toggleSelected(b)},a.getPrevious=function(){return a._isFirstPage()||a._isInProgress()?!1:void(a._checkForUnsavedRecords(a.record)?a._confirmAction("You have Unsaved records.  Continue without saving?",a._getPrevious):a._getPrevious())},a.getNext=function(){return a._isLastPage()||a._isInProgress()?!1:void(a._checkForUnsavedRecords(a.record)?a._confirmAction("You have Unsaved records.  Continue without saving?",a._getNext):a._getNext())},a.editRecord=function(b){a._editRecord(b)},a.createRecord=function(){a._createRecord()},a.saveRecords=function(){a._saveRecords()},a.revertRecords=function(){a._revertRecords()},a.deleteRecords=function(){a._confirmAction("You are about to mass delete records.  Continue?",a._deleteRecords)},a.applyFilter=function(){a._applyFilter()},a.removeFilter=function(){a._removeFilter()},a.refreshResults=function(){a._refreshResults()},a.orderOnSelect=function(b){a._orderOnSelect(b)},a.setExportValue=function(b){a._setExportValue(b)},a.toggleExpandEditor=function(){a._toggleExpandEditor()},a.editExportRecord=function(b){a._editExportRecord(b)},a.filterRecords=function(){a._filterRecords()},a.toggleAllFields=function(){a._toggleAllFields()},a.resetAllFields=function(){a._resetAllFields()},a.toggleAllRecords=function(){a._toggleAllRecords()},a.showChildTable=function(b){a._showChildTable(b)},a._addSelectedProp=function(a){a.__dfUI.hasOwnProperty("selected")||(a.__dfUI.selected=!1)},a._addUnsavedProp=function(a){a.__dfUI.hasOwnProperty("unsaved")||(a.__dfUI.unsaved=!1)},a._addExportProp=function(a){a.__dfUI.hasOwnProperty("export")||(a.__dfUI["export"]=!1)},a._addHideProp=function(a){a.__dfUI.hasOwnProperty("hide")||(a.__dfUI.hide=!1)},a._addStateProps=function(b){b.hasOwnProperty.__dfUI||(b.__dfUI={}),a._addSelectedProp(b),a._addUnsavedProp(b),a._addExportProp(b),a._addHideProp(b)},a._removeStateProps=function(a){a.hasOwnProperty.__dfUI&&delete a.__dfUI},a._toggleSelectedState=function(a){a.__dfUI.selected=!a.__dfUI.selected},a._toggleUnsavedState=function(a){a.__dfUI.unsaved=!a.__dfUI.unsaved},a._setSelectedState=function(a,b){a.__dfUI.selected=b},a._setUnsavedState=function(a,b){a.__dfUI.unsaved=b},a._setExportState=function(a,b){a&&(a.__dfUI["export"]=b)},a._setHideState=function(a,b){a&&(a.__dfUI.hide=b)},a._isUnsaved=function(a){return a.__dfUI.unsaved},a._isSelected=function(a){return a.__dfUI.selected},a._isExport=function(a){return a.__dfUI["export"]},a._checkForUnsavedRecords=function(a){if(!a)return!1;var b=!1,c=0;do{if(c>=a.length)break;a[c].__dfUI.unsaved&&(b=!0),c++}while(0==b);return b},a._checkForParams=function(){var b={};return b=a.options.hasOwnProperty("params")?a.options.params:a.defaults.params},a._getRecordsFromServer=function(c){var d=a._checkForParams();return c=c||null,c&&(d=f.mergeObjects(c.params,d)),a.options.relatedData.length>0&&(d.related=a.options.relatedData.join(",")),b({method:"GET",url:a.options.url,params:d})},a._getRecordsFromData=function(b){var c=a._checkForParams().limit,d=[];return b.hasOwnProperty("resource")?d=b.resource:b.hasOwnProperty("data")&&(d=b.data.hasOwnProperty("resource")?b.data.resource:b.data.data.resource),d.length>c?d.slice(0,c):d},a._getMetaFromData=function(a){var b={};return a.hasOwnProperty("meta")?b=a.meta:a.hasOwnProperty("data")&&(b=a.data.hasOwnProperty("meta")?a.data.meta:a.data.data.meta),b},a._getSchemaFromData=function(b){return a._getMetaFromData(b).schema},a._getCountFromMeta=function(b){var c=a._getMetaFromData(b).count;return a._setCount(c),c},a._setCount=function(b){a.count=b},a._getOptionFromParams=function(b){return a._checkForParams()[b]},a._setOptionFromParams=function(a,b){},a._buildField=function(a){console.log(a)},a._createRevertCopy=function(a){a.__dfData={},a.__dfData.revert=angular.copy(a),a.__dfData.revert.hasOwnProperty("_exportValue")||(a.__dfData.revert._exportValue={})},a._getRevertCopy=function(a){return a.__dfData.revert},a._hasRevertCopy=function(a){return a.hasOwnProperty("__dfData")&&a.__dfData.hasOwnProperty("revert")?!0:!1},a._removeRevertCopy=function(a){a.__dfData.revert&&delete a.__dfData.revert},a._removeAllDFData=function(a){a.__dfData&&delete a.__dfData},a._removeAllUIData=function(a){delete a.__dfUI},a._compareObjects=function(a,b){for(var c in a)if("dfUISelected"!==c&&"dfUIUnsaved"!==c&&"__dfUI"!==c&&"__dfData"!=c&&"created_date"!=c&&"last_modified_date"!=c&&"$$hashKey"!==c&&a[c]!==b[c])return null!=a[c]&&""!=a[c]||null!=b[c]&&""!=b[c]?a[c]instanceof Array&&b[c]instanceof Array&&a[c].length==b[c].length?!1:!0:!1;return!1},a._getRecordsWithState=function(b,c,d,e){var f=[];return d="undefined"!=typeof d?d:!1,e="undefined"!=typeof e?e:!1,angular.forEach(b,function(b){b.__dfUI[c]&&(d&&a._removeAllDFData(b),e&&a._removeAllUIData(b),f.push(b))}),f},a._saveRecordsToServer=function(d){if(0==d.length){var e=c.defer(),f="No records selected for save.";return e.reject(f),e.promise}return b({method:"PATCH",url:a.options.url,data:{resource:d}})},a._deleteRecordsFromServer=function(d){if(0==d.length){var e=c.defer(),f="No records selected for delete.";return e.reject(f),e.promise}return b({method:"DELETE",url:a.options.url,data:{resource:d}})},a._isInProgress=function(){return a.inProgress},a._setInProgress=function(b){a.inProgress=b},a._createNewRecordObj=function(){var b={};return angular.forEach(a.schema.field,function(c){a.excludedFields.hasOwnProperty(c.name)&&a.excludedFields[c.name].fields.create||(b[c.name]=c["default"])}),a._addStateProps(b),b},a._setCurrentEditRecord=function(b){a.currentEditRecord=b},a._setNewRecordObj=function(){a.newRecord=a._createNewRecordObj()},a._confirmAction=function(a,b){confirm(a)&&b.call()},a._filterFormSchema=function(b){return 0==a.excludedFields.length?!1:void angular.forEach(a.schema.field,function(c){a.excludedFields.hasOwnProperty(c.name)&&a.excludedFields[c.name].fields[b]||a.filteredSchema.push(c)})},a._buildSchemaGroups=function(){if(0==a.options.groupFields.length)return!1;var b=a.filteredSchema.length>0?a.filteredSchema:a.schema.field;angular.forEach(a.options.groupFields,function(c){var d={};d.name=c.name,d.fields=[],d.dividers=c.dividers,angular.forEach(b,function(a){angular.forEach(c.fields,function(b,c){a.name===b&&(d.fields[c]=a)})}),a.groupedSchema.push(d)})},a._checkForGroupedSchema=function(b){0==a.groupedSchema.length&&a.groupedSchema.push({name:b,fields:a.schema.field})},a._clearFilteredSchema=function(){a.filteredSchema=[]},a._clearGroupedSchema=function(){a.groupedSchema=[]},a._getDefaultFields=function(a){return a.hasOwnProperty("defaultFields")?a.defaultFields:null},a._removePrivateFields=function(b){b&&angular.forEach(a.record,function(a){for(var c in a)b[c]&&"private"==b[c]&&delete a[c]})},a._setElementActive=function(b){a.activeTab=b},a._setDisableTableBtnsState=function(b){a.disableTableBtns=b},a._createFieldsObj=function(b){if(a.tableFields={onStartTotalActiveFields:0},!a.defaultFieldsShown){var c=Object.keys(b);return c.length<a.numAutoSelectFields&&(a.numAutoSelectFields=c.length),angular.forEach(b,function(b,d){if(a.tableFields.onStartTotalActiveFields<a.numAutoSelectFields&&d!=c.length)switch(b.name){case"name":case"title":case"fname":case"lname":case"f_name":case"l_name":case"firstname":case"lastname":case"first_name":case"last_name":case"email":case"phone":a.tableFields[b.name]=b,a.tableFields[b.name].active=!0,a.tableFields.onStartTotalActiveFields++;break;default:a.tableFields[b.name]=b,a.tableFields[b.name].active=!1}}),a.tableFields.onStartTotalActiveFields<a.numAutoSelectFields&&angular.forEach(a.tableFields,function(b){if(a.tableFields.onStartTotalActiveFields==a.numAutoSelectFields)return!1;if(0==b.active)switch(b.type){case"date":case"time":case"datetime":b.active=!0,a.tableFields.onStartTotalActiveFields++}}),a.tableFields.onStartTotalActiveFields<a.numAutoSelectFields&&angular.forEach(a.tableFields,function(b){return a.tableFields.onStartTotalActiveFields==a.numAutoSelectFields?!1:void(0==b.active&&(b.active=!0,a.tableFields.onStartTotalActiveFields++))}),!1}angular.forEach(b,function(b,c){if(a.defaultFieldsShown.hasOwnProperty(b.name))switch(a.defaultFieldsShown[b.name]){case!0:a.tableFields[b.name]=b,a.tableFields[b.name].active=!0;break;case!1:a.tableFields[b.name]=b,a.tableFields[b.name].active=!1;break;case"private":break;default:a.tableFields[b.name]=b,a.tableFields[b.name].active=!1}else a.tableFields[b.name]=b,a.tableFields[b.name].active=!1}),a.tableFieldsAll=!1},a._init=function(b){a._prepareExtendedData(a.options),a._prepareExtendedSchema(a.options),a._prepareExcludedFields(a.options),a._prepareRecords(b)&&a._prepareOverrideFields(a.options),a._prepareSchema(b),a._prepareExtendedFieldTypes(a.options),a.defaultFieldsShown=a._getDefaultFields(a.options),a._createFieldsObj(a.schema.field),a.activeTab=a.schema.name+"-table",a._calcPagination(b),a.pagesArr[0].stopPropagation=!0,a._setCurrentPage(a.pagesArr[0])},a._prepareRecords=function(b){return a.record=a._getRecordsFromData(b),a.record?(a._removePrivateFields(a._getDefaultFields(a.options)),angular.forEach(a.record,function(b){a._addStateProps(b),a._addExtendedData(b),a.options.exportValueOn&&a._exportValue&&a._checkExportValue(b)&&(a._setExportState(b,!0),a._exportValue=b)}),a.options.normalizeData&&(a.record=a._normalizeData(a.record)),!0):(a.record=null,!1)},a._checkExportValue=function(b){return b[a.exportField.ref_fields]===a._exportValue[a.exportField.ref_fields]},a._prepareSchema=function(b){a.schema=a._getSchemaFromData(b),a.options.normalizeSchema&&a.record.length>0&&(a.schema=a._normalizeSchema(a.schema,a.record)),
angular.forEach(a.extendedSchema,function(b){a.schema.field.push(b)})},a._prepareExtendedSchema=function(b){return null==b.extendSchema?!1:void angular.forEach(b.extendSchema,function(b){a.extendedSchema[b.name]={},a.extendedSchema[b.name].name=b.name,a.extendedSchema[b.name].type=b.type,a.extendedSchema[b.name].label=b.label})},a._prepareOverrideFields=function(b){return null==b.overrideFields?!1:void angular.forEach(b.overrideFields,function(b){a.overrideFields[b.field]={},b.hasOwnProperty("record")&&(a.overrideFields[b.field].records=a._getRecordsFromData(b.record)),a.overrideFields[b.field].display=b.display})},a._prepareExtendedFieldTypes=function(b){return null==b.extendFieldTypes?!1:void angular.forEach(b.extendFieldTypes,function(b){a.extendFieldTypes[b.db_type]={};for(var c in b)a.extendFieldTypes[b.db_type][c]=b[c]})},a._prepareExtendedData=function(b){return null==b.extendData?!1:void angular.forEach(b.extendData,function(b){a.extendedData[b.name]={},a.extendedData[b.name].name=b.name,a.extendedData[b.name].value=b.value||null})},a._addExtendedData=function(b){angular.forEach(a.extendedData,function(a){b[a.name]=a.value})},a._setActiveView=function(b){a.activeView=b},a._setExportValueToParent=function(b){a._exportValue=b||null},a._prepareExcludedFields=function(b){return null==b.extendSchema?!1:void angular.forEach(b.excludeFields,function(b){a.excludedFields[b.name]={},a.excludedFields[b.name].fields=b.fields})},a._calcTotalPages=function(a,b){return Math.ceil(a/b)},a._createPageObj=function(b){return{number:b+1,value:b,offset:b*a._getOptionFromParams("limit"),stopPropagation:!1}},a._createPagesArr=function(b){a.pagesArr=[];for(var c=0;b>c;c++)a.pagesArr.push(a._createPageObj(c))},a._setCurrentPage=function(b){a.currentPage=b},a._getCurrentPage=function(){return!a.currentPage&&a.pagesArr.length>0?a.currentPage=a.pagesArr[0]:a.currentPage||a.pagesArr.length||(a.pagesArr.push(a._createPageObj(0)),a.currentPage=a.pagesArr[0]),a.currentPage},a._isFirstPage=function(){return 0===a._getCurrentPage().value},a._isLastPage=function(){return a.currentPage.value===a.pagesArr.length-1},a._previousPage=function(){a.currentPage=a.pagesArr[a.currentPage.value-1]},a._nextPage=function(){a.currentPage=a.pagesArr[a.currentPage.value+1]},a._calcPagination=function(b){a.pagesArr=[];var c=a._getCountFromMeta(b);return 0==c?(a.pagesArr.push(a._createPageObj(0)),!1):void a._createPagesArr(a._calcTotalPages(c,a._getOptionFromParams("limit")))},a._resetFilter=function(b){return b?void(a.filter={viewBy:b.field[0].name||"",prop:b.field[0].name||"",value:null}):!1},a._isFiltered=function(){return a.filteredRecords},a._createFilterParams=function(){return a.filter.prop+' like "%'+a.filter.value+'%"'},a._unsetFilterInOptions=function(){a.options.params.hasOwnProperty("filter")&&delete a.options.params.filter},a._setFilterInOptions=function(){return a._checkForFilterValue()?a.options.params.hasOwnProperty("filter")?(a.options.params.filter=a._createFilterParams(),!0):(a.options.params.filter=a._createFilterParams(),!0):!1},a._checkForFilterValue=function(){return!!a.filter.value},a._resetOrder=function(b){return b?void(a.order={orderBy:b.field[0].name||"",orderByReverse:!1}):!1},a._isOrdered=function(){return a.orderedRecords},a._createOrderParams=function(){var b=a.order.orderBy+" ";return b+=a.order.orderByReverse?"DESC":"ASC"},a._unsetOrderInOptions=function(){a.options.params.hasOwnProperty("order")&&delete a.options.params.order},a._setOrderInOptions=function(){a.options.params.hasOwnProperty("order")?a.options.params.order=a._createOrderParams():a.options.params.order=a._createOrderParams()},a._setChildTableActive=function(b){a.childTableActive=b},a._setChildTableParentRecord=function(b){a.childTableParentRecord=b},a._buildChildTableOptions=function(){a.childTableOptions={isChildTable:!0,allowChildTable:!1},a.childTableOptions=f.deepMergeObjects(a.childTableOptions,angular.copy(a.defaults))},a._addChildTable=function(){angular.element(a.options.childTableAttachPoint).append(e('<df-child-table data-child-options="childTableOptions" data-parent-schema="schema" data-child-table-parent-record="childTableParentRecord"></df-child-table>')(a))},a._setTab=function(b){a._setElementActive(b)},a._toggleSelected=function(b){a._toggleSelectedState(b)},a._normalizeData=function(a){return angular.forEach(a,function(a){for(var b in a)null==a[b]&&(a[b]="NULL")}),a},a._normalizeSchema=function(a,b){var c=[];for(var d in a.field)b[0].hasOwnProperty(a.field[d].name)&&c.push(a.field[d]);return delete a.field,a.field=c,a},a._getPrevious=function(){a._previousPage()},a._getNext=function(){a._nextPage()},a._editRecord=function(b){a._setCurrentEditRecord(b)},a._saveRecords=function(){a._setInProgress(!0);var b=a._getRecordsWithState(a.record,"unsaved",!0);a._saveRecordsToServer(b).then(function(b){angular.forEach(a.record,function(b){a._isUnsaved(b)&&a._toggleUnsavedState(b),a._isSelected(b)&&a._toggleSelectedState(b),a._hasRevertCopy(b)&&a._removeRevertCopy(b)}),a.$emit(a.es.alertSuccess,{message:"Records saved."})},function(a){throw{module:"xxDreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._revertRecords=function(){angular.forEach(a.record,function(b,c){a._isUnsaved(b)&&a._hasRevertCopy(a.record[c])&&(a.record[c]=a._getRevertCopy(b))}),a.$emit(a.es.alertSuccess,{message:"Records reverted."})},a._deleteRecords=function(){var b=a._getRecordsWithState(a.record,"selected");a._deleteRecordsFromServer(b).then(function(b){var c={},d=a._getCurrentPage().value,e=a._getCurrentPage().offset;a._isLastPage()&&a.record.length===a._getRecordsFromData(b).length&&(e-=a._getOptionFromParams("limit")),c.params=f.mergeObjects({offset:e},a.options.params),a._getRecordsFromServer(c).then(function(b){a.$emit(a.es.alertSuccess,{message:"Records deleted."}),a._prepareRecords(b),a._createPagesArr(a._calcTotalPages(a._getCountFromMeta(b),a._getOptionFromParams("limit"))),d>a.pagesArr.length-1&&0!==d&&(d-=1,a.pagesArr[d].stopPropagation=!0),a._setCurrentPage(a.pagesArr[d])},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._getRecordsWithFilter=function(){var b={};b.params=f.mergeObjects({filter:a._createFilterParams()},a.options.params),a._setInProgress(!0),a._getRecordsFromServer(b).then(function(b){a._init(f.mergeObjects({data:b},a.options))},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._refreshResults=function(b){if(b=b||!0,b&&a._checkForUnsavedRecords(a.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return!1;var c={};c.params={offset:0},a._setInProgress(!0),a._getRecordsFromServer(c).then(function(b){a._prepareRecords(b),a._calcPagination(b),a._setCurrentPage(a.pagesArr[0])},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._applyFilter=function(){if(a._checkForUnsavedRecords(a.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return!1;a._setFilterInOptions()&&(a.filteredRecords=!0),a._setOrderInOptions(),a.orderedRecords=!0;var b={};b.params={offset:0},a._setInProgress(!0),a._getRecordsFromServer(b).then(function(b){a._prepareRecords(b),a._calcPagination(b),a._setCurrentPage(a.pagesArr[0])},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._removeFilter=function(){if(a._checkForUnsavedRecords(a.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return!1;a._unsetFilterInOptions(),a._unsetOrderInOptions(),a._resetFilter(a.schema),a._resetOrder(a.schema),a.filteredRecords=!1,a.orderedRecords=!1;var b={};b.params={offset:0},a._setInProgress(!0),a._getRecordsFromServer(b).then(function(b){a._prepareRecords(b),a._calcPagination(b),a._setCurrentPage(a.pagesArr[0])},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._orderOnSelect=function(b){var c=a.order.orderBy;c===b.name?a.order.orderByReverse=!a.order.orderByReverse:(a.order.orderBy=b.name,a.order.orderByReverse=!1)},a._createRecord=function(){a._setNewRecordObj()},a._setExportValue=function(b){a._setExportValueToParent(b)},a._toggleExpandEditor=function(){a.relatedExpand=!a.relatedExpand},a._editExportRecord=function(b){a.options.exportValueOn&&a.parentRecord&&(a.relatedExpand?a.relatedExpand&&!a.currentEditRecord&&a._setCurrentEditRecord(b):(a._setCurrentEditRecord(b),a._toggleExpandEditor()))},a._filterRecords=function(){a.filterOn=!a.filterOn},a._toggleAllFields=function(){a.tableFieldsAll=!a.tableFieldsAll,angular.forEach(a.tableFields,function(b){"[object Object]"===Object.prototype.toString.call(b)&&b.hasOwnProperty("active")&&(b.active=a.tableFieldsAll)})},a._resetAllFields=function(){a._createFieldsObj(a.schema.field)},a._toggleAllRecords=function(){a.selectedAll=!a.selectedAll,angular.forEach(a.record,function(b){a._setSelectedState(b,a.selectedAll)})},a._showChildTable=function(b){return a.childTableActive?!1:(a._setChildTableActive(!0),a._setChildTableParentRecord(b),a._buildChildTableOptions(),a._addChildTable(),void a._setDisableTableBtnsState(!0))};var j=a.$watchCollection("userOptions",function(b,c){return b?(a.options=f.deepMergeObjects(b,a.defaults),a._setActiveView("table"),void h.reset()):!1}),k=a.$watchCollection("options",function(b,c){if(!b)return!1;if(!b.service)return!1;if(a.options.exportValueOn&&!a._exportValue&&a.parentRecord[a.exportField.name]){var d={};d.params={filter:a.exportField.ref_fields+" = "+a.parentRecord[a.exportField.name]},a._getRecordsFromServer(d).then(function(c){var d=a._getRecordsFromData(c)[0];a._addStateProps(d),a._exportValue=d,a.options.params.filter&&delete a.options.params.filter,b.data?(a._init(b),a._resetFilter(a.schema),a._resetOrder(a.schema)):a._getRecordsFromServer().then(function(b){a._init(b),a._resetFilter(a.schema),a._resetOrder(a.schema)},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})}else b.data?(a._init(b),a._resetFilter(a.schema),a._resetOrder(a.schema)):(a.options.params.offset=b.table!==c.table?0:a.options.params.offset,a._getRecordsFromServer().then(function(b){a._init(b),a._resetFilter(a.schema),a._resetOrder(a.schema)},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}}))}),l=a.$watch("currentPage",function(b,c){if(b.value==c.value)return!1;if(b.stopPropagation)return b.stopPropagation=!1,!1;if(a._checkForUnsavedRecords(a.record)&&!confirm("You have Unsaved records.  Continue without saving?"))return c.stopPropagation=!0,a._setCurrentPage(c),!1;var d={};d.params={offset:b.offset},a._setInProgress(!0),a._getRecordsFromServer(d).then(function(b){a._prepareRecords(b)},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})}),m=a.$watch("currentEditRecord",function(b,c){b?(a._hasRevertCopy(b)||a._createRevertCopy(b),a._filterFormSchema("edit"),a._buildSchemaGroups(),a._checkForGroupedSchema("Edit "+a.schema.name.charAt(0).toUpperCase()+a.schema.name.slice(1)),a._setActiveView("edit")):(a._setActiveView("table"),a._clearGroupedSchema(),a._clearFilteredSchema())}),n=a.$watchCollection("currentEditRecord",function(b,c){c&&null==b&&a._hasRevertCopy(c)&&(a._compareObjects(c,c.__dfData.revert)?a._setUnsavedState(c,!0):a._setUnsavedState(c,!1))}),o=a.$watchCollection("parentRecord",function(b,c){if(!b)return!1;if(!b&&!a._exportValue)return!1;if(null==(!a._exportValue&&b[a.exportField.name]))return!1;if(!b[a.exportField.name])return a._exportValue=null,!1;if(!a._exportValue&&b[a.exportField.name]||a._exportValue[a.exportField.ref_fields]!==b[a.exportField.name]){var d={};return d.params={filter:a.exportField.ref_fields+" = "+b[a.exportField.name],offset:0},a._getRecordsFromServer(d).then(function(b){var c=a._getRecordsFromData(b);if(!c)throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:"Revert related data record not found."};a._addStateProps(c[0]),a._exportValue=c[0],a.options.params.filter&&delete a.options.params.filter},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}}),!1}}),p=a.$watch("_exportValue",function(b,c){if(!b&&!c)return!1;if(!b&&c){a._setExportState(c,!1);var d=!1,e=0;if(a.record)for(;!d&&e<a.record.length;){var f=a.record[e];null===f[a.exportField.name]&&(a._setExportState(a.record[e],!1),d=!0),e++}return a.parentRecord[a.exportField.name]=b,!1}if(!c&&b){var d=!1,e=0;if(a.record)for(;!d&&e<a.record.length;){var f=a.record[e];f[a.exportField.name]===a._exportValue[a.exportField.name]&&(a._setExportState(a.record[e],!0),d=!0),e++}}if(c&&b){a._setExportState(c,!1);var d=!1,e=0;if(a.record)for(;!d&&e<a.record.length;){var f=a.record[e];f[a.exportField.ref_fields]===b[a.exportField.ref_fields]&&(a._setExportState(a.record[e],!0),d=!0),e++}if(d=!1,e=0,a.record)for(;!d&&e<a.record.length;){var f=a.record[e];f[a.exportField.ref_fields]===c[a.exportField.ref_fields]&&(a._setExportState(a.record[e],!1),d=!0),e++}}if(a.parentRecord[a.exportField.name]===b[a.exportField.ref_fields])return b&&a._setExportState(b,!0),c&&a._setExportState(c,!1),!1;for(var d=!1,e=0;!d&&e<a.record.length;){var f=a.record[e];f[a.exportField.name]===a._exportValue[a.exportField.name]&&(a._setExportState(a.record[e],!1),d=!0),e++}a.parentRecord[a.exportField.name]=b[a.exportField.ref_fields],a._setExportState(c,!1),a._setExportState(b,!0)}),q=a.$watch("newRecord",function(b,c){b?(a._setActiveView("new"),a._filterFormSchema("create"),a._buildSchemaGroups(),a._checkForGroupedSchema("Create "+a.schema.name.charAt(0).toUpperCase()+a.schema.name.slice(1))):(a._setActiveView("table"),a._clearGroupedSchema())}),r=a.$watch("childTableParentRecord",function(b,c){return b?void angular.forEach(a.record,function(c){c.$$hashKey!=b.$$hashKey&&a._setHideState(c,!0)}):!1});a.$on(a.es.refreshTable,function(b){a._refreshResults(!1)}),a.$on(a.es.closeChildTable,function(b){a._setChildTableParentRecord(null),angular.forEach(a.record,function(b){a._setHideState(b,!1)}),a._setDisableTableBtnsState(!1),a._setChildTableActive(!1)}),a.$on("$destroy",function(a){j(),k(),l(),m(),n(),o(),p(),q(),r()})}}}]).directive("editRecord",["DF_TABLE_ASSET_PATH","$http","dfObjectService","dfTableEventService","dfTableCallbacksService",function(a,b,c,d,e){return{restrict:"E",scope:!1,templateUrl:a+"views/edit-record.html",link:function(a,f,g){a.es=d,a.closeRecord=function(){a._closeEdit()},a.revertRecord=function(){a._revertRecord()},a.deleteRecord=function(){a._deleteRecord()},a.saveRecord=function(){a._saveRecord()},a._closeEdit=function(){a.currentEditRecord=null},a._revertRecordData=function(){var b=a._getRevertCopy(a.currentEditRecord);for(var c in b)a.currentEditRecord.hasOwnProperty(c)&&"__dfData"!==c&&(a.currentEditRecord[c]=angular.copy(b[c]))},a._deleteRecordFromServer=function(c){return b({method:"POST",url:a.options.url,data:{resource:[c]},headers:{"X-HTTP-METHOD":"DELETE"}})},a._saveRecordToServer=function(c){return b({method:"PATCH",url:a.options.url,data:{resource:[c]}})},a._revertRecord=function(){a._revertRecordData(),a.$emit(a.es.alertSuccess,{message:"Record reverted."})},a._deleteRecord=function(){a._setInProgress(!0),e.run("onDelete","pre",a.currentEditRecord),a._deleteRecordFromServer(a.currentEditRecord).then(function(b){e.run("onDelete","post",b),a.$emit(a.es.alertSuccess,{message:"Record deleted."});var d={},f=a._getCurrentPage().value,g=a._getCurrentPage().offset;a._isLastPage()&&"object"==typeof b&&1===a.record.length&&(g-=a._getOptionFromParams("limit")),d.params=c.mergeObjects({offset:g},a.options.params),a._getRecordsFromServer(d).then(function(b){a._prepareRecords(b),a._createPagesArr(a._calcTotalPages(a._getCountFromMeta(b),a._getOptionFromParams("limit"))),f>a.pagesArr.length-1&&0!==f&&(f-=1,a.pagesArr[f].stopPropagation=!0),a._setCurrentPage(a.pagesArr[f]),a._setCurrentEditRecord(null)},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})},a._saveRecord=function(){a._setInProgress(!0),e.run("onUpdate","pre",a.currentEditRecord),a._saveRecordToServer(a.currentEditRecord).then(function(b){a._removeRevertCopy(a.currentEditRecord),a._setUnsavedState(a.currentEditRecord,!1),e.run("onUpdate","pre",b),a.$emit(a.es.alertSuccess,{message:"Record saved."}),a.options.autoClose?a._closeEdit():a._createRevertCopy(a.currentEditRecord)},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})}}}}]).directive("createRecord",["DF_TABLE_ASSET_PATH","$http","dfTableEventService","dfTableCallbacksService",function(a,b,c,d){return{restrict:"E",scope:!1,templateUrl:a+"views/create-record.html",link:function(a,e,f){a.es=c,a.closeCreateRecord=function(){a._closeCreateRecord()},a.saveNewRecord=function(){a._saveNewRecord()},a._setCreateNewRecordNull=function(){a.newRecord=null},a._saveNewRecordToServer=function(){return b({method:"POST",url:a.options.url,data:{resource:[a.newRecord]},params:{fields:"*"}})},a._closeCreateRecord=function(){a._setCreateNewRecordNull()},a._saveNewRecord=function(){var b,c;for(b in a.newRecord)if(a.newRecord.hasOwnProperty(b)&&null===a.newRecord[b])for(c in a.tableFields)a.tableFields.hasOwnProperty(c)&&b===c&&a.tableFields[c].hasOwnProperty("allow_null")&&!a.tableFields[c].allow_null&&a.tableFields[c].hasOwnProperty("auto_increment")&&a.tableFields[c].auto_increment&&delete a.newRecord[b];a._setInProgress(!0),d.run("onCreate","pre",a.newRecord),a._saveNewRecordToServer().then(function(b){d.run("onCreate","post",b),0===a.record.length?a._refreshResults():a.record.length<a.options.params.limit?(a._addStateProps(b.data.resource[0]),a.record.push(b.data.resource[0])):a.record.length*a.pagesArr.length<a.count+1&&a.pagesArr.push(a._createPageObj(a.pagesArr.length)),a.$emit(a.es.alertSuccess,{message:"Record created."}),a._closeCreateRecord()},function(a){throw{module:"DreamFactory Table Module",type:"error",provider:"dreamfactory",exception:a}})["finally"](function(){a._setInProgress(!1)},function(){a._setInProgress(!1)})}}}}]).directive("dreamfactoryBuildField",["$templateCache","$compile","dfObjectService","dfStringService","INSTANCE_URL",function(a,b,c,d,e){return{restrict:"A",scope:{field:"=?",service:"=?",table:"=?",extendFieldTypes:"=?",overrideFields:"=?",currentEditRecord:"=?",activeView:"=?"},link:function(d,f,g){if(d._parseEditable=function(a){return a&&a.hasOwnProperty("validation")&&null!=a.validation?!a.validation.hasOwnProperty("api_read_only"):!0},d.defaultFieldTypes={id:{template:"df-input-text.html",placeholder:"Id",type:"text",editable:!1},string:{template:"df-input-text.html",placeholder:"Enter String Value",type:"text",editable:!0},text:{template:"df-input-textarea.html",placeholder:"",type:"textarea",editable:!0},integer:{template:"df-input-int.html",placeholder:"Enter Integer Value",type:"number",editable:!0},"boolean":{template:"df-input-checkbox.html",placeholder:"",type:"",editable:!0},binary:{template:"df-input-binary.html",placeholder:"Enter String Value",type:"text",editable:!1},"float":{template:"df-input-number.html",placeholder:"Enter Float Value",type:"number",editable:!0},"double":{template:"df-input-number.html",placeholder:"Enter Double Value",type:"number",editable:!0},decimal:{template:"df-input-number.html",placeholder:"Enter Decimal Value",type:"number",editable:!0},datetime:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},date:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},time:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},timestamp:{template:"df-input-text.html",placeholder:"",type:"text",editable:!0},reference:{template:"df-input-reference.html",placeholder:"",type:"",editable:!1},user_id:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},user_id_on_update:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},user_id_on_create:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},timestamp_on_update:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1},timestamp_on_create:{template:"df-input-text.html",placeholder:"Enter Text Value",type:"text",editable:!1}},d.fieldTypes=c.mergeObjects(d.extendFieldTypes,d.defaultFieldTypes),d.overrideFields[d.field.name]){d.templateData={prop:d.field.name,template:"",placeholder:d.overrideFields[d.field.name].display.type||"",type:d.overrideFields[d.field.name].display.type||"text",editable:d.overrideFields[d.field.name].editable,field:d.field||"",dependent:d.overrideFields[d.field.name].display.dependent||!1};var h=d.overrideFields[d.field.name].display.type;switch(h){case"select":d.templateData.template="df-input-select.html";break;case"checkbox":d.templateData.template="df-input-checkbox.html";break;case"text":d.templateData.template="df-input-text.html";break;case"textarea":d.templateData.template="df-input-text.html";break;case"custom":d.templateData.template=d.overrideFields[d.field.name].display.template;break;default:d.templateData.template="df-input-text.html"}}else d.templateData=d.fieldTypes[d.field.type],d.templateData.editable=d._parseEditable(d.field);switch(d.field.type){case"string":d.field.hasOwnProperty("picklist")&&null!==d.field.picklist&&d.field.picklist.length>0&&(d.field.hasOwnProperty("validation")&&null!==d.field.validation&&d.field.validation.hasOwnProperty("picklist")?d.templateData.template="df-input-values-only-picklist.html":d.templateData.template="df-input-values-picklist.html",d.data=d.field.picklist,d.assignValue=function(a){d.currentEditRecord[d.field.name]=a});break;case"boolean":d.templateData.template="df-input-bool-picklist.html",d.__dfBools=[{value:!0,name:"TRUE"},{value:!1,name:"FALSE"}],d.field.allow_null&&d.__dfBools.unshift({value:"",name:"NULL"});break;case"reference":var i="df_sys_";d._parseSystemTableName=function(a){var b=a.substr(0,i.length);return b===i?a.substr(i.length):a},d._buildURL=function(a,b){return e+"/api/v2/"+a+"/_table/"+b},d.relatedOptions={service:d.service,table:d._parseSystemTableName(d.field.ref_table),url:d._buildURL(d.service,d._parseSystemTableName(d.field.ref_table)),params:{filter:null,limit:10,offset:0,fields:"*",include_schema:!0,include_count:!0},defaultFields:{},exportValueOn:!0},d.relatedOptions.defaultFields[d.field.ref_fields]=!0}f.append(b(a.get(d.templateData.template))(d))}}}]).directive("dfChildTable",["DF_TABLE_ASSET_PATH","INSTANCE_URL","dfObjectService","dfTableEventService",function(a,b,c,d){return{restrict:"E",scope:{childOptions:"=",parentSchema:"=",childTableParentRecord:"="},templateUrl:a+"views/df-child-table.html",link:function(a,e,f){var g="df_sys_";a.options={},a.childRecordsBy="",a.service=a.childOptions.service,a.closeChildTable=function(){a._closeChildTable()},a._parseSystemTableName=function(a){var b=a.substr(0,g.length);return b===g?a.substr(g.length):a},a._setSystemService=function(b){return b.substr(0,g.length)===g?"system":a.service},a._closeChildTable=function(){a.$emit(d.closeChildTable),angular.element(e).remove()};var h=a.$watch("childRecordsBy",function(d,e){if(!d)return!1;var f={service:a._setSystemService(d.ref_table),table:d.ref_table,url:b+"/api/v2/"+a._setSystemService(d.ref_table)+"/_table/"+a._parseSystemTableName(d.ref_table),params:{filter:d.ref_fields+" = "+a.childTableParentRecord[d.field]}};a.options=c.deepMergeObjects(f,a.childOptions)});a.$on("$destroy",function(a){h()})}}}]).service("dfTableEventService",[function(){return{alertSuccess:"alert:success",refreshTable:"refresh:table",closeChildTable:"close:childtable"}}]).service("dfTableCallbacksService",[function(){var a={onCreate:{pre:[],post:[]},onDelete:{pre:[],post:[]},onUpdate:{pre:[],post:[]}};return{add:function(b,c,d){a[b][c].push(d)},run:function(b,c,d){return 0==a[b][c].length?!1:void angular.forEach(a[b][c],function(a,b){a.call(void 0,d)})},reset:function(){a={onCreate:{pre:[],post:[]},onDelete:{pre:[],post:[]},onUpdate:{pre:[],post:[]}}}}}]),angular.module("dreamfactoryApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","dfUtility","dfSystemConfig","dfAdmins","dfUsers","dfApps","dfData","dfServices","dfRoles","dfSchema","dfUserManagement","dfScripts","dfProfile","dfApplication","dfHelp","dfLaunchPad","dfWidgets","dfSwaggerEditor","dfApiDocs","dfFileManager","dfPackageManager"]).constant("APP_VERSION","2.1.5").constant("INSTANCE_URL","").constant("ADMIN_API_KEY","6498a8ad1beb9d84d63035c5d1120c007fad6de706734db9689f8996707e0f7d").config(["$httpProvider","ADMIN_API_KEY",function(a,b){a.defaults.headers.common["X-Dreamfactory-API-Key"]=b}]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/login",{controller:"LoginCtrl",templateUrl:"views/login.html",resolve:{checkLoginRoute:["dfApplicationData","$location","SystemConfigDataService",function(a,b,c){var d=c.getSystemConfig(),e=a.getCurrentUser();e&&e.session_id&&(e.is_sys_admin?"user@example.com"!==e.email||d.platform.bitnami_demo?b.url("/services"):b.url("/profile"):b.url("/launchpad"))}]}}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl",resolve:{checkRegisterRoute:["SystemConfigDataService","dfApplicationData","$location",function(a,b,c){var d=a.getSystemConfig(),e=b.getCurrentUser();return e||d.authentication.allow_open_registration?!e||e.is_sys_admin||d.authentication.allow_open_registration?e&&e.is_sys_admin?void c.url("/services"):void 0:void c.url("/launchpad"):void c.url("/login")}]}}).when("/register-complete",{templateUrl:"views/register-complete.html",controller:"RegisterCompleteCtrl",resolve:{checkRegisterConfirmRoute:["SystemConfigDataService","dfApplicationData","$location",function(a,b,c){var d=a.getSystemConfig(),e=b.getCurrentUser();return e||d.authentication.allow_open_registration?e&&e.is_sys_admin?void c.url("/services"):e&&!e.is_sys_admin?void c.url("/launchpad"):void 0:void c.url("/login")}]}}).when("/register-confirm",{templateUrl:"views/register-confirm.html",controller:"RegisterConfirmCtrl",resolve:{checkRegisterConfirmRoute:["SystemConfigDataService","dfApplicationData","$location",function(a,b,c){var d=a.getSystemConfig(),e=b.getCurrentUser();return e||d.authentication.allow_open_registration?e&&e.is_sys_admin?void c.url("/services"):e&&!e.is_sys_admin?void c.url("/launchpad"):void 0:void c.url("/login")}]}}).when("/reset-password",{templateUrl:"views/reset-password-email.html",controller:"ResetPasswordEmailCtrl",resolve:{checkRegisterConfirmRoute:["SystemConfigDataService","dfApplicationData","$location",function(a,b,c){var d=b.getCurrentUser();return d&&d.is_sys_admin?void c.url("/services"):d&&!d.is_sys_admin?void c.url("/launchpad"):void 0}]}}).when("/user-invite",{templateUrl:"views/user-invite.html",controller:"UserInviteCtrl",resolve:{checkRegisterConfirmRoute:["SystemConfigDataService","dfApplicationData","$location",function(a,b,c){var d=b.getCurrentUser();return d&&d.is_sys_admin?void c.url("/services"):d&&!d.is_sys_admin?void c.url("/launchpad"):void 0}]}}).otherwise({controller:"LoginCtrl",templateUrl:"views/login.html",resolve:{checkLoginRoute:["dfApplicationData","$location","SystemConfigDataService",function(a,b,c){var d=a.getCurrentUser();d&&d.session_id&&(d.is_sys_admin?b.url("/services"):b.url("/launchpad"))}]}}),b.interceptors.push("httpValidSession")}]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","$injector",function(a,b){return function(c){if(c.provider&&"dreamfactory"===c.provider)b.invoke(["dfNotify",function(a){var b={module:c.module,type:c.type,provider:c.provider,message:c.exception};a.error(b)}]);else{if(!c.routing)return a(c);b.invoke(["dfNotify",function(a){var b={module:"Admin Application",type:"error",provider:"dreamfactory",message:"Access to this route requires Admin role."};a.error(b)}])}}}])}]).run(["SystemConfigDataService",function(a){var b=a.getSystemConfigFromServerSync();a.setSystemConfig(b)}]),angular.module("dreamfactoryApp").controller("MainCtrl",["$scope","UserDataService","SystemConfigDataService","$location","$http","INSTANCE_URL","dfApplicationData","dfNotify","dfIconService",function(a,b,c,d,e,f,g,h,i){a.title="",a.currentUser=b.getCurrentUser(),a.topLevelLinks=[{path:"#/launchpad",label:"LaunchPad",name:"launchpad",icon:i().launchpad,show:!1},{path:"#/services",label:"Admin",name:"admin",icon:i().admin,show:!1},{path:"#/login",label:"Login",name:"login",icon:i().login,show:!1},{path:"#/logout",label:"Logout",name:"logout",icon:i().logout,show:!1},{path:"#/register",label:"Register",name:"register",icon:i().register,show:!1},{path:"#/profile",label:b.getCurrentUser().name||"Guest",name:"profile",icon:i().profile,show:!1}],a.topLevelNavOptions={links:a.topLevelLinks},a.componentLinks=[{name:"apps",label:"Apps",path:"/apps"},{name:"admins",label:"Admins",path:"/admins"},{name:"users",label:"Users",path:"/users"},{name:"roles",label:"Roles",path:"/roles"},{name:"services",label:"Services",path:"/services"},{name:"schema",label:"Schema",path:"/schema"},{name:"data",label:"Data",path:"/data"},{name:"file-manager",label:"Files",path:"/file-manager"},{name:"scripts",label:"Scripts",path:"/scripts"},{name:"apidocs",label:"API Docs",path:"/apidocs"},{name:"config",label:"Config",path:"/config"},{name:"package-manager",label:"Packages",path:"/package-manager"}],a.componentNavOptions={links:a.componentLinks},a.showAdminComponentNav=!1,a._setActiveLinks=function(a,b){var c,d;angular.forEach(a,function(a){for(c=!1,d=0;d<b.length;d++)if(a.name===b[d]){c=!0;break}a.show=c})},a.setTopLevelLinkValue=function(b,c,d){for(var e=0;e<a.topLevelLinks.length;e++)if(a.topLevelLinks[e].name===b){a.topLevelLinks[e][c]=d;break}},a.$watch("currentUser",function(b,e){var f=c.getSystemConfig().app_group,g=c.getSystemConfig().no_group_app;!b&&(f&&f.length>0||g&&g.length>0)?c.getSystemConfig().authentication.allow_open_registration?a._setActiveLinks(a.topLevelLinks,["launchpad","login","register"]):a._setActiveLinks(a.topLevelLinks,["launchpad","login"]):b||c.getSystemConfig().allow_guest_user?b.is_sys_admin?(a.setTopLevelLinkValue("profile","label",b.name),a._setActiveLinks(a.topLevelLinks,["launchpad","admin","profile"])):b.is_sys_admin||(a.setTopLevelLinkValue("profile","label",b.name),a._setActiveLinks(a.topLevelLinks,["launchpad","profile"])):c.getSystemConfig().authentication.allow_open_registration?(a._setActiveLinks(a.topLevelLinks,["login","register"]),"/reset-password"===d.path()?d.url("/reset-password"):"/user-invite"===d.path()?d.url("/user-invite"):"/register-confirm"===d.path()?d.url("/register-confirm"):d.url("/login")):a._setActiveLinks(a.topLevelLinks,["login"])}),a.$watch(function(){return b.getCurrentUser().name;
},function(b,c){b&&a.setTopLevelLinkValue("profile","label",b)}),a.$on("$routeChangeSuccess",function(b){var e,f,g=!1,h=!0;switch(e=c.getSystemConfig(),e&&e.hasOwnProperty("chat")&&(e.chat.hasOwnProperty("launchpad")&&(e.chat.launchpad===!0||e.chat.launchpad===!1)&&(g=e.chat.launchpad),e.chat.hasOwnProperty("admin")&&(e.chat.admin===!0||e.chat.admin===!1)&&(h=e.chat.admin)),f=d.path()){case"/launchpad":a.showAdminComponentNav=!1,Comm100API.showChat(g);break;case"/profile":a.showAdminComponentNav=!1,Comm100API.showChat(h);break;case"/logout":a.showAdminComponentNav=!1,Comm100API.showChat(h);break;default:a.currentUser.is_sys_admin&&(a.showAdminComponentNav=!0),Comm100API.showChat(h)}})}]).controller("LoginCtrl",["dfAvailableApis","$scope","$window","$location","$timeout","UserDataService","UserEventsService","dfApplicationData","dfApplicationPrefs","SystemConfigDataService","dfNotify",function(a,b,c,d,e,f,g,h,i,j,k){b.loginOptions={showTemplate:!0},b.$on(g.password.passwordSetSuccess,function(a,c){var d={module:"Users",type:"success",provider:"dreamfactory",message:"Password reset successful."};k.success(d),b.$broadcast(g.login.loginRequest,c)}),b.$on(g.login.loginError,function(a){a.stopPropagation()}),b.$on(g.login.loginSuccess,function(f,g){b.$parent.currentUser=g;var i={apis:[]},k=location.search.substring(1);if(g.is_sys_admin)b.loginOptions.showTemplate=!1,e(function(){i.apis=a.getApis().apis,j.getSystemConfig().is_hosted&&(i.apis=a.getApis().addEventApi().apis),h.init(i.apis).then(function(){if(k){var a=d.absUrl().split("?");c.location.href=a[0]+"#/services"}else"user@example.com"!==g.email||j.getSystemConfig().platform.bitnami_demo?d.url("/services"):d.url("/profile")})},250);else if(b.$parent.currentUser=g,h.init(),k){var l=d.absUrl().split("?");c.location.href=l[0]+"#/launchpad"}else d.url("/launchpad")})}]).controller("LogoutCtrl",["$scope","$location","UserEventsService","dfApplicationData","SystemConfigDataService",function(a,b,c,d,e){a.$on(c.logout.logoutSuccess,function(c,e){a.$parent.currentUser=e,d.destroyApplicationObj(),b.url("/login")})}]).controller("RegisterCtrl",["$scope","$location","UserEventsService","SystemConfigDataService",function(a,b,c,d){a.options={confirmationRequired:d.getSystemConfig().authentication.open_reg_email_service_id},a.$on(c.register.registerSuccess,function(b,d){a.$broadcast(c.login.loginRequest,d)}),a.$on(c.register.registerConfirmation,function(a){b.url("/register-complete")}),a.$on(c.login.loginSuccess,function(c,d){a.$parent.currentUser=d,b.url("/launchpad")}),a.$on(c.login.loginError,function(a){a.stopPropagation()})}]).controller("RegisterCompleteCtrl",["$scope",function(a){}]).controller("RegisterConfirmCtrl",["$scope","$location","dfApplicationData","UserEventsService","SystemConfigDataService","dfNotify",function(a,b,c,d,e,f){a.confirmOptions={showTemplate:!0,title:"Registration Confirmation"},a.loginOptions={showTemplate:!1},a.registerLoginErrorMsg="",a.$on(d.confirm.confirmationSuccess,function(b,c){a.$broadcast(d.login.loginRequest,c)}),a.$on(d.login.loginSuccess,function(d,e){var g={module:"Users",type:"success",provider:"dreamfactory",message:"Registration Confirmation successful."};f.success(g),a.$parent.currentUser=e,c.init(),b.url("/launchpad")}),a.$on(d.login.loginError,function(b,c){b.stopPropagation(),a.registerLoginErrorMsg=c.data.error.message})}]).controller("ResetPasswordEmailCtrl",["$scope","$location","dfApplicationData","dfAvailableApis","UserEventsService","SystemConfigDataService","dfNotify","$timeout",function(a,b,c,d,e,f,g,h){a.loginOptions={showTemplate:!1},a.resetPasswordLoginErrorMsg="",a.$on(e.password.passwordSetSuccess,function(b,c){b.stopPropagation(),a.$broadcast(e.login.loginRequest,c)}),a.$on(e.login.loginSuccess,function(e,i){var j={module:"Users",type:"success",provider:"dreamfactory",message:"Password reset successful."};g.success(j),a.$parent.currentUser=i;var k={apis:[]};i.is_sys_admin?(a.loginOptions.showTemplate=!1,h(function(){k.apis=d.getApis().apis,f.getSystemConfig().is_hosted&&(k.apis=d.getApis().addEventApi().apis),c.init(k.apis).then(function(){"user@example.com"!==i.email||f.getSystemConfig().platform.bitnami_demo?b.url("/services"):b.url("/profile")})},250)):(a.$parent.currentUser=i,c.init(),b.url("/launchpad"))}),a.$on(e.login.loginError,function(b,c){b.stopPropagation(),a.resetPasswordLoginErrorMsg=c.data.error.message})}]).controller("UserInviteCtrl",["$scope","$location","dfApplicationData","UserEventsService","SystemConfigDataService","dfNotify",function(a,b,c,d,e,f){a.confirmOptions={showTemplate:!0,title:"Invitation Confirmation"},a.loginOptions={showTemplate:!1},a.confirmLoginErrorMsg="",a.$on(d.confirm.confirmationSuccess,function(b,c){a.$broadcast(d.login.loginRequest,c)}),a.$on(d.login.loginSuccess,function(d,e){var g={module:"Users",type:"success",provider:"dreamfactory",message:"User Confirmation successful."};f.success(g),a.$parent.currentUser=e,c.init(),b.url("/launchpad")}),a.$on(d.login.loginError,function(b,c){b.stopPropagation(),a.confirmLoginErrorMsg=c.data.error.message})}]);